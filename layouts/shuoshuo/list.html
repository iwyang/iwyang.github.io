{{ define "main" }}
    <main class="main list-container">
        
        <div class="shuoshuo-list">
            {{ $paginator := .Paginate .Pages }}
            
            <div class="waterfall-column">
                {{ range $index, $element := $paginator.Pages }}
                    {{ if eq (mod $index 2) 0 }}
                        {{ partial "shuoshuo-card-logic" . }}
                    {{ end }}
                {{ end }}
            </div>

            <div class="waterfall-column">
                {{ range $index, $element := $paginator.Pages }}
                    {{ if eq (mod $index 2) 1 }}
                        {{ partial "shuoshuo-card-logic" . }}
                    {{ end }}
                {{ end }}
            </div>
        </div>

        <div class="shuoshuo-pagination">
            {{ partial "pagination.html" . }}
        </div>

        {{ partial "footer/footer.html" . }}

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const timeElements = document.querySelectorAll('.shuoshuo-time');
                const now = new Date();

                timeElements.forEach(el => {
                    const dateStr = el.getAttribute('datetime');
                    if (!dateStr) return;
                    const date = new Date(dateStr);
                    const diff = (now - date) / 1000;
                    const textSpan = el.querySelector('.date-text');
                    if (!textSpan) return;

                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    const hour = String(date.getHours()).padStart(2, '0');
                    const minute = String(date.getMinutes()).padStart(2, '0');
                    const exactTime = year + '-' + month + '-' + day + ' ' + hour + ':' + minute;

                    el.setAttribute('title', exactTime);

                    let text = '';
                    if (diff < 60) { text = '刚刚'; }
                    else if (diff < 3600) { text = Math.floor(diff / 60) + ' 分钟前'; }
                    else if (diff < 86400) { text = Math.floor(diff / 3600) + ' 小时前'; }
                    else if (diff < 2592000) { text = Math.floor(diff / 86400) + ' 天前'; }
                    else if (diff < 31536000) { text = Math.floor(diff / 2592000) + ' 个月前'; }
                    else { text = Math.floor(diff / 31536000) + ' 年前'; }
                    
                    textSpan.innerText = text;
                });
            });
        </script>
    </main>
{{ end }}

{{/* --- 核心模具：修改这里，左右两栏会自动同步 --- */}}
{{ define "partials/shuoshuo-card-logic" }}
<article class="shuoshuo-card">
    <div class="shuoshuo-header">
        <div class="shuoshuo-meta">
            <time class="shuoshuo-time" datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                {{ partial "helper/icon" "date" }}
                <span class="date-text">{{ .Date.Format "2006-01-02" }}</span>
            </time>
        </div>
    </div>

    <div class="shuoshuo-content style-cs-content article-post">
        {{ .Content }}
    </div>
    
    {{ with .Resources.GetMatch "cover.*" }}
    <div class="shuoshuo-image photo-gallery">
        <a href="{{ .RelPermalink }}" target="_blank" class="gallery-link">
            <img src="{{ .RelPermalink }}" loading="lazy" alt="说说图片" style="border-radius: 8px; margin-top: 10px; width: 100%; height: auto; object-fit: cover;">
        </a>
    </div>
    {{ end }}

    <div class="shuoshuo-footer-info">
        {{ if and (.Site.Params.article.edit.enabled) (not (eq .Params.edit false)) }}
        <div class="shuoshuo-edit-link">
            {{ partial "helper/icon" "external-link" }}
            <a href="https://github.com/iwyang/iwyang.github.io/edit/develop/content/{{ replace .File.Path "\\" "/" }}" target="_blank" rel="noopener noreferrer" style="color: inherit;">
                在 GitHub 上编辑此页
            </a>
        </div>
        {{ end }}

        {{- if .Lastmod -}}
        <div class="shuoshuo-git-info">
            {{ partial "helper/icon" "clock" }}
            <span style="color: #999;">
                更新于 {{ .Lastmod.Format "2006-01-02 15:04" }}
                {{- if .GitInfo -}}
                    {{/* 7位 Hash + 蓝色链接 */}}
                    <a href="https://github.com/iwyang/iwyang.github.io/commit/{{ .GitInfo.Hash }}" target="_blank" rel="noopener noreferrer" style="color: #1e90ff; font-weight: normal; margin-left: 5px; text-decoration: none;">
                       #{{ substr .GitInfo.Hash 0 7 }}
                    </a>
                {{- end -}}
            </span>
        </div>
        {{- end -}}
    </div>
</article>
{{ end }}