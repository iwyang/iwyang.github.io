<!doctype html><html lang=zh-CN dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Debian10 ä¸Šå®‰è£…éƒ¨åˆ†åº”ç”¨ï¼Œé€Ÿåº¦å‡ ä¹ä¸º0ï¼Œè‡³å°‘éœ€è¦Debian11ä»¥ä¸Šï¼Œ512Må†…å­˜è¶³å¤Ÿã€‚\nå®‰è£… Docker 1.é¦–å…ˆï¼Œæ›´æ–°ç°æœ‰çš„è½¯ä»¶åŒ…åˆ—è¡¨ï¼š\n1 sudo apt update -y 2.æ¥ä¸‹æ¥ï¼Œå®‰è£…ä¸€äº›å¿…å¤‡è½¯ä»¶åŒ…ï¼Œè®© apt é€šè¿‡ HTTPS ä½¿ç”¨è½¯ä»¶åŒ…ã€‚\n"><title>Debian 10 å®‰è£… Docker & Docker Compose</title><link rel=canonical href=https://bore.vip/archives/9755dbc8/><link rel=stylesheet href=/scss/style.min.872990788621784cbe3e5b09db0cae819ff402e539c78a37bdf70f2c3f021b4c.css><meta property='og:title' content="Debian 10 å®‰è£… Docker & Docker Compose"><meta property='og:description' content="Debian10 ä¸Šå®‰è£…éƒ¨åˆ†åº”ç”¨ï¼Œé€Ÿåº¦å‡ ä¹ä¸º0ï¼Œè‡³å°‘éœ€è¦Debian11ä»¥ä¸Šï¼Œ512Må†…å­˜è¶³å¤Ÿã€‚\nå®‰è£… Docker 1.é¦–å…ˆï¼Œæ›´æ–°ç°æœ‰çš„è½¯ä»¶åŒ…åˆ—è¡¨ï¼š\n1 sudo apt update -y 2.æ¥ä¸‹æ¥ï¼Œå®‰è£…ä¸€äº›å¿…å¤‡è½¯ä»¶åŒ…ï¼Œè®© apt é€šè¿‡ HTTPS ä½¿ç”¨è½¯ä»¶åŒ…ã€‚\n"><meta property='og:url' content='https://bore.vip/archives/9755dbc8/'><meta property='og:site_name' content="Bore's Notes"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='docker'><meta property='article:published_time' content='2022-08-22T17:56:32+00:00'><meta property='article:modified_time' content='2026-02-09T22:08:24+08:00'><meta name=twitter:title content="Debian 10 å®‰è£… Docker & Docker Compose"><meta name=twitter:description content="Debian10 ä¸Šå®‰è£…éƒ¨åˆ†åº”ç”¨ï¼Œé€Ÿåº¦å‡ ä¹ä¸º0ï¼Œè‡³å°‘éœ€è¦Debian11ä»¥ä¸Šï¼Œ512Må†…å­˜è¶³å¤Ÿã€‚\nå®‰è£… Docker 1.é¦–å…ˆï¼Œæ›´æ–°ç°æœ‰çš„è½¯ä»¶åŒ…åˆ—è¡¨ï¼š\n1 sudo apt update -y 2.æ¥ä¸‹æ¥ï¼Œå®‰è£…ä¸€äº›å¿…å¤‡è½¯ä»¶åŒ…ï¼Œè®© apt é€šè¿‡ HTTPS ä½¿ç”¨è½¯ä»¶åŒ…ã€‚\n"><link rel="shortcut icon" href=/img/avatar.png><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel=stylesheet></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar.png width=170 height=170 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>Bore's Notes</a></h1><h2 class=site-description>åšè§‚è€Œçº¦å–ï¼Œåšç§¯è€Œè–„å‘</h2></div></header><ol class=menu-social><li><a href=https://github.com/iwyang target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>ä¸»é¡µ</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>å…³äº</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span></a></li><li><a href=/link/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>é“¾æ¥</span></a></li><li><a href=/shuoshuo/><svg class="icon icon-tabler icon-tabler-message-circle" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 20l1.3-3.9A9 8 0 117.7 19L3 20"/><line x1="12" y1="12" x2="12" y2="12.01"/><line x1="8" y1="12" x2="8" y2="12.01"/><line x1="16" y1="12" x2="16" y2="12.01"/></svg>
<span>è¯´è¯´</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav class=toc-nav id=TableOfContents><ol><li><a href=#å®‰è£…-docker>å®‰è£… Docker</a></li><li><a href=#åœ¨-docker-ä¸­ä½¿ç”¨é•œåƒ>åœ¨ Docker ä¸­ä½¿ç”¨é•œåƒ</a></li><li><a href=#åœ¨-docker-ä¸­ä½¿ç”¨å®¹å™¨>åœ¨ Docker ä¸­ä½¿ç”¨å®¹å™¨</a><ol><li><a href=#docker-å®¹å™¨å¼€æœºè‡ªå¯><strong>Docker å®¹å™¨å¼€æœºè‡ªå¯</strong></a></li></ol></li><li><a href=#å®‰è£…-docker-compose>å®‰è£… Docker Compose</a><ol><li><a href=#å¼€æœºè‡ªåŠ¨å¯åŠ¨åº”ç”¨å®¹å™¨><strong>å¼€æœºè‡ªåŠ¨å¯åŠ¨åº”ç”¨å®¹å™¨</strong></a></li></ol></li><li><a href=#docker-compose-éƒ¨ç½²tv>Docker Compose éƒ¨ç½²tv</a><ol><li><a href=#åˆ›å»º-tv-å·¥ä½œç›®å½•>åˆ›å»º tv å·¥ä½œç›®å½•</a></li><li><a href=#ç¼–å†™-docker-composeyml-æ–‡ä»¶>ç¼–å†™ <code>docker-compose.yml</code> æ–‡ä»¶ï¼š</a></li><li><a href=#æ‰§è¡Œå‘½ä»¤>æ‰§è¡Œå‘½ä»¤</a></li><li><a href=#é…ç½®åŸŸåè®¿é—®>é…ç½®åŸŸåè®¿é—®</a></li><li><a href=#è§†é¢‘æºé…ç½®>è§†é¢‘æºé…ç½®</a></li><li><a href=#æ›´æ–°é•œåƒ>æ›´æ–°é•œåƒ</a></li></ol></li><li><a href=#è‡ªå®šä¹‰tv>è‡ªå®šä¹‰tv</a><ol><li><a href=#forkä»“åº“>forkä»“åº“</a></li><li><a href=#åˆ›å»º-github-è®¿é—®-token>åˆ›å»º github è®¿é—® token</a></li><li><a href=#æ·»åŠ ç¯å¢ƒå˜é‡-secret>æ·»åŠ ç¯å¢ƒå˜é‡ secret</a></li><li><a href=#ä¿®æ”¹docker-imageyml>ä¿®æ”¹docker-image.yml</a></li><li><a href=#ä¿®æ”¹docker-composeyml-æ–‡ä»¶>ä¿®æ”¹<code>docker-compose.yml</code> æ–‡ä»¶</a></li></ol></li><li><a href=#ä¿®æ”¹tv-logoå’Œpwaå¯åŠ¨å›¾ç‰‡>ä¿®æ”¹TV logoå’ŒPWAå¯åŠ¨å›¾ç‰‡</a></li><li><a href=#doubané¡µé¢éšè—æ•°æ®æºé€‰æ‹©å™¨>doubané¡µé¢éšè—æ•°æ®æºé€‰æ‹©å™¨</a></li><li><a href=#éšè—æºæŒ‡å®šåˆ†ç±»>éšè—æºæŒ‡å®šåˆ†ç±»</a></li><li><a href=#æœç´¢å±è”½æŒ‡å®šè¿ç¦è¯>æœç´¢å±è”½æŒ‡å®šè¿ç¦è¯</a></li><li><a href=#ç”µå½±åŠ¨æ¼«ç­‰é¡µé¢æ’åº>ç”µå½±ã€åŠ¨æ¼«ç­‰é¡µé¢æ’åº</a></li><li><a href=#æ’­æ”¾æºåªæ˜¾ç¤ºæ ‡é¢˜å¼€å¤´çš„æº>æ’­æ”¾æºåªæ˜¾ç¤ºæ ‡é¢˜å¼€å¤´çš„æº</a></li><li><a href=#æ’­æ”¾æºå±è”½å­æ ‡é¢˜çš„æº>æ’­æ”¾æºå±è”½å­æ ‡é¢˜çš„æº</a></li><li><a href=#å±è”½é›†æ•°è¶…è¿‡30çš„æº>å±è”½é›†æ•°è¶…è¿‡30%çš„æº</a></li><li><a href=#è®¾ç½®æš‚æ— æµ·æŠ¥>è®¾ç½®æš‚æ— æµ·æŠ¥</a></li><li><a href=#ä¸ºè±†ç“£æ·»åŠ 2026å¹´çš„ç­›é€‰é€‰é¡¹>ä¸ºè±†ç“£æ·»åŠ 2026å¹´çš„ç­›é€‰é€‰é¡¹</a></li><li><a href=#æ’­æ”¾æºæ’åº>æ’­æ”¾æºæ’åº</a></li><li><a href=#å±è”½æ¯æ—¥æ”¾é€è°ƒæ•´é¦–é¡µ>å±è”½æ¯æ—¥æ”¾é€ï¼Œè°ƒæ•´é¦–é¡µ</a></li><li><a href=#ä¿®å¤æ”¶è—ä¸æ˜¾ç¤ºæ¸…ç©ºäºŒæ¬¡ç¡®è®¤>ä¿®å¤æ”¶è—ä¸æ˜¾ç¤ºã€æ¸…ç©ºäºŒæ¬¡ç¡®è®¤</a><ol><li><a href=#ä¿®å¤æ”¶è—ä¸æ˜¾ç¤º>ä¿®å¤æ”¶è—ä¸æ˜¾ç¤º</a></li><li><a href=#æ¸…ç©ºäºŒæ¬¡ç¡®è®¤>æ¸…ç©ºäºŒæ¬¡ç¡®è®¤</a></li></ol></li><li><a href=#ä¿®å¤åˆ†é¡µé€»è¾‘åŠ è½½ä¸å…¨>ä¿®å¤åˆ†é¡µé€»è¾‘åŠ è½½ä¸å…¨</a></li><li><a href=#å»ç©ºæ ¼æœç´¢>å»ç©ºæ ¼æœç´¢</a></li><li><a href=#åŠ ç©ºæ ¼æœç´¢>åŠ ç©ºæ ¼æœç´¢</a></li><li><a href=#å»å†’å·æœç´¢>å»å†’å·æœç´¢</a><ol><li><a href=#1-ä¿®æ”¹-apisearchroutets-åç«¯æ ‡å‡†æœç´¢>1. ä¿®æ”¹ <code>api/search/route.ts</code> (åç«¯æ ‡å‡†æœç´¢)</a></li><li><a href=#2-ä¿®æ”¹-apisearchwsroutets-åç«¯æµå¼æœç´¢>2. ä¿®æ”¹ <code>api/search/ws/route.ts</code> (åç«¯æµå¼æœç´¢)</a></li><li><a href=#3-ä¿®æ”¹-searchpagetsx-å‰ç«¯èšåˆè¿‡æ»¤>3. ä¿®æ”¹ <code>search.page.tsx</code> (å‰ç«¯èšåˆè¿‡æ»¤)</a></li><li><a href=#4-ä¿®æ”¹-playpagetsx-æ’­æ”¾é¡µæºè¿‡æ»¤>4. ä¿®æ”¹ <code>play.page.tsx</code> (æ’­æ”¾é¡µæºè¿‡æ»¤)</a></li><li><a href=#ä¿®æ”¹è¦ç‚¹æ€»ç»“>ä¿®æ”¹è¦ç‚¹æ€»ç»“</a></li></ol></li><li><a href=#è‡ªåŠ¨æ‹†åˆ†æœç´¢å…³é”®è¯>è‡ªåŠ¨æ‹†åˆ†æœç´¢å…³é”®è¯</a></li><li><a href=#æå–ä¸»æ ‡é¢˜ä¸åç¼€>æå–ä¸»æ ‡é¢˜ä¸åç¼€</a><ol><li><a href=#ä¿®æ”¹-routets-api-è·¯ç”±>ä¿®æ”¹ <code>route.ts</code> (API è·¯ç”±)</a></li><li><a href=#ä¿®æ”¹-wsroutets-websocket-è·¯ç”±>ä¿®æ”¹ <code>ws.route.ts</code> (WebSocket è·¯ç”±)</a></li><li><a href=#ä¿®æ”¹-srcappplaypagetsx>ä¿®æ”¹ <code>\src\app\play\page.tsx</code></a></li></ol></li><li><a href=#åˆ é™¤é¦–é¡µé¦–å°¾ç©ºç™½>åˆ é™¤é¦–é¡µé¦–å°¾ç©ºç™½</a></li><li><a href=#æŒ‡å®šæºæ— æ•ˆè‡ªåŠ¨é™çº§è‡ªåŠ¨ä¿®å¤è§‚çœ‹å†å²å’Œæ”¶è—>æŒ‡å®šæºæ— æ•ˆè‡ªåŠ¨é™çº§&&è‡ªåŠ¨ä¿®å¤è§‚çœ‹å†å²å’Œæ”¶è—</a></li><li><a href=#ç¦æ­¢è®¿é—®æŒ‡å®šç½‘é¡µ>ç¦æ­¢è®¿é—®æŒ‡å®šç½‘é¡µ</a><ol><li><a href=#é¡¹ç›®æ ¹ç›®å½•æ–°å»ºmiddlewarets>é¡¹ç›®æ ¹ç›®å½•æ–°å»ºmiddleware.ts</a></li><li><a href=#åˆ›å»ºè‡ªå®šä¹‰-404-é¡µé¢app404tsx>åˆ›å»ºè‡ªå®šä¹‰ 404 é¡µé¢ï¼ˆapp/404.tsxï¼‰</a></li></ol></li><li><a href=#ç§»é™¤ç‰ˆæœ¬æ£€æµ‹>ç§»é™¤ç‰ˆæœ¬æ£€æµ‹</a></li><li><a href=#å›ºå®šv09ç‰ˆæœ¬>å›ºå®šV0.9ç‰ˆæœ¬</a></li><li><a href=#å‚è€ƒé“¾æ¥>å‚è€ƒé“¾æ¥</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E6%8A%80%E6%9C%AF/ style=background-color:#beefd9;color:#0f3d29>æŠ€æœ¯</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/archives/9755dbc8/><span class=icon-pinned style="display:inline-block;background:linear-gradient(135deg,#56a3fc 0%,#9e58ff 100%);color:#fff;font-size:.6em;padding:2px 6px;border-radius:4px;vertical-align:.2em;margin-right:8px;font-weight:400;line-height:1.2;box-shadow:0 2px 4px rgba(158,88,255,.2);flex-shrink:0">ç½®é¡¶</span>
Debian 10 å®‰è£… Docker & Docker Compose</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2022-08-22T17:56:32Z>2022-08-22</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 42 åˆ†é’Ÿ</time></div></footer></div></header><aside class=article-toc><details><summary><div class=article-toc-title><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-right"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 6l6 6-6 6"/></svg>
<span>ç›®å½•</span></div></summary><nav class=toc-nav><ol><li><a href=#å®‰è£…-docker>å®‰è£… Docker</a></li><li><a href=#åœ¨-docker-ä¸­ä½¿ç”¨é•œåƒ>åœ¨ Docker ä¸­ä½¿ç”¨é•œåƒ</a></li><li><a href=#åœ¨-docker-ä¸­ä½¿ç”¨å®¹å™¨>åœ¨ Docker ä¸­ä½¿ç”¨å®¹å™¨</a><ol><li><a href=#docker-å®¹å™¨å¼€æœºè‡ªå¯><strong>Docker å®¹å™¨å¼€æœºè‡ªå¯</strong></a></li></ol></li><li><a href=#å®‰è£…-docker-compose>å®‰è£… Docker Compose</a><ol><li><a href=#å¼€æœºè‡ªåŠ¨å¯åŠ¨åº”ç”¨å®¹å™¨><strong>å¼€æœºè‡ªåŠ¨å¯åŠ¨åº”ç”¨å®¹å™¨</strong></a></li></ol></li><li><a href=#docker-compose-éƒ¨ç½²tv>Docker Compose éƒ¨ç½²tv</a><ol><li><a href=#åˆ›å»º-tv-å·¥ä½œç›®å½•>åˆ›å»º tv å·¥ä½œç›®å½•</a></li><li><a href=#ç¼–å†™-docker-composeyml-æ–‡ä»¶>ç¼–å†™ <code>docker-compose.yml</code> æ–‡ä»¶ï¼š</a></li><li><a href=#æ‰§è¡Œå‘½ä»¤>æ‰§è¡Œå‘½ä»¤</a></li><li><a href=#é…ç½®åŸŸåè®¿é—®>é…ç½®åŸŸåè®¿é—®</a></li><li><a href=#è§†é¢‘æºé…ç½®>è§†é¢‘æºé…ç½®</a></li><li><a href=#æ›´æ–°é•œåƒ>æ›´æ–°é•œåƒ</a></li></ol></li><li><a href=#è‡ªå®šä¹‰tv>è‡ªå®šä¹‰tv</a><ol><li><a href=#forkä»“åº“>forkä»“åº“</a></li><li><a href=#åˆ›å»º-github-è®¿é—®-token>åˆ›å»º github è®¿é—® token</a></li><li><a href=#æ·»åŠ ç¯å¢ƒå˜é‡-secret>æ·»åŠ ç¯å¢ƒå˜é‡ secret</a></li><li><a href=#ä¿®æ”¹docker-imageyml>ä¿®æ”¹docker-image.yml</a></li><li><a href=#ä¿®æ”¹docker-composeyml-æ–‡ä»¶>ä¿®æ”¹<code>docker-compose.yml</code> æ–‡ä»¶</a></li></ol></li><li><a href=#ä¿®æ”¹tv-logoå’Œpwaå¯åŠ¨å›¾ç‰‡>ä¿®æ”¹TV logoå’ŒPWAå¯åŠ¨å›¾ç‰‡</a></li><li><a href=#doubané¡µé¢éšè—æ•°æ®æºé€‰æ‹©å™¨>doubané¡µé¢éšè—æ•°æ®æºé€‰æ‹©å™¨</a></li><li><a href=#éšè—æºæŒ‡å®šåˆ†ç±»>éšè—æºæŒ‡å®šåˆ†ç±»</a></li><li><a href=#æœç´¢å±è”½æŒ‡å®šè¿ç¦è¯>æœç´¢å±è”½æŒ‡å®šè¿ç¦è¯</a></li><li><a href=#ç”µå½±åŠ¨æ¼«ç­‰é¡µé¢æ’åº>ç”µå½±ã€åŠ¨æ¼«ç­‰é¡µé¢æ’åº</a></li><li><a href=#æ’­æ”¾æºåªæ˜¾ç¤ºæ ‡é¢˜å¼€å¤´çš„æº>æ’­æ”¾æºåªæ˜¾ç¤ºæ ‡é¢˜å¼€å¤´çš„æº</a></li><li><a href=#æ’­æ”¾æºå±è”½å­æ ‡é¢˜çš„æº>æ’­æ”¾æºå±è”½å­æ ‡é¢˜çš„æº</a></li><li><a href=#å±è”½é›†æ•°è¶…è¿‡30çš„æº>å±è”½é›†æ•°è¶…è¿‡30%çš„æº</a></li><li><a href=#è®¾ç½®æš‚æ— æµ·æŠ¥>è®¾ç½®æš‚æ— æµ·æŠ¥</a></li><li><a href=#ä¸ºè±†ç“£æ·»åŠ 2026å¹´çš„ç­›é€‰é€‰é¡¹>ä¸ºè±†ç“£æ·»åŠ 2026å¹´çš„ç­›é€‰é€‰é¡¹</a></li><li><a href=#æ’­æ”¾æºæ’åº>æ’­æ”¾æºæ’åº</a></li><li><a href=#å±è”½æ¯æ—¥æ”¾é€è°ƒæ•´é¦–é¡µ>å±è”½æ¯æ—¥æ”¾é€ï¼Œè°ƒæ•´é¦–é¡µ</a></li><li><a href=#ä¿®å¤æ”¶è—ä¸æ˜¾ç¤ºæ¸…ç©ºäºŒæ¬¡ç¡®è®¤>ä¿®å¤æ”¶è—ä¸æ˜¾ç¤ºã€æ¸…ç©ºäºŒæ¬¡ç¡®è®¤</a><ol><li><a href=#ä¿®å¤æ”¶è—ä¸æ˜¾ç¤º>ä¿®å¤æ”¶è—ä¸æ˜¾ç¤º</a></li><li><a href=#æ¸…ç©ºäºŒæ¬¡ç¡®è®¤>æ¸…ç©ºäºŒæ¬¡ç¡®è®¤</a></li></ol></li><li><a href=#ä¿®å¤åˆ†é¡µé€»è¾‘åŠ è½½ä¸å…¨>ä¿®å¤åˆ†é¡µé€»è¾‘åŠ è½½ä¸å…¨</a></li><li><a href=#å»ç©ºæ ¼æœç´¢>å»ç©ºæ ¼æœç´¢</a></li><li><a href=#åŠ ç©ºæ ¼æœç´¢>åŠ ç©ºæ ¼æœç´¢</a></li><li><a href=#å»å†’å·æœç´¢>å»å†’å·æœç´¢</a><ol><li><a href=#1-ä¿®æ”¹-apisearchroutets-åç«¯æ ‡å‡†æœç´¢>1. ä¿®æ”¹ <code>api/search/route.ts</code> (åç«¯æ ‡å‡†æœç´¢)</a></li><li><a href=#2-ä¿®æ”¹-apisearchwsroutets-åç«¯æµå¼æœç´¢>2. ä¿®æ”¹ <code>api/search/ws/route.ts</code> (åç«¯æµå¼æœç´¢)</a></li><li><a href=#3-ä¿®æ”¹-searchpagetsx-å‰ç«¯èšåˆè¿‡æ»¤>3. ä¿®æ”¹ <code>search.page.tsx</code> (å‰ç«¯èšåˆè¿‡æ»¤)</a></li><li><a href=#4-ä¿®æ”¹-playpagetsx-æ’­æ”¾é¡µæºè¿‡æ»¤>4. ä¿®æ”¹ <code>play.page.tsx</code> (æ’­æ”¾é¡µæºè¿‡æ»¤)</a></li><li><a href=#ä¿®æ”¹è¦ç‚¹æ€»ç»“>ä¿®æ”¹è¦ç‚¹æ€»ç»“</a></li></ol></li><li><a href=#è‡ªåŠ¨æ‹†åˆ†æœç´¢å…³é”®è¯>è‡ªåŠ¨æ‹†åˆ†æœç´¢å…³é”®è¯</a></li><li><a href=#æå–ä¸»æ ‡é¢˜ä¸åç¼€>æå–ä¸»æ ‡é¢˜ä¸åç¼€</a><ol><li><a href=#ä¿®æ”¹-routets-api-è·¯ç”±>ä¿®æ”¹ <code>route.ts</code> (API è·¯ç”±)</a></li><li><a href=#ä¿®æ”¹-wsroutets-websocket-è·¯ç”±>ä¿®æ”¹ <code>ws.route.ts</code> (WebSocket è·¯ç”±)</a></li><li><a href=#ä¿®æ”¹-srcappplaypagetsx>ä¿®æ”¹ <code>\src\app\play\page.tsx</code></a></li></ol></li><li><a href=#åˆ é™¤é¦–é¡µé¦–å°¾ç©ºç™½>åˆ é™¤é¦–é¡µé¦–å°¾ç©ºç™½</a></li><li><a href=#æŒ‡å®šæºæ— æ•ˆè‡ªåŠ¨é™çº§è‡ªåŠ¨ä¿®å¤è§‚çœ‹å†å²å’Œæ”¶è—>æŒ‡å®šæºæ— æ•ˆè‡ªåŠ¨é™çº§&&è‡ªåŠ¨ä¿®å¤è§‚çœ‹å†å²å’Œæ”¶è—</a></li><li><a href=#ç¦æ­¢è®¿é—®æŒ‡å®šç½‘é¡µ>ç¦æ­¢è®¿é—®æŒ‡å®šç½‘é¡µ</a><ol><li><a href=#é¡¹ç›®æ ¹ç›®å½•æ–°å»ºmiddlewarets>é¡¹ç›®æ ¹ç›®å½•æ–°å»ºmiddleware.ts</a></li><li><a href=#åˆ›å»ºè‡ªå®šä¹‰-404-é¡µé¢app404tsx>åˆ›å»ºè‡ªå®šä¹‰ 404 é¡µé¢ï¼ˆapp/404.tsxï¼‰</a></li></ol></li><li><a href=#ç§»é™¤ç‰ˆæœ¬æ£€æµ‹>ç§»é™¤ç‰ˆæœ¬æ£€æµ‹</a></li><li><a href=#å›ºå®šv09ç‰ˆæœ¬>å›ºå®šV0.9ç‰ˆæœ¬</a></li><li><a href=#å‚è€ƒé“¾æ¥>å‚è€ƒé“¾æ¥</a></li></ol></nav></details></aside><section class=article-content><p>Debian10 ä¸Šå®‰è£…éƒ¨åˆ†åº”ç”¨ï¼Œé€Ÿåº¦å‡ ä¹ä¸º0ï¼Œè‡³å°‘éœ€è¦Debian11ä»¥ä¸Šï¼Œ512Må†…å­˜è¶³å¤Ÿã€‚</p><h2 id=å®‰è£…-docker>å®‰è£… Docker</h2><p>1.é¦–å…ˆï¼Œæ›´æ–°ç°æœ‰çš„è½¯ä»¶åŒ…åˆ—è¡¨ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update -y
</span></span></code></pre></td></tr></table></div></div><p>2.æ¥ä¸‹æ¥ï¼Œå®‰è£…ä¸€äº›å¿…å¤‡è½¯ä»¶åŒ…ï¼Œè®© apt é€šè¿‡ HTTPS ä½¿ç”¨è½¯ä»¶åŒ…ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install apt-transport-https ca-certificates curl gnupg2 software-properties-common -y
</span></span></code></pre></td></tr></table></div></div><p>3.ç„¶åå°†å®˜æ–¹ Docker hub çš„ GPG key æ·»åŠ åˆ°ç³»ç»Ÿä¸­ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -fsSL https://download.docker.com/linux/debian/gpg <span class=p>|</span> sudo apt-key add -
</span></span></code></pre></td></tr></table></div></div><p>4.å°† Docker ç‰ˆæœ¬åº“æ·»åŠ åˆ°APTæºï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo add-apt-repository <span class=s2>&#34;deb [arch=amd64] https://download.docker.com/linux/debian </span><span class=k>$(</span>lsb_release -cs<span class=k>)</span><span class=s2> stable&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>5.æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨æ–°æ·»åŠ çš„ Docker è½¯ä»¶åŒ…æ¥è¿›è¡Œå‡çº§æ›´æ–°ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>sudo apt update -y</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>6.å®‰è£… Docker</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install docker-ce -y
</span></span></code></pre></td></tr></table></div></div><p>7.æ£€æŸ¥ Docker æ˜¯å¦æ­£åœ¨è¿è¡Œ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker --version
</span></span><span class=line><span class=cl>sudo systemctl status docker
</span></span></code></pre></td></tr></table></div></div><p>8.é‡å¯ docker å¹¶è®¾ç½®å¼€æœºè‡ªå¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>sudo</span> <span class=n>systemctl</span> <span class=n>enable</span> <span class=n>docker</span>
</span></span><span class=line><span class=cl><span class=n>sudo</span> <span class=n>systemctl</span> <span class=n>daemon</span><span class=o>-</span><span class=n>reload</span>
</span></span><span class=line><span class=cl><span class=n>sudo</span> <span class=n>systemctl</span> <span class=n>restart</span> <span class=n>docker</span>
</span></span></code></pre></td></tr></table></div></div><p>9.ä¿®æ”¹Dockeré…ç½®ï¼ˆæ¥è‡ª<a class=link href=https://u.sb/debian-install-docker/ target=_blank rel=noopener>çƒ§é¥¼åšå®¢</a>ï¼‰</p><p>ä»¥ä¸‹é…ç½®ä¼šå¢åŠ ä¸€æ®µè‡ªå®šä¹‰å†…ç½‘ IPv6 åœ°å€ï¼Œå¼€å¯å®¹å™¨çš„ IPv6 åŠŸèƒ½ï¼Œä»¥åŠé™åˆ¶æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œé˜²æ­¢ Docker æ—¥å¿—å¡æ»¡ç¡¬ç›˜ï¼ˆæ³ªçš„æ•™è®­ï¼‰</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt; /etc/docker/daemon.json <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>{
</span></span></span><span class=line><span class=cl><span class=s>    &#34;log-driver&#34;: &#34;json-file&#34;,
</span></span></span><span class=line><span class=cl><span class=s>    &#34;log-opts&#34;: {
</span></span></span><span class=line><span class=cl><span class=s>        &#34;max-size&#34;: &#34;20m&#34;,
</span></span></span><span class=line><span class=cl><span class=s>        &#34;max-file&#34;: &#34;3&#34;
</span></span></span><span class=line><span class=cl><span class=s>    },
</span></span></span><span class=line><span class=cl><span class=s>    &#34;ipv6&#34;: true,
</span></span></span><span class=line><span class=cl><span class=s>    &#34;fixed-cidr-v6&#34;: &#34;fd00:dead:beef:c0::/80&#34;,
</span></span></span><span class=line><span class=cl><span class=s>    &#34;experimental&#34;:true,
</span></span></span><span class=line><span class=cl><span class=s>    &#34;ip6tables&#34;:true
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åé‡å¯ Docker æœåŠ¡ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl restart docker
</span></span></code></pre></td></tr></table></div></div><h2 id=åœ¨-docker-ä¸­ä½¿ç”¨é•œåƒ>åœ¨ Docker ä¸­ä½¿ç”¨é•œåƒ</h2><p>1.è¦æŸ¥çœ‹å·²ä¸‹è½½åˆ°è®¡ç®—æœºçš„é•œåƒï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker images
</span></span></code></pre></td></tr></table></div></div><p>2.åˆ é™¤æŸä¸ªdockeré•œåƒ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker rmi &lt;your-image-id&gt;
</span></span></code></pre></td></tr></table></div></div><p>3.ä¸€æ¬¡åˆ é™¤å¤šå¼ é•œåƒ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker rmi &lt;your-image-id&gt; &lt;your-image-id&gt; ...
</span></span></code></pre></td></tr></table></div></div><p>4.ä¸€æ¬¡åˆ é™¤æ‰€æœ‰é•œåƒ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker rmi <span class=k>$(</span>docker images -q<span class=k>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=åœ¨-docker-ä¸­ä½¿ç”¨å®¹å™¨>åœ¨ Docker ä¸­ä½¿ç”¨å®¹å™¨</h2><p>1.è¦æŸ¥çœ‹<strong>æ‰€æœ‰</strong>çš„å®¹å™¨å¯¹è±¡ï¼Œè¯·ä½¿ç”¨ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker ps -a
</span></span></code></pre></td></tr></table></div></div><blockquote><p>docker ps -a -q åˆ†è§£</p><ul><li><code>docker ps</code> åˆ—å‡º<strong>æ´»åŠ¨</strong>ä¸­å®¹å™¨ã€‚</li><li><code>-a</code> è¿™ä¸ªé€‰é¡¹ç”¨äºåˆ—å‡º<strong>æ‰€æœ‰</strong>å®¹å™¨ï¼ŒåŒ…æ‹¬åœæ­¢è¿è¡Œçš„ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªé€‰é¡¹ï¼Œåˆ™é»˜è®¤åªåˆ—å‡ºåœ¨è¿è¡Œçš„å®¹å™¨ã€‚</li><li><code>-q</code> è¿™ä¸ªé€‰é¡¹åˆ—å‡ºå®¹å™¨çš„æ•°å­— IDï¼Œè€Œä¸æ˜¯å®¹å™¨çš„æ‰€æœ‰ä¿¡æ¯ã€‚</li></ul></blockquote><p>2.è¦å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨ï¼Œè¯·ä½¿ç”¨<code>docker startå‘½ä»¤+å®¹å™¨IDæˆ–å®¹å™¨å</code></p><blockquote><ul><li>åœæ­¢æ‰€æœ‰å®¹å™¨è¿è¡Œï¼š<code>docker stop $(docker ps -a -q)</code></li></ul></blockquote><p>3.é€šè¿‡<code>docker rm</code>å‘½ä»¤æ¥åˆ é™¤ä¸ç”¨çš„å®¹å™¨ã€‚</p><blockquote><ul><li>å…ˆä½¿ç”¨<code>docker ps -a</code>å‘½ä»¤æŸ¥æ‰¾ç›¸å…³é•œåƒå…³è”çš„å®¹å™¨çš„<strong>å®¹å™¨IDæˆ–åç§°</strong>ï¼Œç„¶åé€šè¿‡<code>docker rm</code>å‘½ä»¤æ¥åˆ é™¤å…¶åˆ é™¤ã€‚</li><li>åˆ é™¤æ‰€æœ‰åœæ­¢è¿è¡Œçš„å®¹å™¨ï¼š<code>docker rm $(docker ps -a -q)</code></li></ul></blockquote><h3 id=docker-å®¹å™¨å¼€æœºè‡ªå¯><strong>Docker å®¹å™¨å¼€æœºè‡ªå¯</strong></h3><p>1.åœ¨ä½¿ç”¨docker runå¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨&ndash;restartå‚æ•°æ¥è®¾ç½®ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -m 512m --memory-swap 1G -it -p 58080:8080 --restart<span class=o>=</span>always  
</span></span></code></pre></td></tr></table></div></div><p>2.å¦‚æœåˆ›å»ºæ—¶æœªæŒ‡å®š &ndash;restart=always ,å¯é€šè¿‡update å‘½ä»¤è®¾ç½®</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker update --restart<span class=o>=</span>always å®¹å™¨IDæˆ–åç§°
</span></span></code></pre></td></tr></table></div></div><h2 id=å®‰è£…-docker-compose>å®‰è£… Docker Compose</h2><p>1.å®‰è£…</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>LATEST_VERSION</span><span class=o>=</span><span class=k>$(</span>wget -qO- -t1 -T2 <span class=s2>&#34;https://api.github.com/repos/docker/compose/releases/latest&#34;</span> <span class=p>|</span> grep <span class=s2>&#34;tag_name&#34;</span> <span class=p>|</span> head -n <span class=m>1</span> <span class=p>|</span> awk -F <span class=s2>&#34;:&#34;</span> <span class=s1>&#39;{print $2}&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;s/\&#34;//g;s/,//g;s/ //g&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>sudo curl -L https://github.com/docker/compose/releases/download/<span class=nv>$LATEST_VERSION</span>/docker-compose-linux-<span class=sb>`</span>uname -m<span class=sb>`</span> &gt; ./docker-compose
</span></span><span class=line><span class=cl>sudo chmod +x ./docker-compose
</span></span><span class=line><span class=cl>sudo mv ./docker-compose /usr/local/bin/docker-compose
</span></span></code></pre></td></tr></table></div></div><p>2.æŸ¥çœ‹ç‰ˆæœ¬</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker-compose --version
</span></span></code></pre></td></tr></table></div></div><p>3.ä½¿ç”¨ -d é€‰é¡¹ä»¥åˆ†ç¦»æ¨¡å¼å¯åŠ¨ Compose(åå°)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker-compose up -d
</span></span></code></pre></td></tr></table></div></div><p>4.è¦æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ docker å®¹å™¨ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker-compose ps
</span></span></code></pre></td></tr></table></div></div><p>5.åˆ é™¤å®¹å™¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cd /root/docker/tv
</span></span><span class=line><span class=cl>docker-compose stop
</span></span><span class=line><span class=cl>docker-compose down    
</span></span><span class=line><span class=cl>cd ..
</span></span><span class=line><span class=cl>rm -rf /root/docker/tv
</span></span></code></pre></td></tr></table></div></div><p>6.ä¸€äº› Docker Compose å¸¸ç”¨å‘½ä»¤ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker-compose restart  # é‡å¯å®¹å™¨
</span></span><span class=line><span class=cl>docker-compose stop     # æš‚åœå®¹å™¨
</span></span><span class=line><span class=cl>docker-compose down     # åˆ é™¤å®¹å™¨
</span></span><span class=line><span class=cl>docker-compose pull     # æ›´æ–°é•œåƒ
</span></span><span class=line><span class=cl>docker-compose exec artalk bash # è¿›å…¥å®¹å™¨
</span></span></code></pre></td></tr></table></div></div><p>7.Docker Composeå‡çº§</p><p>æ‹‰å–æœ€æ–°é•œåƒï¼Œç„¶åé‡æ–°åˆ›å»ºå®¹å™¨å³å¯ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker-compose pull
</span></span><span class=line><span class=cl>docker-compose up -d
</span></span><span class=line><span class=cl>docker image prune -f
</span></span></code></pre></td></tr></table></div></div><p><strong>8.ä½¿ç”¨ Watchtower è‡ªåŠ¨æ›´æ–°</strong></p><p><a class=link href=https://github.com/containrrr/watchtower target=_blank rel=noopener>Watchtower</a> å¯è‡ªåŠ¨æ£€æµ‹å¹¶æ›´æ–° Docker å®¹å™¨åˆ°æœ€æ–°é•œåƒã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>watchtower</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>containrrr/watchtower</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>watchtower</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/var/run/docker.sock:/var/run/docker.sock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span>--<span class=l>interval 86400 --cleanup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=å¼€æœºè‡ªåŠ¨å¯åŠ¨åº”ç”¨å®¹å™¨><strong>å¼€æœºè‡ªåŠ¨å¯åŠ¨åº”ç”¨å®¹å™¨</strong></h3><p>1.æ–¹æ³•ä¸€ã€é€šè¿‡ Docker Restart Policy æ–¹æ³•</p><p>åœ¨ Docker ä¸­ï¼Œæ”¯æŒ &ndash;restart é€‰é¡¹ï¼Œæ¥æ§åˆ¶å®¹å™¨è‡ªåŠ¨å¯åŠ¨ã€‚åœ¨ Docker Compose ä¸­ï¼Œåº”è¯¥ä½¿ç”¨ restart å±æ€§</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>version: &#39;2&#39;
</span></span><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  database:
</span></span><span class=line><span class=cl>    build: ./mysql/
</span></span><span class=line><span class=cl>    command: mysqld --user=root --verbose
</span></span><span class=line><span class=cl><span class=gi>+   restart: always 
</span></span></span><span class=line><span class=cl>    environment:
</span></span><span class=line><span class=cl>      MYSQL_DATABASE: &#34;web_level3_sqli&#34;
</span></span><span class=line><span class=cl>      MYSQL_USER: &#34;web_level3_sqli&#34;
</span></span><span class=line><span class=cl>      MYSQL_PASSWORD: &#34;thisisasecurepassword123&#34;
</span></span><span class=line><span class=cl>      MYSQL_ROOT_PASSWORD: &#34;root&#34;
</span></span><span class=line><span class=cl>      MYSQL_ALLOW_EMPTY_PASSWORD: &#34;yes&#34;
</span></span><span class=line><span class=cl>  web:
</span></span><span class=line><span class=cl>    build: ./www/
</span></span><span class=line><span class=cl><span class=gi>+    restart: always
</span></span></span><span class=line><span class=cl>    ports:
</span></span><span class=line><span class=cl>     - &#34;12000:80&#34;
</span></span><span class=line><span class=cl>    volumes:
</span></span><span class=line><span class=cl>      - ./www/src:/var/www/html
</span></span><span class=line><span class=cl>    links:
</span></span><span class=line><span class=cl>      - database
</span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„äº‹é¡¹ï¼š
1ï¼‰Docker å¹¶ä¸çŸ¥é“è¿™äº›æœåŠ¡çš„ä¾èµ–å…³ç³»åŠå¯åŠ¨é¡ºåºï¼Œéœ€è¦æˆ‘ä»¬ç²¾å¿ƒç¼–æ’ docker-compose.yaml æ–‡ä»¶ï¼›
2ï¼‰Docker Compose ä¸æ”¯æŒ deploy:restart_policy å±æ€§ï¼Œè¯¥å±æ€§åªèƒ½ç”¨äº a swarm with docker stack deploy ç¯å¢ƒï¼›</p><p>2.æ–¹æ³•äºŒã€é€šè¿‡è¿›ç¨‹ç®¡ç†æœåŠ¡ï¼ˆæ¨èï¼‰</p><p>è¯¥æ–¹æ³•æœ¬è´¨ä¸Šè¿˜æ˜¯åœ¨æ‰§è¡Œ docker-compose å‘½ä»¤ã€‚</p><p>ä½¿ç”¨ systemd ç®¡ç†
å¦‚ä¸‹ç¤ºä¾‹ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè®¾ç½®ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># cat /etc/systemd/system/docker-compose-app.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Unit<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>Description</span><span class=o>=</span>Docker Compose Application Service
</span></span><span class=line><span class=cl><span class=nv>Requires</span><span class=o>=</span>docker.service
</span></span><span class=line><span class=cl><span class=nv>After</span><span class=o>=</span>docker.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Service<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>Type</span><span class=o>=</span>oneshot
</span></span><span class=line><span class=cl><span class=nv>RemainAfterExit</span><span class=o>=</span>yes
</span></span><span class=line><span class=cl><span class=nv>WorkingDirectory</span><span class=o>=</span>/srv/docker/app/
</span></span><span class=line><span class=cl><span class=nv>ExecStart</span><span class=o>=</span>/usr/local/bin/docker-compose up -d
</span></span><span class=line><span class=cl><span class=nv>ExecStop</span><span class=o>=</span>/usr/local/bin/docker-compose down
</span></span><span class=line><span class=cl><span class=nv>TimeoutStartSec</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Install<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>WantedBy</span><span class=o>=</span>multi-user.target
</span></span></code></pre></td></tr></table></div></div><p>7.å¸è½½ Docker Compose</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo rm /usr/local/bin/docker-compose
</span></span></code></pre></td></tr></table></div></div><h2 id=docker-compose-éƒ¨ç½²tv>Docker Compose éƒ¨ç½²tv</h2><p>å‚è€ƒï¼š<a class=link href="/archives/d5e37958/?highlight=mem#Docker-Compose%e9%83%a8%e7%bd%b2">Memos Docker-Composeéƒ¨ç½²</a></p><h3 id=åˆ›å»º-tv-å·¥ä½œç›®å½•>åˆ›å»º tv å·¥ä½œç›®å½•</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>mkdir -p /root/docker/tv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=l>cd /root/docker/tv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=l>vi docker-compose.yml</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=ç¼–å†™-docker-composeyml-æ–‡ä»¶>ç¼–å†™ <code>docker-compose.yml</code> æ–‡ä»¶ï¼š</h3><p>æ³¨æ„æ›´æ”¹ <code>- PASSWORD=ä½ çš„å¯†ç </code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>vi docker-compose.yml
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>decotv-core</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/decohererk/decotv:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>decotv-core</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always </span><span class=w> </span><span class=c># You can keep &#39;unless-stopped&#39; or &#39;always&#39; as preferred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;3000:3000&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>USERNAME=admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>PASSWORD=ä½ çš„å¯†ç </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NEXT_PUBLIC_STORAGE_TYPE=kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>KVROCKS_URL=redis://decotv-kvrocks:6666</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NEXT_PUBLIC_DISABLE_YELLOW_FILTER=false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>decotv-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>decotv-kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>decotv-kvrocks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>apache/kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>decotv-kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always </span><span class=w> </span><span class=c># You can keep &#39;unless-stopped&#39; or &#39;always&#39; as preferred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>kvrocks-data:/var/lib/kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>decotv-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>watchtower</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>containrrr/watchtower</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>watchtower</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/var/run/docker.sock:/var/run/docker.sock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span>--<span class=l>interval 86400 --cleanup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always </span><span class=w> </span><span class=c># You can keep &#39;unless-stopped&#39; or &#39;always&#39; as preferred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>decotv-network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>bridge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kvrocks-data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=æ‰§è¡Œå‘½ä»¤>æ‰§è¡Œå‘½ä»¤</h3><p><code>tv</code> åç«¯ç¨‹åºå°†è¿è¡Œåœ¨ <code>http://localhost:ç«¯å£å·</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker-compose up -d
</span></span></code></pre></td></tr></table></div></div><h3 id=é…ç½®åŸŸåè®¿é—®>é…ç½®åŸŸåè®¿é—®</h3><p>å‚è€ƒï¼š<a class=link href="/archives/d5e37958/?highlight=mem#%e9%85%8d%e7%bd%ae%e5%9f%9f%e5%90%8d%e8%ae%bf%e9%97%ae">åŸŸåè®¿é—®</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>server {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>listen 80;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>server_name tv.bore.vip;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Redirect all HTTP traffic to HTTPS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>return 301 https://$host$request_uri;</span><span class=w>
</span></span></span><span class=line><span class=cl>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=l>server {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>listen 443 ssl http2;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>server_name tv.bore.vip;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>root /data/wwwroot/tv.bore.vip;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># SSL setting</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>ssl_certificate /etc/letsencrypt/live/tv.bore.vip/fullchain.pem;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>ssl_certificate_key /etc/letsencrypt/live/tv.bore.vip/privkey.pem;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>ssl_prefer_server_ciphers on;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>ssl_session_cache shared:SSL:10m;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>ssl_session_timeout 10m;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>add_header Strict-Transport-Security &#34;max-age=31536000&#34;;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># proxy to 3000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>location / {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>proxy_pass http://127.0.0.1:3000;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>proxy_set_header Host $host;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>proxy_set_header X-Real-IP $remote_addr;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>proxy_set_header X-Forwarded-Proto $scheme;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>proxy_set_header REMOTE-HOST $remote_addr;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>add_header X-Cache $upstream_cache_status;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>add_header Cache-Control no-cache;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>expires 12h;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>location ^~ /.well-known/acme-challenge/ {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>default_type &#34;text/plain&#34;;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>allow all;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>root /data/wwwroot/tv.bore.vip/;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>}<span class=w>
</span></span></span><span class=line><span class=cl>}<span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=è§†é¢‘æºé…ç½®>è§†é¢‘æºé…ç½®</h3><ul><li><strong>åŸºç¡€ç‰ˆ</strong>ï¼ˆ20+ç«™ç‚¹ï¼‰ï¼š<a class=link href=https://www.mediafire.com/file/upztrjc0g1ynbzy/config_isadult.json/file target=_blank rel=noopener>config_isadult.json</a></li><li><strong>å¢å¼ºç‰ˆ</strong>ï¼ˆ94 ç«™ç‚¹ï¼‰ï¼š<a class=link href=https://www.mediafire.com/file/ff60ynj6z21iqfb/configplus_isadult.json/file target=_blank rel=noopener>configplus_isadult.json</a></li><li>ç²¾ç®€ç‰ˆï¼š<a class=link href=https://raw.githubusercontent.com/hafrey1/LunaTV-config/refs/heads/main/jin18.txt target=_blank rel=noopener>ç²¾ç®€ç‰ˆ</a></li></ul><p>ç²¾ç®€ç‰ˆè§ï¼š<a class=link href=https://github.com/hafrey1/LunaTV-config target=_blank rel=noopener>LunaTV-config</a></p><h3 id=æ›´æ–°é•œåƒ>æ›´æ–°é•œåƒ</h3><p><em>æ³¨æ„ï¼šæ›´æ–°å‰æœ€å¥½åœ¨åå°å…ˆå¤‡ä»½æ•°æ®</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>cd /root/docker/tv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=l>docker-compose pull</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=l>docker-compose up -d</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=l>docker image prune -f</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><p>PSï¼šæ˜¯å¦éœ€è¦ <code>docker-compose down</code>ï¼Ÿï¼ˆé—®chatgptï¼‰</p><p>ä¸€èˆ¬ <strong>ä¸éœ€è¦</strong>ï¼Œé™¤éï¼š</p><ul><li>æ”¹è¿‡ç½‘ç»œã€volumeã€ç«¯å£ç­‰ä¼šå†²çªçš„é…ç½®</li><li>æŸäº›æœåŠ¡éœ€è¦å®Œå…¨é‡å»º</li><li>æƒ³å½»åº•æ¸…ç†æ—§å®¹å™¨</li></ul><p>å¦‚æœä½ åªæ˜¯æ›´æ–°é•œåƒ â†’ é‡å¯æœåŠ¡ï¼Œé‚£ä¹ˆ <strong>ä¸åŠ  <code>down</code> æ˜¯æ­£ç¡®çš„</strong>ã€‚</p><hr><h2 id=è‡ªå®šä¹‰tv>è‡ªå®šä¹‰tv</h2><h3 id=forkä»“åº“>forkä»“åº“</h3><p>è¿™ä¸€æ­¥ç®€å•ï¼Œforkåå¯å…‹éš†åˆ°æœ¬åœ°ä¿®æ”¹ä»£ç ï¼Œä¿®æ”¹å®Œæˆåæäº¤ï¼Œæ³¨æ„å…ˆ<strong>æ·»åŠ æœ¬åœ°SSHå…¬é’¥</strong>åˆ°ä»“åº“ï¼Œå‚è€ƒï¼š<a class=link href=/archives/8b53a475/#%e9%85%8d%e7%bd%aeSSH-%e5%85%ac%e9%92%a5>é…ç½® SSH å…¬é’¥</a></p><p>å…‹éš†ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>git clone https://github.com/iwyang/DecoTV.git
</span></span></code></pre></td></tr></table></div></div><p>ä¿®æ”¹åæäº¤ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>git add .
</span></span><span class=line><span class=cl>git commit -m &#34;æ›´æ–°&#34;
</span></span><span class=line><span class=cl>git push origin main
</span></span></code></pre></td></tr></table></div></div><hr><p><strong>githubé€€å›æ—§ç‰ˆæœ¬</strong></p><ul><li>é€€å›åˆ°æŒ‡å®šç‰ˆæœ¬</li></ul><p>å¦‚æœä½ æƒ³å½»åº•å›é€€åˆ° <code>ba82571f837d9e0a7abf1d667c9354543e87c130</code>ï¼Œå¹¶åˆ é™¤è¯¥æäº¤ä¹‹åçš„æ‰€æœ‰å†å²è®°å½•ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>git reset --hard ba82571f837d9e0a7abf1d667c9354543e87c130
</span></span></code></pre></td></tr></table></div></div><p><strong>æ³¨æ„</strong>ï¼šè¿™ä¼šä¸¢å¤±æ‰€æœ‰åœ¨ç›®æ ‡æäº¤ä¹‹åçš„æ›´æ”¹ï¼ŒåŒ…æ‹¬å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„å†…å®¹ã€‚</p><ul><li>æ¨é€æ›´æ”¹åˆ°è¿œç¨‹ä»“åº“</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>git push origin main --force
</span></span></code></pre></td></tr></table></div></div><hr><p><strong>æœåŠ¡å™¨æ‹‰å–æœ€æ–°é•œåƒï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cd /root/docker/tv
</span></span><span class=line><span class=cl>docker-compose pull
</span></span><span class=line><span class=cl>docker-compose up -d
</span></span><span class=line><span class=cl>docker image prune -f
</span></span></code></pre></td></tr></table></div></div><h3 id=åˆ›å»º-github-è®¿é—®-token>åˆ›å»º github è®¿é—® token</h3><ol><li><p>åœ¨ä»»ä½•é¡µé¢çš„å³ä¸Šè§’ï¼Œå•å‡»ä¸ªäººèµ„æ–™ç…§ç‰‡ï¼Œç„¶åå•å‡» â€œè®¾ç½®â€ã€‚</p></li><li><p>åœ¨å·¦ä¾§è¾¹æ ä¸­ï¼Œå•å‡» â€œå¼€å‘äººå‘˜è®¾ç½®â€ã€‚</p></li><li><p>è¯·åœ¨å·¦ä¾§è¾¹æ çš„ â€œPersonal access tokenâ€ ä¸‹ï¼Œå•å‡» â€œç»†ç²’åº¦ä»¤ç‰Œâ€ ã€‚</p></li><li><p>å•å‡» â€œç”Ÿæˆæ–°ä»¤ç‰Œâ€ã€‚</p></li><li><p>åœ¨ â€œä»¤ç‰Œåç§°â€ ä¸‹ï¼Œè¾“å…¥ä»¤ç‰Œçš„åç§°ã€‚</p></li><li><p>åœ¨ â€œè¿‡æœŸæ—¶é—´â€ ä¸‹ï¼Œé€‰æ‹©ä»¤ç‰Œçš„è¿‡æœŸæ—¶é—´ï¼ˆæ°¸ä¸è¿‡æœŸï¼‰ã€‚</p></li><li><p>ç„¶åæƒé™è¦å¼€å¯ <strong>repo</strong> å’Œ <strong>workflow</strong>å’Œ<strong>write:package</strong>sä»¥åŠ<strong>read:packages</strong> çš„æƒé™</p></li></ol><h3 id=æ·»åŠ ç¯å¢ƒå˜é‡-secret>æ·»åŠ ç¯å¢ƒå˜é‡ secret</h3><p>åœ¨ <code>settings/secrets(Secrets and variables)/actions</code> é‡ŒæŠŠ Github çš„ Token è®¾ç½®ä¸Šï¼Œæ¯”å¦‚ workflow å†™çš„æ˜¯secrets.GHCR_TOKENï¼Œæ‰€ä»¥æ·»åŠ çš„æ—¶å€™ Name å¡«å†™ GHCR_TOKENï¼ŒSecret é‡Œå¡«å†™ä¸Šä¸€æ­¥åˆ›å»º Token å†…å®¹ã€‚</p><h3 id=ä¿®æ”¹docker-imageyml>ä¿®æ”¹docker-image.yml</h3><p>æŠŠ.github/workflows/docker-image.ymlä¸­çš„<code>secrets.GITHUB_TOKEN </code>æ”¹æˆ<code>secrets.GHCR_TOKEN</code>ï¼Œå¤§æ¦‚æœ‰ä¸‰å¤„è¦æ”¹ã€‚<strong>GitHub actionsæˆåŠŸè¿è¡Œåå°±å¯ä»¥åˆ›å»ºè‡ªå·±çš„é•œåƒã€‚</strong></p><h3 id=ä¿®æ”¹docker-composeyml-æ–‡ä»¶>ä¿®æ”¹<code>docker-compose.yml</code> æ–‡ä»¶</h3><p><strong>æ³¨æ„ä¿®æ”¹è‡ªå·±çš„å¯†ç </strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>vi docker-compose.yml
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>decotv-core</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/iwyang/decotv:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>decotv-core</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always </span><span class=w> </span><span class=c># You can keep &#39;unless-stopped&#39; or &#39;always&#39; as preferred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;3000:3000&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>USERNAME=admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>PASSWORD=ä½ çš„å¯†ç </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NEXT_PUBLIC_STORAGE_TYPE=kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>KVROCKS_URL=redis://decotv-kvrocks:6666</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NEXT_PUBLIC_DISABLE_YELLOW_FILTER=false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>decotv-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>decotv-kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>decotv-kvrocks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>apache/kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>decotv-kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always </span><span class=w> </span><span class=c># You can keep &#39;unless-stopped&#39; or &#39;always&#39; as preferred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>kvrocks-data:/var/lib/kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>decotv-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>watchtower</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>containrrr/watchtower</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>watchtower</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/var/run/docker.sock:/var/run/docker.sock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span>--<span class=l>interval 86400 --cleanup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always </span><span class=w> </span><span class=c># You can keep &#39;unless-stopped&#39; or &#39;always&#39; as preferred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>decotv-network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>bridge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kvrocks-data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=ä¿®æ”¹tv-logoå’Œpwaå¯åŠ¨å›¾ç‰‡>ä¿®æ”¹TV logoå’ŒPWAå¯åŠ¨å›¾ç‰‡</h2><ul><li>logoåœ¨æ ¹ç›®å½•<code>public</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œfavicon.icoå’Œlogo.png</li><li>pwaå¯åŠ¨å›¾ç‰‡åœ¨æ ¹ç›®å½•<code>public\icons</code>æ–‡ä»¶å¤¹ä¸‹ï¼ˆæ ¹ç›®å½•scripts\generate-manifest.jsæ–‡ä»¶å¯æŸ¥çœ‹ï¼‰</li></ul><h2 id=doubané¡µé¢éšè—æ•°æ®æºé€‰æ‹©å™¨>doubané¡µé¢éšè—æ•°æ®æºé€‰æ‹©å™¨</h2><p>1.æé—®<a class=link href=https://grok.com/ target=_blank rel=noopener>grok</a>ï¼ˆé™„ä»¶æ·»åŠ <a class=link href=https://github.com/iwyang/DecoTV/tree/main/src target=_blank rel=noopener>src</a>/<a class=link href=https://github.com/iwyang/DecoTV/tree/main/src/app target=_blank rel=noopener>app</a>/<a class=link href=https://github.com/iwyang/DecoTV/tree/main/src/app/douban target=_blank rel=noopener>douban</a>/page.tsxï¼‰ï¼š</p><p>æ€æ ·ä¿®æ”¹ï¼Œæ‰èƒ½éšè— ï¼šæ•°æ®æº(30) èšåˆğŸ¬-çˆ±qiyi&mldr;&mldr;</p><p>2.æ¥ç€è¿½é—®ï¼šèƒ½ç»™æˆ‘ä¿®æ”¹å¥½çš„å®Œæ•´æ–‡ä»¶å—ï¼ˆgrokå‘çš„ä»£ç ç»å¸¸ä¸å®Œæ•´ï¼Œå¯¼è‡´éƒ¨ç½²å‡ºé”™ï¼‰</p><p>3.å¦‚æœéƒ¨ç½²æŠ¥é”™ï¼Œä¸‹è½½æ—¥å¿—æ–‡ä»¶ç»™å®ƒåˆ†æï¼š<strong>ç‚¹å‡»<code>Explain error</code>å³è¾¹çš„å°é½¿è½®é€‰æ‹©<code>Download logs arichive</code></strong>ï¼Œä¸‹è½½æ—¥å¿—æ–‡ä»¶ï¼Œæ‰¾åˆ°å¤±è´¥é‚£ä¸€æ­¥ï¼Œå¤åˆ¶é”™è¯¯æ—¥å¿—ç»™aiåˆ†æ</p><p><strong>ä¿®æ”¹å®Œæˆæ•ˆæœï¼š</strong></p><ul><li>â€œæ•°æ®æº(30)â€ é‚£ä¸€æ•´è¡Œå®Œå…¨æ¶ˆå¤±</li><li>ä¸å†åŠ è½½ä»»ä½•ç¬¬ä¸‰æ–¹ CMS æº</li><li>æ‰€æœ‰ä¸ useSourceFilterã€sourceDataã€filteredSourceCategories ç­‰ç›¸å…³ä»£ç å·²åˆ é™¤</li><li>é¡µé¢åªæ˜¾ç¤ºè±†ç“£åŸç”Ÿå†…å®¹æˆ– Bangumi æ¯æ—¥æ”¾é€ï¼Œä½“éªŒæ›´çº¯ç²¹ã€åŠ è½½æ›´å¿«</li></ul><p>ç›´æ¥æ›¿æ¢åŸæ¥çš„ page.tsx å³å¯ã€‚ç¥ä½¿ç”¨æ„‰å¿«ï¼</p><h2 id=éšè—æºæŒ‡å®šåˆ†ç±»>éšè—æºæŒ‡å®šåˆ†ç±»</h2><p>æ–¹æ³•å¦‚ä¸Šï¼Œè¿˜æ˜¯ç”¨<a class=link href=https://grok.com/ target=_blank rel=noopener>grok</a>ï¼Œæé—®ï¼š</p><p><strong>é»˜è®¤æ­¤é¡µé¢ä¼šæ˜¾ç¤ºæºçš„æ‰€æœ‰åˆ†ç±»ï¼Œå¸®æˆ‘ä¿®æ”¹ä»£ç ï¼Œå®ç°ä»¥ä¸‹è¿‡æ»¤è§„åˆ™ï¼š</strong></p><ul><li><strong>å¦‚æœæºåç§°åŒ…å« â€œè‰¾æ—¦å½±è§†â€ â†’ å®Œå…¨éšè—æ‰€æœ‰åˆ†ç±»ï¼ˆä¸æ˜¾ç¤ºä»»ä½•åˆ†ç±»æŒ‰é’®ï¼‰</strong></li><li><strong>å…¶ä»–æ‰€æœ‰æº â†’ è‡ªåŠ¨éšè—ä»¥ä¸‹æ•æ„Ÿåˆ†ç±»ï¼Œå¦‚ç¦åˆ©ã€ä¼¦ç†ã€é‡Œç•ªåŠ¨ç”»ç­‰</strong></li></ul><p><strong>ç»™æˆ‘å®Œæ•´ä»£ç ï¼Œä¸è¦çœç•¥ä»£ç </strong></p><p><strong>æ³¨æ„ï¼šä¼šçœç•¥ä»£ç ï¼Œè¦åå¤ç¡®è®¤æ˜¯å¦æ˜¯å®Œæ•´ä»£ç ï¼Œæœ‰æ²¡æœ‰çœç•¥ï¼Œå°¤å…¶æ˜¯éƒ¨ç½²å¤±è´¥çš„æ—¶å€™</strong>ï¼Œä¹Ÿå¯ä¸‹è½½æ—¥å¿—æ–‡ä»¶ï¼Œæ‰¾åˆ°å¤±è´¥é‚£ä¸€æ­¥ï¼Œå¤åˆ¶é”™è¯¯æ—¥å¿—ç»™aiåˆ†æ</p><h2 id=æœç´¢å±è”½æŒ‡å®šè¿ç¦è¯>æœç´¢å±è”½æŒ‡å®šè¿ç¦è¯</h2><p>æ–¹æ³•å¦‚ä¸Šï¼Œè¿˜æ˜¯ç”¨<a class=link href=https://grok.com/ target=_blank rel=noopener>grok</a>ï¼Œä¸Šä¼ <code>/src/app/api/search</code>ä¸‹é¢çš„5ä¸ªè·¯ç”±æ–‡ä»¶ï¼Œ<strong>æé—®</strong>ï¼š</p><p><strong>æ€æ ·ä¿®æ”¹æ‰èƒ½å®ç°ï¼š</strong>
<strong>1.æœç´¢è¿ç¦è¯æ—¶ï¼Œç›´æ¥è·³è¿‡æœç´¢ï¼Œè¿”å›ç©ºç»“æœã€‚</strong></p><p><strong>2.å½“æœç´¢ç»“æœå«æœ‰è¿ç¦è¯æ—¶ï¼Œå±è”½æ˜¾ç¤ºè¯¥ç»“æœ</strong></p><p><strong>3.æ–°å»ºä¸€ä¸ª filter.tsï¼Œä¸“é—¨è®¾ç½®è¿ç¦è¯ï¼Œå…¶ä»– 4 ä¸ªæ–‡ä»¶å¼•ç”¨å°±è¡Œ</strong></p><p><strong>ç»™æˆ‘å®Œæ•´ä»£ç ï¼Œä¸è¦çœç•¥ä»£ç ï¼Œæ–‡ä»¶å¼€å¤´æ³¨é‡Šä¿®æ”¹çš„æ˜¯å“ªä¸ªæ–‡ä»¶ã€‚</strong></p><hr><p><strong>æ³¨æ„ï¼šä¼šçœç•¥ä»£ç ï¼Œè¦åå¤ç¡®è®¤æ˜¯å¦æ˜¯å®Œæ•´ä»£ç ï¼Œæœ‰æ²¡æœ‰çœç•¥ï¼Œå°¤å…¶æ˜¯éƒ¨ç½²å¤±è´¥çš„æ—¶å€™</strong>ï¼Œä¹Ÿå¯ä¸‹è½½æ—¥å¿—æ–‡ä»¶ï¼Œæ‰¾åˆ°å¤±è´¥é‚£ä¸€æ­¥ï¼Œå¤åˆ¶é”™è¯¯æ—¥å¿—ç»™aiåˆ†æ</p><h2 id=ç”µå½±åŠ¨æ¼«ç­‰é¡µé¢æ’åº>ç”µå½±ã€åŠ¨æ¼«ç­‰é¡µé¢æ’åº</h2><p>è¿˜æ˜¯ç”¨<a class=link href=https://grok.com/ target=_blank rel=noopener>grok</a>ï¼Œä¸Šä¼ <code>\src\app\douban\page.tsx</code>å’Œ<code>\src\components\MultiLevelSelector.tsx</code>2ä¸ªæ–‡ä»¶ï¼Œ<strong>æé—®</strong>ï¼š</p><hr><p>æˆ‘æƒ³ä¿®æ”¹ä»£ç è¾¾åˆ°ä»¥ä¸‹æœ€ç»ˆæ•ˆæœï¼Œè¯·å¸®æˆ‘ç»™å‡ºå®Œæ•´ä»£ç ï¼ˆä¸è¦çœç•¥ï¼‰ï¼Œå¹¶è§£é‡Šå…³é”®æ”¹åŠ¨ï¼š</p><p>ã€é¡µé¢/åŠŸèƒ½ã€‘ï¼šDoubané¡µé¢ / æ’åºç­›é€‰å™¨ / åŠ¨æ¼«åˆ†ç±»ç­‰</p><p>ã€å½“å‰æ–‡ä»¶ã€‘ï¼špage.tsx / MultiLevelSelector.tsx</p><p>ã€æƒ³è¦çš„æœ€ç»ˆæ•ˆæœã€‘ï¼ˆè¶Šè¯¦ç»†è¶Šå¥½ï¼ŒæŒ‰ä¼˜å…ˆçº§åˆ—ç‚¹ï¼‰ï¼š</p><ol><li>ç”µå½±/ç”µè§†å‰§/ç»¼è‰ºé¡µé¢é»˜è®¤åˆ†ç±»æ˜¯â€œå…¨éƒ¨â€ï¼Œé»˜è®¤æ’åºæ˜¯â€œè¿‘æœŸçƒ­åº¦â€ï¼ˆsort = â€˜Uâ€™ï¼‰ï¼Œèƒ¶å›Šæ˜¾ç¤ºâ€œè¿‘æœŸçƒ­åº¦â€</li><li>åŠ¨æ¼«é¡µé¢é»˜è®¤æ˜¾ç¤ºâ€œç•ªå‰§â€åˆ†ç±»ï¼Œâ€œç•ªå‰§â€åˆ†ç±»å’Œâ€œå‰§åœºç‰ˆâ€åˆ†ç±»é»˜è®¤æ’åºæ˜¯â€œè¿‘æœŸçƒ­åº¦â€ï¼ˆsort = â€˜Uâ€™ï¼‰ï¼Œèƒ¶å›Šæ˜¾ç¤ºâ€œè¿‘æœŸçƒ­åº¦â€</li><li>åˆ‡æ¢åˆ°â€œç»¼åˆæ’åºâ€æ—¶ï¼Œèƒ¶å›ŠæŒ‰é’®æ˜¾ç¤ºâ€œæ’åºâ€ï¼ˆç°è‰²ï¼‰</li><li>é€‰æ‹©â€œè¿‘æœŸçƒ­åº¦â€æˆ–å…¶ä»–éç»¼åˆæ’åºæ—¶ï¼Œèƒ¶å›Šæ˜¾ç¤ºå…·ä½“åç§°ï¼ˆç»¿è‰²ï¼‰</li><li>ä¸‹æ‹‰èœå•é‡Œé»˜è®¤é«˜äº®â€œè¿‘æœŸçƒ­åº¦â€</li></ol><p>ã€å…¶ä»–è¦æ±‚ã€‘ï¼ˆå¦‚æœæœ‰ï¼‰ï¼š</p><ul><li>ä¸è¦æ”¹å˜å…¶ä»–ç­›é€‰å™¨çš„è¡Œä¸º</li><li>ä¿æŒç°æœ‰åŠ è½½æ›´å¤šã€éª¨æ¶å±ç­‰é€»è¾‘ä¸å˜</li><li>è¯·ç»™å‡ºå®Œæ•´æ–‡ä»¶ä»£ç ï¼Œä¸è¦çœç•¥</li></ul><p>å½“å‰ä»£ç è¯·å‚è€ƒé™„ä»¶ï¼š[æ‹–å…¥æˆ–è´´ä¸Šæœ€æ–° page.tsx / MultiLevelSelector.tsx ä»£ç ]</p><h2 id=æ’­æ”¾æºåªæ˜¾ç¤ºæ ‡é¢˜å¼€å¤´çš„æº>æ’­æ”¾æºåªæ˜¾ç¤ºæ ‡é¢˜å¼€å¤´çš„æº</h2><p>è¿˜æ˜¯ç”¨<a class=link href=https://grok.com/ target=_blank rel=noopener>grok</a>ï¼Œä¸Šä¼ <code>yangtv</code>&lsquo;ä¸‹<code>\src\app\play\page.tsx</code>æ–‡ä»¶ï¼Œ<strong>æé—®</strong>ï¼š(å¾—åˆ°æœ€ç»ˆéœ€è¦çš„ç‰ˆæœ¬åï¼Œé—®grokï¼šä»¥åè¦ä¿®æ”¹ä»£ç ï¼Œè¾¾åˆ°è¿™ç§æ•ˆæœçš„è¯ï¼Œ<strong>è¦æ€æ ·å‘ä½ æé—®</strong>)</p><p><strong>æˆ‘å¸Œæœ›æ’­æ”¾æºè¿‡æ»¤è§„åˆ™å˜æˆï¼š</strong>
<strong>æ ¸å¿ƒæ¡ä»¶ï¼š</strong></p><ul><li><strong>result.titleï¼ˆå¿½ç•¥ç©ºæ ¼ã€å¤§å°å†™ï¼‰å¿…é¡»ä»¥ä¸»æ ‡é¢˜ï¼ˆvideoTitle æˆ– searchTitleï¼‰å¼€å¤´</strong></li><li><strong>å¹´ä»½è¦åŒ¹é…ï¼ˆå¦‚æœæœ‰ year å‚æ•°ï¼‰</strong></li></ul><p><strong>ç±»å‹å¤„ç†ï¼š</strong></p><ul><li><strong>å¦‚æœ searchType æ˜¯ movieï¼Œå…è®¸ episodes.length &lt;= 5 çš„æºé€šè¿‡</strong></li><li><strong>å¦‚æœ searchType æ˜¯ tvï¼Œè¿˜æ˜¯è¦æ±‚ episodes.length > 1</strong></li><li><strong>å¦‚æœæ²¡æœ‰ searchTypeï¼Œå°±ä¸é™åˆ¶ç±»å‹</strong></li></ul><p><strong>è¯·ç›´æ¥ç»™å‡ºä¿®æ”¹åçš„å®Œæ•´ filter ä»£ç å—</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>const results = data.results.filter((result</span><span class=p>:</span><span class=w> </span><span class=l>SearchResult) =&gt; {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>if (!result.title) return false;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>// ä¸»æ ‡é¢˜å¤„ç†ï¼ˆå¿½ç•¥å¤§å°å†™ã€å»æ‰æ‰€æœ‰ç©ºæ ¼ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>const mainTitle = (searchTitle || videoTitleRef.current || &#39;&#39;)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>.trim()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>.replace(/\s+/g, &#39;&#39;)           // æ¨èç”¨è¿™ä¸ªæ­£åˆ™ï¼Œæ›´å½»åº•å»ç©ºæ ¼</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>.toLowerCase();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>// æºæ ‡é¢˜åŒæ ·å¤„ç†</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>const sourceTitleClean = result.title</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>.trim()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>.replace(/\s+/g, &#39;&#39;)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>.toLowerCase();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>// â˜… æœ€æ ¸å¿ƒæ¡ä»¶ï¼šå¿…é¡»ä»¥ä¸»æ ‡é¢˜å¼€å¤´ï¼ˆæœ€èƒ½ä¿è¯ç›¸å…³æ€§ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>const isPrefixMatch = sourceTitleClean.startsWith(mainTitle);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>// å¹´ä»½åŒ¹é…ï¼ˆå»ºè®®ä¿ç•™ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>const yearMatch = videoYearRef.current</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>?</span><span class=w> </span><span class=l>(result.year || &#39;&#39;).toLowerCase() === videoYearRef.current.toLowerCase()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=l>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>// ç±»å‹åˆ¤æ–­æ”¾å®½ï¼ˆè§£å†³ç”µå½±è¢«æ ‡æˆ tv çš„å¸¸è§é—®é¢˜ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>const episodeCount = result.episodes?.length ?? 0;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>const isLikelyMovie = episodeCount &lt;= 5;  // å…è®¸ 1~5 é›†ï¼ˆå¤„ç†åˆ†ä¸Šä¸‹éƒ¨ã€è¯¯æ ‡ã€é•¿ç‰‡åˆ†æ®µç­‰ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>const isLikelyTv = episodeCount &gt; 1;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>let typeMatch = true;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>if (searchType) {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>if (searchType === &#39;movie&#39;) {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=l>typeMatch = isLikelyMovie;           // ç”µå½±è¦æ±‚ï¼šçœ‹èµ·æ¥åƒç”µå½±å³å¯</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=w> </span><span class=l>else if (searchType === &#39;tv&#39;) {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=l>typeMatch = isLikelyTv;              // ç”µè§†å‰§è¿˜æ˜¯è¦æ±‚å¤šé›†</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>// æœ€ç»ˆè¿”å›æ¡ä»¶ï¼šæ ‡é¢˜å¼€å¤´æ˜¯å¿…é¡»çš„ï¼Œç±»å‹å·²æ”¾å®½</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=l>return isPrefixMatch &amp;&amp; yearMatch &amp;&amp; typeMatch;</span><span class=w>
</span></span></span><span class=line><span class=cl>}<span class=l>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=æ’­æ”¾æºå±è”½å­æ ‡é¢˜çš„æº>æ’­æ”¾æºå±è”½å­æ ‡é¢˜çš„æº</h2><p>è¿˜æ˜¯ç”¨<a class=link href=https://grok.com/ target=_blank rel=noopener>grok</a>ï¼Œæé—®ï¼š<strong>â€œè¯·ä¿®æ”¹è¿‡æ»¤é€»è¾‘ï¼Œå°† <code>mainTitle</code> çš„æ¥æºç”± <code>stitle</code> æ”¹ä¸ºä»…é™ <code>title</code> å‚æ•°ï¼Œç¡®ä¿æºåˆ—è¡¨åªæ˜¾ç¤ºä»¥ä¸»æ ‡é¢˜å¼€å¤´çš„èµ„æºã€‚â€</strong></p><p><strong>ä¿®æ”¹å‰çš„é€»è¾‘ï¼ˆç¬¬ 552 è¡Œå·¦å³ï¼‰ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// åªè¦åŒ¹é… stitle æˆ–ä¸»æ ‡é¢˜ä»»ä½•ä¸€ä¸ªå¼€å¤´ï¼Œå°±ä¼šæ˜¾ç¤º
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>mainTitle</span> <span class=o>=</span> <span class=p>(</span><span class=nx>searchTitle</span> <span class=o>||</span> <span class=nx>videoTitleRef</span><span class=p>.</span><span class=nx>current</span> <span class=o>||</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>trim</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\s+/g</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>toLowerCase</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>ä¿®æ”¹åçš„é€»è¾‘ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// ä»…ä½¿ç”¨ä¸»æ ‡é¢˜ï¼Œå½»åº•æ— è§† stitle çš„å‰ç¼€å¹²æ‰°
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>mainTitle</span> <span class=o>=</span> <span class=p>(</span><span class=nx>videoTitleRef</span><span class=p>.</span><span class=nx>current</span> <span class=o>||</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>trim</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\s+/g</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>toLowerCase</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=å±è”½é›†æ•°è¶…è¿‡30çš„æº>å±è”½é›†æ•°è¶…è¿‡30%çš„æº</h2><p>è¿˜æ˜¯ç”¨<a class=link href=https://grok.com/ target=_blank rel=noopener>grok</a>ï¼Œ<strong>æé—®</strong>ï¼š</p><p>æˆ‘æ­£åœ¨ä¿®æ”¹ <code>fetchSourcesData</code> å‡½æ•°é‡Œçš„ <code>filter</code> è¿‡æ»¤é€»è¾‘ï¼ˆæˆ–è€…è¯„åˆ†é€»è¾‘ï¼‰ã€‚ <strong>ã€ä¸šåŠ¡åœºæ™¯ã€‘</strong>ï¼šç›®å‰åœ¨æœç´¢ [æŸç§ç±»å‹ï¼Œå¦‚ï¼šç”µè§†å‰§] æ—¶ï¼Œä¼šå‡ºç° [æŸç§é—®é¢˜ï¼Œå¦‚ï¼šæœ‰å¾ˆå¤šé›†æ•°ä¸å…¨çš„è„æ•°æ®]ã€‚ <strong>ã€é€»è¾‘è§„åˆ™ã€‘</strong>ï¼š</p><ol><li>è¯·å¸®æˆ‘åŒºåˆ† <code>movie</code> å’Œ <code>vod</code> ä¸¤ç§ç±»å‹ã€‚</li><li>å¦‚æœæ˜¯ <code>vod</code>ï¼Œå½“ [æ¡ä»¶ï¼Œå¦‚ï¼šé›†æ•°è¯¯å·® > 30%] æ—¶ï¼Œæ‰§è¡Œæ‹¦æˆªã€‚</li><li>å¦‚æœæ˜¯ <code>movie</code>ï¼Œæ‰§è¡Œ [æ¡ä»¶ï¼Œå¦‚ï¼šé›†æ•° > 5 å°±æ‹¦æˆª]ã€‚ <strong>ã€åŠ¨ä½œç›®æ ‡ã€‘</strong>ï¼šè¯·ç›´æ¥åœ¨ <code>filter</code> ä¸­è¿”å› <code>false</code> <strong>ç›´æ¥å±è”½</strong>ï¼Œä¸è¦åªåœ¨è¯„åˆ†é‡Œé™åˆ†ã€‚ <strong>ã€å½“å‰ä»£ç ã€‘</strong>ï¼š[ç²˜è´´ä½ ç›¸å…³çš„ä»£ç ç‰‡æ®µ]</li></ol><p><strong>æœ€ç»ˆæ•ˆæœï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>æ€»ç»“ä¸€ä¸‹ï¼Œè¿™æ¬¡ä¿®æ”¹é€šè¿‡å°†â€œæ‹¦æˆªé€»è¾‘â€å‰ç½®åˆ°æœç´¢é˜¶æ®µï¼Œå®ç°äº†æ’­æ”¾æºåˆ—è¡¨çš„**â€œè‡ªåŠ¨ç²¾ç®€åŒ–â€**ã€‚ä»¥ä¸‹æ˜¯æœ€ç»ˆå®ç°çš„æ•ˆæœï¼š
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1. ç”µè§†å‰§ï¼šè‡ªåŠ¨è¿‡æ»¤â€œæ®‹è¡€æºâ€ä¸â€œæ‚è´¨æºâ€
</span></span><span class=line><span class=cl>ä¼—æ•°å®šæ ‡ï¼š ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†ææœç´¢ç»“æœï¼Œæ‰¾å‡ºå¤§å®¶å…¬è®¤çš„é›†æ•°ï¼ˆå¦‚ 40 é›†ï¼‰ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>30% å¼ºåŠ›æ‹¦æˆªï¼š * å±è”½æ®‹ç¼ºæºï¼š å¦‚æœæŸä¸ªæºåªæœ‰ 20 é›†ï¼ˆä½äº 28 é›†ï¼‰ï¼Œå®ƒä¼šä»åˆ—è¡¨é‡Œç›´æ¥æ¶ˆå¤±ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>å±è”½çŒæ°´æºï¼š å¦‚æœæŸä¸ªæºå› ä¸ºå¸¦äº†å¤ªå¤šèŠ±çµ®å¯¼è‡´æœ‰ 60 é›†ï¼ˆé«˜äº 52 é›†ï¼‰ï¼Œä¹Ÿä¼šè¢«ç›´æ¥å¹²æ‰ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ç»“æœï¼š ä½ çœ‹åˆ°çš„ç”µè§†å‰§æºåˆ—è¡¨å°†éå¸¸æ•´é½ï¼ŒåŸºæœ¬éƒ½æ˜¯é›†æ•°è¾¾æ ‡çš„æ­£ç‰‡æºã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2. ç”µå½±ï¼šå½»åº•æœç»â€œå‰§ç‰ˆâ€å¹²æ‰°
</span></span><span class=line><span class=cl>å¼ºåˆ¶ 1 é›†åŸºå‡†ï¼š ç”µå½±æ¨¡å¼ä¸‹ä¸å†ç»Ÿè®¡ä¼—æ•°ï¼Œé»˜è®¤å°±æ˜¯ 1 é›†ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ç¡¬æ‹¦æˆªï¼ˆ&gt; 5é›†ï¼‰ï¼š æœç”µå½±æ—¶ï¼Œå‡¡æ˜¯é›†æ•°è¶…è¿‡ 5 é›†çš„ï¼ˆé€šå¸¸æ˜¯åŒåçš„ 30-40 é›†ç”µè§†å‰§ï¼‰ä¼šè¢«ç¬é—´è¿‡æ»¤ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ç»“æœï¼š è§£å†³äº†â€œæœç”µå½±å‡ºæ¥ä¸€å †ç”µè§†å‰§â€çš„ç—›ç‚¹ï¼Œåˆ—è¡¨æå…¶å¹²å‡€ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>3. è¯„åˆ†ç³»ç»Ÿï¼šå›å½’çº¯ç²¹æ€§èƒ½æ¯”æ‹¼
</span></span><span class=line><span class=cl>çº¯å‡€æ‰“åˆ†ï¼š calculateSourceScore ä¸å†èƒŒè´Ÿâ€œæƒ©ç½šè¯¯å·®æºâ€çš„åŒ…è¢±ï¼Œä¹Ÿä¸å†éœ€è¦å¤„ç†ä¸šåŠ¡é€»è¾‘å‚æ•°ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æ¯”æ‹¼ç¡¬å®åŠ›ï¼š èƒ½å¤Ÿè¿›å…¥è¯„åˆ†ç¯èŠ‚çš„éƒ½æ˜¯â€œé›†æ•°åˆæ ¼â€çš„æºï¼Œå®ƒä»¬ç°åœ¨åªçº¯ç²¹åœ°æ¯”æ‹¼ ç”»è´¨æ˜¯å¦æ¸…æ™°ï¼ˆ4K/1080Pï¼‰ã€åŠ è½½é€Ÿåº¦å¿«æ…¢ ä»¥åŠ ç½‘ç»œå»¶è¿Ÿä½ç§’ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>4. ç³»ç»Ÿè¡¨ç°ï¼šæ›´è½»ã€æ›´å¿«ã€æ›´çœ
</span></span><span class=line><span class=cl>èŠ‚çœæµ‹é€Ÿèµ„æºï¼š é‚£äº›ä¸åˆæ ¼çš„æºåœ¨ç¬¬ä¸€æ­¥å°±è¢« filter æ‰äº†ï¼Œç³»ç»Ÿä¸ä¼šå†å»è¯·æ±‚å®ƒä»¬çš„ API è¿›è¡Œç”»è´¨å’Œé€Ÿåº¦æµ‹è¯•ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>åŠ è½½æé€Ÿï¼š å‡å°‘äº†æ— æ•ˆæºçš„å¹¶è¡Œæµ‹è¯•ï¼Œæ•´ä½“æœç´¢ç»“æœæ¸²æŸ“å‡ºæ¥çš„é€Ÿåº¦ä¼šæ›´å¿«ï¼Œä¹ŸèŠ‚çœäº†æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„æµé‡ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ä¸€å¥è¯æ€»ç»“ï¼š ç°åœ¨çš„ç³»ç»ŸåƒåŠ äº†ä¸€ä¸ªæ™ºèƒ½å®‰æ£€é—¨ï¼Œç”µè§†å‰§åªæ”¾è¡Œâ€œè¶³é‡â€çš„ï¼Œç”µå½±åªæ”¾è¡Œâ€œæœ¬ä½“â€ï¼Œæœ€åå‰©ä¸‹çš„éƒ½æ˜¯ç²¾å“ï¼Œä½ åªéœ€è¦åœ¨å…¶ä¸­æŒ‘ä¸€ä¸ªæœ€å¿«çš„å°±è¡Œã€‚
</span></span></code></pre></td></tr></table></div></div><h2 id=è®¾ç½®æš‚æ— æµ·æŠ¥>è®¾ç½®æš‚æ— æµ·æŠ¥</h2><p>æœç´¢lunatvæºç ï¼ŒæŸ¥æ‰¾éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶å’Œä»£ç ä½ç½®ï¼ˆæœç´¢æš‚æ— æµ·æŠ¥ï¼‰ï¼Œ<code>\src\components\VideoCard.tsx</code>ï¼Œå¦‚æœç›´æ¥å¤åˆ¶ä»£ç åˆ°yangtvç›¸åº”ä½ç½®ï¼Œéƒ¨ç½²ä¼šæŠ¥é”™ï¼Œä¸‹è½½é”™è¯¯æ—¥å¿—ï¼Œä¸Šä¼ <code>VideoCard.tsx</code>å’Œé”™è¯¯æ—¥å¿—ç»™grokåˆ†æé”™è¯¯åŸå› ï¼Œæ²¡æœ‰ç»™å‡ºæ­£ç¡®ä¿®æ”¹æ–¹æ³•ï¼Œä¸Šä¼ <code>VideoCard.tsx</code>å’Œé”™è¯¯æ—¥å¿—é—®<a class=link href=https://gemini.google.com/app target=_blank rel=noopener>gemini</a>å¾—åˆ°äº†æ­£ç¡®ä¿®æ”¹æ–¹æ³•ï¼ˆå…ˆé—®grokï¼Œä¸è¡Œå†é—®Geminiï¼‰ã€‚</p><p><strong>é—®é¢˜åœ¨äºï¼š</strong> ä½ çš„ç»„ä»¶ä¸­å®šä¹‰çš„çŠ¶æ€å˜é‡åç§°æ˜¯ <code>isLoading</code> å’Œ <code>setIsLoading</code>ï¼ˆç¬¬ 82 è¡Œï¼‰ï¼Œä½†ä½ åœ¨é”™è¯¯å¤„ç†å›è°ƒå‡½æ•°ä¸­å´å°è¯•è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„ <code>setImageLoaded</code> å‡½æ•°ã€‚</p><hr><p><strong>ä¿®å¤æ–¹æ¡ˆ</strong></p><p>ä½ éœ€è¦å°† <code>setImageLoaded(true)</code> æ›´æ”¹ä¸ºç»„ä»¶ä¸­å®é™…å®šä¹‰çš„ <code>setIsLoading(true)</code>ã€‚</p><p><strong>ä¿®æ”¹æ­¥éª¤ï¼š</strong></p><ol><li>æ‰“å¼€ <code>src/components/VideoCard.tsx</code>ã€‚</li><li>æ‰¾åˆ°ç¬¬ <strong>571</strong> è¡Œå·¦å³ã€‚</li><li>å°† <code>setImageLoaded(true);</code> æ›¿æ¢ä¸º <code>setIsLoading(true);</code>ã€‚</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>              </span>}<span class=w> </span><span class=l>else {</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=l>// é‡è¯•å¤±è´¥ï¼Œä½¿ç”¨é€šç”¨å ä½å›¾</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=l>img.src = &#39;data:image/svg+xml,%3Csvg xmlns=&#34;http://www.w3.org/2000/svg&#34; width=&#34;200&#34; height=&#34;300&#34; viewBox=&#34;0 0 200 300&#34;%3E%3Crect fill=&#34;%23374151&#34; width=&#34;200&#34; height=&#34;300&#34;/%3E%3Cg fill=&#34;%239CA3AF&#34;%3E%3Cpath d=&#34;M100 80 L100 120 M80 100 L120 100&#34; stroke=&#34;%239CA3AF&#34; stroke-width=&#34;8&#34; stroke-linecap=&#34;round&#34;/%3E%3Crect x=&#34;60&#34; y=&#34;140&#34; width=&#34;80&#34; height=&#34;100&#34; rx=&#34;5&#34; fill=&#34;none&#34; stroke=&#34;%239CA3AF&#34; stroke-width=&#34;4&#34;/%3E%3Cpath d=&#34;M70 160 L90 180 L130 140&#34; stroke=&#34;%239CA3AF&#34; stroke-width=&#34;4&#34; stroke-linecap=&#34;round&#34; stroke-linejoin=&#34;round&#34; fill=&#34;none&#34;/%3E%3C/g%3E%3Ctext x=&#34;100&#34; y=&#34;270&#34; font-family=&#34;Arial&#34; font-size=&#34;12&#34; fill=&#34;%239CA3AF&#34; text-anchor=&#34;middle&#34;%3Eæš‚æ— æµ·æŠ¥%3C/text%3E%3C/svg%3E&#39;;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=l>setIsLoading(true);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>}<span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=ä¸ºè±†ç“£æ·»åŠ 2026å¹´çš„ç­›é€‰é€‰é¡¹>ä¸ºè±†ç“£æ·»åŠ 2026å¹´çš„ç­›é€‰é€‰é¡¹</h2><p><code>src/components/MultiLevelSelector.tsx</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       options: [
</span></span><span class=line><span class=cl>         { label: &#39;å…¨éƒ¨&#39;, value: &#39;all&#39; },
</span></span><span class=line><span class=cl>         { label: &#39;2020å¹´ä»£&#39;, value: &#39;2020s&#39; },
</span></span><span class=line><span class=cl><span class=gi>+        { label: &#39;2026&#39;, value: &#39;2026&#39; },
</span></span></span><span class=line><span class=cl>         { label: &#39;2025&#39;, value: &#39;2025&#39; },
</span></span><span class=line><span class=cl>         { label: &#39;2024&#39;, value: &#39;2024&#39; },
</span></span></code></pre></td></tr></table></div></div><h2 id=æ’­æ”¾æºæ’åº>æ’­æ”¾æºæ’åº</h2><p>é—®<a class=link href=https://gemini.google.com/app target=_blank rel=noopener>gemini</a>ï¼š</p><p>â€œæˆ‘æƒ³ä¿®æ”¹ <code>page.tsx</code> é‡Œçš„æ’­æ”¾é€»è¾‘ï¼Œå®ç°â€˜æ— æ„ŸçŸ¥ä¼˜é€‰â€™ã€‚ <strong>è¯¦ç»†é€»è¾‘ï¼š</strong></p><ol><li><strong>èµ·æ’­ç­–ç•¥ï¼š</strong><ul><li><strong>æœ‰æŒ‡å®šæºï¼š</strong> ç«‹å³èµ·æ’­ï¼Œä¸æ˜¾ç¤ºæµ‹é€ŸåŠ è½½åŠ¨ç”»ã€‚</li><li><strong>æ— æŒ‡å®šæºï¼š</strong> å…è®¸æ˜¾ç¤ºçŸ­æš‚åŠ è½½ï¼ˆå¦‚ 2 ç§’ï¼‰ï¼Œæµ‹é€Ÿå®Œæˆåè‡ªåŠ¨æ’­æ”¾è¯„åˆ†æœ€é«˜çš„æºã€‚</li></ul></li><li><strong>åå°é€»è¾‘ï¼š</strong> æ— è®ºå“ªç§æƒ…å†µï¼Œèµ·æ’­åéƒ½è¦åœ¨åå°æŒç»­å®Œæˆæ‰€æœ‰æºçš„å¹¶å‘æµ‹é€Ÿã€‚</li><li><strong>UI æ’åºï¼š</strong> æµ‹é€Ÿç»“æŸåï¼Œä¾§è¾¹æ åˆ—è¡¨æŒ‰è¯„åˆ†ï¼ˆé€Ÿåº¦+åˆ†è¾¨ç‡ï¼‰é™åºæ’åˆ—ã€‚</li><li><strong>ç½®é¡¶ä¿æŠ¤ï¼š</strong> æ›´æ–°åˆ—è¡¨æ—¶ï¼Œå½“å‰æ­£åœ¨æ’­æ”¾çš„æºå¿…é¡»é”å®šåœ¨ç¬¬ä¸€ä½ï¼Œå…¶ä½™æºæŒ‰è¯„åˆ†æ’åºï¼Œé˜²æ­¢ UI é—ªçƒæˆ–é”™ä½ã€‚ <strong>æ–‡ä»¶ï¼š</strong> [ä¸Šä¼  page.tsx]â€</li></ol><h2 id=å±è”½æ¯æ—¥æ”¾é€è°ƒæ•´é¦–é¡µ>å±è”½æ¯æ—¥æ”¾é€ï¼Œè°ƒæ•´é¦–é¡µ</h2><p>ç”¨<a class=link href=https://grok.com/ target=_blank rel=noopener>grok</a>ï¼Œå‡†å¤‡3ä¸ªæ–‡ä»¶ï¼Œindex.page.tsxã€douban.page.tsxã€DoubanSelector.tsxï¼Œ<strong>è‡ªå·±æé—®ï¼š</strong></p><p>1.å±è”½åŠ¨æ¼«é¡µé¢ä¸‹â€œæ¯æ—¥æ”¾é€â€åˆ†ç±» 2.å°†é¦–é¡µâ€œæ¯æ—¥æ”¾é€â€æ”¹ä¸ºâ€œçƒ­é—¨ç•ªå‰§â€ï¼Œæ˜¾ç¤ºâ€œç•ªå‰§â€åˆ†ç±»ä¸‹â€œè¿‘æœŸçƒ­åº¦â€å†…å®¹ 3.å°†é¦–é¡µâ€œçƒ­é—¨ç”µå½±â€æ˜¾ç¤ºå†…å®¹æ”¹ä¸ºâ€œç”µå½±â€å…¨éƒ¨åˆ†ç±»ä¸‹çš„â€œè¿‘æœŸçƒ­åº¦â€ 4.å°†é¦–é¡µâ€œçƒ­é—¨å‰§é›†â€æ˜¾ç¤ºå†…å®¹æ”¹ä¸ºâ€œå‰§é›†â€å…¨éƒ¨åˆ†ç±»ä¸‹çš„â€œè¿‘æœŸçƒ­åº¦â€ 4.å°†é¦–é¡µâ€œçƒ­é—¨ç»¼è‰ºâ€æ˜¾ç¤ºå†…å®¹æ”¹ä¸ºâ€œç»¼è‰ºâ€å…¨éƒ¨åˆ†ç±»ä¸‹çš„â€œè¿‘æœŸçƒ­åº¦â€ ç»™æˆ‘å®Œæ•´ä»£ç </p><p><strong>AIæé—®ï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>è¯·å¸®æˆ‘ä¿®æ”¹ä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶ï¼Œå®ç°ä»¥ä¸‹å…·ä½“éœ€æ±‚ï¼š
</span></span><span class=line><span class=cl>1. é¦–é¡µ index.page.tsxï¼šæ¯ä¸ªæ¿å—ï¼ˆçƒ­é—¨ç”µå½±ã€çƒ­é—¨å‰§é›†ã€çƒ­é—¨ç•ªå‰§ã€çƒ­é—¨ç»¼è‰ºï¼‰æ˜¾ç¤º18å¼ è¿‘æœŸçƒ­åº¦ï¼ˆsort=Uï¼‰çš„è±†ç“£æ¨èå½±ç‰‡ï¼Œå»æ‰åŸæ¥çš„ .slice(0,8)
</span></span><span class=line><span class=cl>2. douban.page.tsxï¼šåŠ¨æ¼«é¡µé¢å½»åº•ç§»é™¤â€œæ¯æ—¥æ”¾é€â€ï¼Œé»˜è®¤é€‰ä¸­â€œç•ªå‰§â€
</span></span><span class=line><span class=cl>3. DoubanSelector.tsxï¼šä¿®å¤ React 19 çš„ ref ç±»å‹é”™è¯¯ï¼ˆref å›è°ƒè¿”å› voidï¼‰
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>è¯·ç»™å‡ºæ¯ä¸ªæ–‡ä»¶çš„**å®Œæ•´ä¿®æ”¹åä»£ç **ï¼Œä¸è¦çœç•¥ï¼Œä¸è¦åªç»™ diffã€‚
</span></span></code></pre></td></tr></table></div></div><h2 id=ä¿®å¤æ”¶è—ä¸æ˜¾ç¤ºæ¸…ç©ºäºŒæ¬¡ç¡®è®¤>ä¿®å¤æ”¶è—ä¸æ˜¾ç¤ºã€æ¸…ç©ºäºŒæ¬¡ç¡®è®¤</h2><h3 id=ä¿®å¤æ”¶è—ä¸æ˜¾ç¤º>ä¿®å¤æ”¶è—ä¸æ˜¾ç¤º</h3><p>ä¸Šä¼ old.page.tsxå’Œnew.page.tsxä¸¤ä¸ªæ–‡ä»¶ï¼Œæé—®<a class=link href=https://gemini.google.com/app target=_blank rel=noopener>gemini</a>ï¼š<strong>old.page.tsxæ”¹æˆnew.page.tsxï¼Œæ”¶è—å¤¹å†…å®¹æ— æ³•æ­£ç¡®æ˜¾ç¤º</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=cm>/* eslint-disable @typescript-eslint/no-explicit-any, react-hooks/exhaustive-deps, no-console */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s1>&#39;use client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ChevronRight</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;lucide-react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Link</span> <span class=kr>from</span> <span class=s1>&#39;next/link&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Suspense</span><span class=p>,</span> <span class=nx>useEffect</span><span class=p>,</span> <span class=nx>useState</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- API Imports ---
</span></span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>BangumiCalendarData</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>GetBangumiCalendarData</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@/lib/bangumi.client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>clearAllFavorites</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>getAllFavorites</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>getAllPlayRecords</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>subscribeToDataUpdates</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@/lib/db.client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>getDoubanRecommends</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@/lib/douban.client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>DoubanItem</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@/lib/types&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- Component Imports ---
</span></span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>CapsuleSwitch</span> <span class=kr>from</span> <span class=s1>&#39;@/components/CapsuleSwitch&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ContinueWatching</span> <span class=kr>from</span> <span class=s1>&#39;@/components/ContinueWatching&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>DecoTVFooterCard</span> <span class=kr>from</span> <span class=s1>&#39;@/components/DecoTVFooterCard&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>PageLayout</span> <span class=kr>from</span> <span class=s1>&#39;@/components/PageLayout&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ScrollableRow</span> <span class=kr>from</span> <span class=s1>&#39;@/components/ScrollableRow&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useSite</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@/components/SiteProvider&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>VideoCard</span> <span class=kr>from</span> <span class=s1>&#39;@/components/VideoCard&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- Interfaces ---
</span></span></span><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>FavoriteItem</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>id</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>source</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>poster</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>episodes</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>source_name</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>currentEpisode?</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>search_title?</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>origin</span><span class=o>?:</span> <span class=s1>&#39;vod&#39;</span> <span class=o>|</span> <span class=s1>&#39;live&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>year?</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>HomeClient() {</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>activeTab</span><span class=p>,</span> <span class=nx>setActiveTab</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=o>&lt;</span><span class=s1>&#39;home&#39;</span> <span class=o>|</span> <span class=s1>&#39;favorites&#39;</span><span class=o>&gt;</span><span class=p>(</span><span class=s1>&#39;home&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>hotMovies</span><span class=p>,</span> <span class=nx>setHotMovies</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>DoubanItem</span><span class=err>[]</span><span class=p>&gt;([]);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>hotTvShows</span><span class=p>,</span> <span class=nx>setHotTvShows</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>DoubanItem</span><span class=err>[]</span><span class=p>&gt;([]);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>hotVarietyShows</span><span class=p>,</span> <span class=nx>setHotVarietyShows</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>DoubanItem</span><span class=err>[]</span><span class=p>&gt;([]);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>hotAnimes</span><span class=p>,</span> <span class=nx>setHotAnimes</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>DoubanItem</span><span class=err>[]</span><span class=p>&gt;([]);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>loading</span><span class=p>,</span> <span class=nx>setLoading</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>siteName</span><span class=p>,</span> <span class=nx>announcement</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useSite</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>showAnnouncement</span><span class=p>,</span> <span class=nx>setShowAnnouncement</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>favoriteItems</span><span class=p>,</span> <span class=nx>setFavoriteItems</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>FavoriteItem</span><span class=err>[]</span><span class=p>&gt;([]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Announcement Logic
</span></span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nb>window</span> <span class=o>!==</span> <span class=s1>&#39;undefined&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>announcement</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>hasSeen</span> <span class=o>=</span> <span class=nx>localStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s1>&#39;hasSeenAnnouncement&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>hasSeen</span> <span class=o>!==</span> <span class=nx>announcement</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setShowAnnouncement</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>[</span><span class=nx>announcement</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Data Fetching Logic
</span></span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fetchAllData</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setLoading</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>[</span><span class=nx>moviesRes</span><span class=p>,</span> <span class=nx>tvRes</span><span class=p>,</span> <span class=nx>varietyRes</span><span class=p>,</span> <span class=nx>animeRes</span><span class=p>,</span> <span class=nx>bangumiRes</span><span class=p>]</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>([</span>
</span></span><span class=line><span class=cl>          <span class=nx>getDoubanRecommends</span><span class=p>({</span> <span class=nx>kind</span><span class=o>:</span> <span class=s1>&#39;movie&#39;</span><span class=p>,</span> <span class=nx>pageLimit</span>: <span class=kt>20</span><span class=p>,</span> <span class=nx>sort</span><span class=o>:</span> <span class=s1>&#39;U&#39;</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>          <span class=nx>getDoubanRecommends</span><span class=p>({</span> <span class=nx>kind</span><span class=o>:</span> <span class=s1>&#39;tv&#39;</span><span class=p>,</span> <span class=nx>pageLimit</span>: <span class=kt>20</span><span class=p>,</span> <span class=nx>format</span><span class=o>:</span> <span class=s1>&#39;ç”µè§†å‰§&#39;</span><span class=p>,</span> <span class=nx>sort</span><span class=o>:</span> <span class=s1>&#39;U&#39;</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>          <span class=nx>getDoubanRecommends</span><span class=p>({</span> <span class=nx>kind</span><span class=o>:</span> <span class=s1>&#39;tv&#39;</span><span class=p>,</span> <span class=nx>pageLimit</span>: <span class=kt>20</span><span class=p>,</span> <span class=nx>format</span><span class=o>:</span> <span class=s1>&#39;ç»¼è‰º&#39;</span><span class=p>,</span> <span class=nx>sort</span><span class=o>:</span> <span class=s1>&#39;U&#39;</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>          <span class=nx>getDoubanRecommends</span><span class=p>({</span> <span class=nx>kind</span><span class=o>:</span> <span class=s1>&#39;tv&#39;</span><span class=p>,</span> <span class=nx>pageLimit</span>: <span class=kt>20</span><span class=p>,</span> <span class=nx>category</span><span class=o>:</span> <span class=s1>&#39;åŠ¨ç”»&#39;</span><span class=p>,</span> <span class=nx>format</span><span class=o>:</span> <span class=s1>&#39;ç”µè§†å‰§&#39;</span><span class=p>,</span> <span class=nx>sort</span><span class=o>:</span> <span class=s1>&#39;U&#39;</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>          <span class=nx>GetBangumiCalendarData</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>moviesRes</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=nx>setHotMovies</span><span class=p>(</span><span class=nx>moviesRes</span><span class=p>.</span><span class=nx>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>tvRes</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=nx>setHotTvShows</span><span class=p>(</span><span class=nx>tvRes</span><span class=p>.</span><span class=nx>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>varietyRes</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=nx>setHotVarietyShows</span><span class=p>(</span><span class=nx>varietyRes</span><span class=p>.</span><span class=nx>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>animeRes</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=nx>setHotAnimes</span><span class=p>(</span><span class=nx>animeRes</span><span class=p>.</span><span class=nx>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Fetch Error:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nx>fetchAllData</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Favorites Management
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>updateFavoriteItems</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>allFavorites</span>: <span class=kt>Record</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>,</span> <span class=na>any</span><span class=p>&gt;)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>allPlayRecords</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>getAllPlayRecords</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>sorted</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>allFavorites</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>sort</span><span class=p>(([,</span> <span class=nx>a</span><span class=p>],</span> <span class=p>[,</span> <span class=nx>b</span><span class=p>])</span> <span class=o>=&gt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>save_time</span> <span class=o>-</span> <span class=nx>a</span><span class=p>.</span><span class=nx>save_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>map</span><span class=p>(([</span><span class=nx>key</span><span class=p>,</span> <span class=nx>fav</span><span class=p>])</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>plusIndex</span> <span class=o>=</span> <span class=nx>key</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s1>&#39;+&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>source</span> <span class=o>=</span> <span class=nx>key</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nx>plusIndex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>key</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=nx>plusIndex</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>playRecord</span> <span class=o>=</span> <span class=nx>allPlayRecords</span><span class=p>[</span><span class=nx>key</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>source</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span>: <span class=kt>fav.title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>year</span>: <span class=kt>fav.year</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>poster</span>: <span class=kt>fav.cover</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>episodes</span>: <span class=kt>fav.total_episodes</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>source_name</span>: <span class=kt>fav.source_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>currentEpisode</span>: <span class=kt>playRecord?.index</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>search_title</span>: <span class=kt>fav?.search_title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>origin</span>: <span class=kt>fav?.origin</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=kr>as</span> <span class=nx>FavoriteItem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>setFavoriteItems</span><span class=p>(</span><span class=nx>sorted</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>activeTab</span> <span class=o>!==</span> <span class=s1>&#39;favorites&#39;</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>loadFavorites</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>allFavorites</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>getAllFavorites</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>await</span> <span class=nx>updateFavoriteItems</span><span class=p>(</span><span class=nx>allFavorites</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nx>loadFavorites</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>unsubscribe</span> <span class=o>=</span> <span class=nx>subscribeToDataUpdates</span><span class=p>(</span><span class=s1>&#39;favoritesUpdated&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>newFavs</span>: <span class=kt>any</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>updateFavoriteItems</span><span class=p>(</span><span class=nx>newFavs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>unsubscribe</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>[</span><span class=nx>activeTab</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>handleCloseAnnouncement</span> <span class=o>=</span> <span class=p>(</span><span class=nx>msg</span>: <span class=kt>string</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setShowAnnouncement</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>localStorage</span><span class=p>.</span><span class=nx>setItem</span><span class=p>(</span><span class=s1>&#39;hasSeenAnnouncement&#39;</span><span class=p>,</span> <span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>PageLayout</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=cm>/* Header Visual Section */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;relative pt-20 pb-10 sm:pt-32 sm:pb-16 overflow-hidden&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-75 h-75 sm:w-150 sm:h-150 bg-purple-500/20 rounded-full blur-[80px] sm:blur-[120px] -z-10 pointer-events-none animate-pulse&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center justify-center text-center px-4&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;relative group&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-6xl sm:text-8xl font-black tracking-tighter deco-brand drop-shadow-2xl select-none transition-transform duration-500 group-hover:scale-105&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=nx>siteName</span> <span class=o>||</span> <span class=s1>&#39;DecoTV&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;absolute -inset-8 bg-gradient-to-r from-blue-500/20 via-purple-500/20 to-pink-500/20 blur-2xl -z-10 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mt-8 animate-fade-in-up&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;inline-flex items-center gap-3 px-6 py-2.5 rounded-full bg-white/50 dark:bg-black/30 backdrop-blur-md border border-white/20 dark:border-white/10 shadow-lg&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>span</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-base sm:text-lg font-medium text-gray-800 dark:text-gray-100&#34;</span><span class=p>&gt;</span><span class=err>å‘ç°</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>span</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>span</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-base sm:text-lg font-medium text-gray-800 dark:text-gray-100&#34;</span><span class=p>&gt;</span><span class=err>æ”¶è—</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>span</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>span</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-base sm:text-lg font-medium text-gray-800 dark:text-gray-100&#34;</span><span class=p>&gt;</span><span class=err>ç»§ç»­è§‚çœ‹</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;px-2 sm:px-10 py-4 sm:py-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-8 flex justify-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>CapsuleSwitch</span>
</span></span><span class=line><span class=cl>            <span class=na>options</span><span class=o>=</span><span class=p>{[{</span> <span class=nx>label</span><span class=o>:</span> <span class=s1>&#39;é¦–é¡µ&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=s1>&#39;home&#39;</span> <span class=p>},</span> <span class=p>{</span> <span class=nx>label</span><span class=o>:</span> <span class=s1>&#39;æ”¶è—å¤¹&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=s1>&#39;favorites&#39;</span> <span class=p>}]}</span>
</span></span><span class=line><span class=cl>            <span class=na>active</span><span class=o>=</span><span class=p>{</span><span class=nx>activeTab</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=na>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>v</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>setActiveTab</span><span class=p>(</span><span class=nx>v</span> <span class=kr>as</span> <span class=kt>any</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>          <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;max-w-[95%] mx-auto&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span><span class=nx>activeTab</span> <span class=o>===</span> <span class=s1>&#39;favorites&#39;</span> <span class=o>?</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>section</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-4 flex items-center justify-between&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-xl font-bold text-gray-800 dark:text-gray-200&#34;</span><span class=p>&gt;</span><span class=err>æˆ‘çš„æ”¶è—å¤¹</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=nx>favoriteItems</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>button</span> 
</span></span><span class=line><span class=cl>                    <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-sm text-gray-400 hover:text-red-500 transition-colors&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span> <span class=k>if</span><span class=p>(</span><span class=nx>confirm</span><span class=p>(</span><span class=s1>&#39;Clear all?&#39;</span><span class=p>))</span> <span class=p>{</span> <span class=k>await</span> <span class=nx>clearAllFavorites</span><span class=p>();</span> <span class=nx>setFavoriteItems</span><span class=p>([]);</span> <span class=p>}</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>                  <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=err>æ¸…ç©º</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>)}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;grid grid-cols-3 gap-x-2 gap-y-14 sm:grid-cols-[repeat(auto-fill,minmax(11rem,1fr))] sm:gap-x-8 sm:gap-y-20&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=nx>favoriteItems</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>VideoCard</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span> <span class=o>+</span> <span class=nx>item</span><span class=p>.</span><span class=nx>source</span><span class=p>}</span> <span class=na>query</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>search_title</span><span class=p>}</span> <span class=p>{</span><span class=na>...item</span><span class=p>}</span> <span class=na>from</span><span class=o>=</span><span class=s>&#34;favorite&#34;</span> <span class=na>type</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>episodes</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=o>?</span> <span class=s1>&#39;tv&#39;</span> <span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>))}</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=nx>favoriteItems</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;col-span-full text-center py-20 text-gray-400&#34;</span><span class=p>&gt;</span><span class=err>æš‚æ— æ”¶è—å†…å®¹</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>)</span> <span class=o>:</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>ContinueWatching</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=cm>/* 1. Movies */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>section</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-4 flex items-center justify-between&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-xl font-bold text-gray-800 dark:text-gray-200&#34;</span><span class=p>&gt;</span><span class=err>çƒ­é—¨ç”µå½±</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>Link</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/douban?type=movie&#34;</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;flex items-center text-sm text-gray-500 hover:text-gray-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=err>æŸ¥çœ‹æ›´å¤š</span> <span class=p>&lt;</span><span class=nt>ChevronRight</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-4 h-4 ml-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;/</span><span class=nt>Link</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span><span class=nx>loading</span> <span class=o>?</span> <span class=nb>Array</span><span class=p>.</span><span class=kr>from</span><span class=p>({</span> <span class=nx>length</span>: <span class=kt>12</span> <span class=p>}).</span><span class=nx>map</span><span class=p>((</span><span class=nx>_</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44 h-64 bg-gray-200 dark:bg-gray-800 animate-pulse rounded-lg&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))</span> <span class=o>:</span> <span class=nx>hotMovies</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>18</span><span class=p>).</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                      <span class=p>&lt;</span><span class=nt>VideoCard</span> <span class=na>from</span><span class=o>=</span><span class=s>&#34;douban&#34;</span> <span class=na>title</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span> <span class=na>poster</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>poster</span><span class=p>}</span> <span class=na>douban_id</span><span class=o>=</span><span class=p>{</span><span class=nb>Number</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=p>)}</span> <span class=na>rate</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>rate</span><span class=p>}</span> <span class=na>year</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>year</span><span class=p>}</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;movie&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))}</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=cm>/* 2. TV Shows */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>section</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-4 flex items-center justify-between&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-xl font-bold text-gray-800 dark:text-gray-200&#34;</span><span class=p>&gt;</span><span class=err>çƒ­é—¨å‰§é›†</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>Link</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/douban?type=tv&#34;</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;flex items-center text-sm text-gray-500 hover:text-gray-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=err>æŸ¥çœ‹æ›´å¤š</span> <span class=p>&lt;</span><span class=nt>ChevronRight</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-4 h-4 ml-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;/</span><span class=nt>Link</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span><span class=nx>loading</span> <span class=o>?</span> <span class=nb>Array</span><span class=p>.</span><span class=kr>from</span><span class=p>({</span> <span class=nx>length</span>: <span class=kt>12</span> <span class=p>}).</span><span class=nx>map</span><span class=p>((</span><span class=nx>_</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44 h-64 bg-gray-200 dark:bg-gray-800 animate-pulse rounded-lg&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))</span> <span class=o>:</span> <span class=nx>hotTvShows</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>18</span><span class=p>).</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                      <span class=p>&lt;</span><span class=nt>VideoCard</span> <span class=na>from</span><span class=o>=</span><span class=s>&#34;douban&#34;</span> <span class=na>title</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span> <span class=na>poster</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>poster</span><span class=p>}</span> <span class=na>douban_id</span><span class=o>=</span><span class=p>{</span><span class=nb>Number</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=p>)}</span> <span class=na>rate</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>rate</span><span class=p>}</span> <span class=na>year</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>year</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))}</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=cm>/* 3. Anime */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>section</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-4 flex items-center justify-between&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-xl font-bold text-gray-800 dark:text-gray-200&#34;</span><span class=p>&gt;</span><span class=err>çƒ­é—¨ç•ªå‰§</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>Link</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/douban?type=anime&#34;</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;flex items-center text-sm text-gray-500 hover:text-gray-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=err>æŸ¥çœ‹æ›´å¤š</span> <span class=p>&lt;</span><span class=nt>ChevronRight</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-4 h-4 ml-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;/</span><span class=nt>Link</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span><span class=nx>loading</span> <span class=o>?</span> <span class=nb>Array</span><span class=p>.</span><span class=kr>from</span><span class=p>({</span> <span class=nx>length</span>: <span class=kt>12</span> <span class=p>}).</span><span class=nx>map</span><span class=p>((</span><span class=nx>_</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44 h-64 bg-gray-200 dark:bg-gray-800 animate-pulse rounded-lg&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))</span> <span class=o>:</span> <span class=nx>hotAnimes</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>18</span><span class=p>).</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                      <span class=p>&lt;</span><span class=nt>VideoCard</span> <span class=na>from</span><span class=o>=</span><span class=s>&#34;douban&#34;</span> <span class=na>title</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span> <span class=na>poster</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>poster</span><span class=p>}</span> <span class=na>douban_id</span><span class=o>=</span><span class=p>{</span><span class=nb>Number</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=p>)}</span> <span class=na>rate</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>rate</span><span class=p>}</span> <span class=na>year</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>year</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))}</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=cm>/* 4. Variety Shows */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>section</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-4 flex items-center justify-between&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-xl font-bold text-gray-800 dark:text-gray-200&#34;</span><span class=p>&gt;</span><span class=err>çƒ­é—¨ç»¼è‰º</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>Link</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/douban?type=show&#34;</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;flex items-center text-sm text-gray-500 hover:text-gray-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=err>æŸ¥çœ‹æ›´å¤š</span> <span class=p>&lt;</span><span class=nt>ChevronRight</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-4 h-4 ml-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;/</span><span class=nt>Link</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span><span class=nx>loading</span> <span class=o>?</span> <span class=nb>Array</span><span class=p>.</span><span class=kr>from</span><span class=p>({</span> <span class=nx>length</span>: <span class=kt>12</span> <span class=p>}).</span><span class=nx>map</span><span class=p>((</span><span class=nx>_</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44 h-64 bg-gray-200 dark:bg-gray-800 animate-pulse rounded-lg&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))</span> <span class=o>:</span> <span class=nx>hotVarietyShows</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>18</span><span class=p>).</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                      <span class=p>&lt;</span><span class=nt>VideoCard</span> <span class=na>from</span><span class=o>=</span><span class=s>&#34;douban&#34;</span> <span class=na>title</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span> <span class=na>poster</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>poster</span><span class=p>}</span> <span class=na>douban_id</span><span class=o>=</span><span class=p>{</span><span class=nb>Number</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=p>)}</span> <span class=na>rate</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>rate</span><span class=p>}</span> <span class=na>year</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>year</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))}</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>DecoTVFooterCard</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>)}</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=cm>/* Announcement Modal */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nx>announcement</span> <span class=o>&amp;&amp;</span> <span class=nx>showAnnouncement</span> <span class=o>&amp;&amp;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-300&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-full max-w-md rounded-xl bg-white p-6 shadow-2xl dark:bg-gray-900 animate-in zoom-in-95 duration-300&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;flex justify-between items-start mb-4&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>h3</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 via-pink-400 to-indigo-500 border-b-2 border-purple-400 pb-1&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=err>ç³»ç»Ÿå…¬å‘Š</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>button</span> 
</span></span><span class=line><span class=cl>                <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=o>=&gt;</span> <span class=nx>handleCloseAnnouncement</span><span class=p>(</span><span class=nx>announcement</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>                <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-gray-400 hover:text-gray-600 transition-colors&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>svg</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-6 h-6&#34;</span> <span class=na>fill</span><span class=o>=</span><span class=s>&#34;none&#34;</span> <span class=na>stroke</span><span class=o>=</span><span class=s>&#34;currentColor&#34;</span> <span class=na>viewBox</span><span class=o>=</span><span class=s>&#34;0 0 24 24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>path</span> <span class=na>strokeLinecap</span><span class=o>=</span><span class=s>&#34;round&#34;</span> <span class=na>strokeLinejoin</span><span class=o>=</span><span class=s>&#34;round&#34;</span> <span class=na>strokeWidth</span><span class=o>=</span><span class=p>{</span><span class=mi>2</span><span class=p>}</span> <span class=na>d</span><span class=o>=</span><span class=s>&#34;M6 18L18 6M6 6l12 12&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>svg</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-6&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;relative overflow-hidden rounded-lg p-4 bg-gradient-to-r from-purple-50 via-pink-50 to-indigo-50 dark:from-purple-900/20 dark:via-pink-900/20 dark:to-indigo-900/20 shadow-inner&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;absolute inset-y-0 left-0 w-1 bg-gradient-to-b from-purple-500 to-indigo-500&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>p</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;ml-2 text-gray-700 dark:text-gray-200 leading-relaxed font-medium whitespace-pre-wrap&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span><span class=nx>announcement</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>              <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=o>=&gt;</span> <span class=nx>handleCloseAnnouncement</span><span class=p>(</span><span class=nx>announcement</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>              <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-full rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 py-3 text-white font-bold shadow-lg hover:opacity-90 active:scale-95 transition-all&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=err>æˆ‘çŸ¥é“äº†</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>)}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>PageLayout</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>Home() {</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>Suspense</span> <span class=na>fallback</span><span class=o>=</span><span class=p>{&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-h-screen flex items-center justify-center&#34;</span><span class=p>&gt;</span><span class=nx>Loading</span><span class=p>...&lt;/</span><span class=nt>div</span><span class=p>&gt;}&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>HomeClient</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>Suspense</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æ¸…ç©ºäºŒæ¬¡ç¡®è®¤>æ¸…ç©ºäºŒæ¬¡ç¡®è®¤</h3><ol><li>ä¿®æ”¹ç»§ç»­è§‚çœ‹ç»„ä»¶ (src/components/ContinueWatching.tsx)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=cm>/* eslint-disable no-console */</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;use client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useEffect</span><span class=p>,</span> <span class=nx>useState</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=kr>type</span> <span class=p>{</span> <span class=nx>PlayRecord</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@/lib/db.client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>clearAllPlayRecords</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>getAllPlayRecords</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>subscribeToDataUpdates</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@/lib/db.client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ScrollableRow</span> <span class=kr>from</span> <span class=s1>&#39;@/components/ScrollableRow&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>VideoCard</span> <span class=kr>from</span> <span class=s1>&#39;@/components/VideoCard&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>ContinueWatchingProps</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>className?</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>ContinueWatching</span><span class=p>({</span> <span class=nx>className</span> <span class=p>}</span><span class=o>:</span> <span class=nx>ContinueWatchingProps</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>playRecords</span><span class=p>,</span> <span class=nx>setPlayRecords</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nx>PlayRecord</span> <span class=o>&amp;</span> <span class=p>{</span> <span class=nx>key</span>: <span class=kt>string</span> <span class=p>})[]</span>
</span></span><span class=line><span class=cl>  <span class=o>&gt;</span><span class=p>([]);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>loading</span><span class=p>,</span> <span class=nx>setLoading</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// å¤„ç†æ’­æ”¾è®°å½•æ•°æ®æ›´æ–°çš„å‡½æ•°
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>updatePlayRecords</span> <span class=o>=</span> <span class=p>(</span><span class=nx>allRecords</span>: <span class=kt>Record</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>,</span> <span class=na>PlayRecord</span><span class=p>&gt;)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å°†è®°å½•è½¬æ¢ä¸ºæ•°ç»„å¹¶æ ¹æ® save_time ç”±è¿‘åˆ°è¿œæ’åº
</span></span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>recordsArray</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>allRecords</span><span class=p>).</span><span class=nx>map</span><span class=p>(([</span><span class=nx>key</span><span class=p>,</span> <span class=nx>record</span><span class=p>])</span> <span class=o>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=p>...</span><span class=nx>record</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æŒ‰ save_time é™åºæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
</span></span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>sortedRecords</span> <span class=o>=</span> <span class=nx>recordsArray</span><span class=p>.</span><span class=nx>sort</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>save_time</span> <span class=o>-</span> <span class=nx>a</span><span class=p>.</span><span class=nx>save_time</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>setPlayRecords</span><span class=p>(</span><span class=nx>sortedRecords</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fetchPlayRecords</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setLoading</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// ä»ç¼“å­˜æˆ–APIè·å–æ‰€æœ‰æ’­æ”¾è®°å½•
</span></span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>allRecords</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>getAllPlayRecords</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>updatePlayRecords</span><span class=p>(</span><span class=nx>allRecords</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;è·å–æ’­æ”¾è®°å½•å¤±è´¥:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>setPlayRecords</span><span class=p>([]);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fetchPlayRecords</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ä¿®å¤ç‚¹ï¼šæ˜¾å¼ä¸º allRecords æŒ‡å®šç±»å‹ Record&lt;string, PlayRecord&gt;
</span></span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>unsubscribe</span> <span class=o>=</span> <span class=nx>subscribeToDataUpdates</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;playRecordsUpdated&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nx>allRecords</span>: <span class=kt>Record</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>,</span> <span class=na>PlayRecord</span><span class=p>&gt;)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>updatePlayRecords</span><span class=p>(</span><span class=nx>allRecords</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>unsubscribe</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// å¦‚æœæ²¡æœ‰æ’­æ”¾è®°å½•ï¼Œåˆ™ä¸æ¸²æŸ“ç»„ä»¶
</span></span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>loading</span> <span class=o>&amp;&amp;</span> <span class=nx>playRecords</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// è®¡ç®—æ’­æ”¾è¿›åº¦ç™¾åˆ†æ¯”
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>getProgress</span> <span class=o>=</span> <span class=p>(</span><span class=nx>record</span>: <span class=kt>PlayRecord</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>record</span><span class=p>.</span><span class=nx>total_time</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=nx>record</span><span class=p>.</span><span class=nx>play_time</span> <span class=o>/</span> <span class=nx>record</span><span class=p>.</span><span class=nx>total_time</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ä» key ä¸­è§£æ source å’Œ id
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>parseKey</span> <span class=o>=</span> <span class=p>(</span><span class=nx>key</span>: <span class=kt>string</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>plusIndex</span> <span class=o>=</span> <span class=nx>key</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s1>&#39;+&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>source</span>: <span class=kt>key.substring</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nx>plusIndex</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=nx>id</span>: <span class=kt>key.substring</span><span class=p>(</span><span class=nx>plusIndex</span> <span class=o>+</span> <span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>section</span> <span class=na>className</span><span class=o>=</span><span class=p>{</span><span class=sb>`mb-8 </span><span class=si>${</span><span class=nx>className</span> <span class=o>||</span> <span class=s1>&#39;&#39;</span><span class=si>}</span><span class=sb>`</span><span class=p>}&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#39;mb-4 flex items-center justify-between&#39;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>className</span><span class=o>=</span><span class=s>&#39;text-xl font-bold text-gray-800 dark:text-gray-200&#39;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=err>ç»§ç»­è§‚çœ‹</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=o>!</span><span class=nx>loading</span> <span class=o>&amp;&amp;</span> <span class=nx>playRecords</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>            <span class=na>className</span><span class=o>=</span><span class=s>&#39;text-sm font-medium text-gray-500 hover:text-purple-600 dark:text-gray-400 dark:hover:text-purple-400 transition-colors&#39;</span>
</span></span><span class=line><span class=cl>            <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=c1>// æ·»åŠ ç¡®è®¤å¼¹çª—
</span></span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=p>(</span><span class=nx>confirm</span><span class=p>(</span><span class=s1>&#39;ç¡®å®šæ¸…ç©ºæ‰€æœ‰è§‚çœ‹è®°å½•å—ï¼Ÿ&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=nx>clearAllPlayRecords</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=nx>setPlayRecords</span><span class=p>([]);</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}}</span>
</span></span><span class=line><span class=cl>          <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=err>æ¸…ç©º</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>)}</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=nx>loading</span>
</span></span><span class=line><span class=cl>          <span class=o>?</span> <span class=nb>Array</span><span class=p>.</span><span class=kr>from</span><span class=p>({</span> <span class=nx>length</span>: <span class=kt>6</span> <span class=p>}).</span><span class=nx>map</span><span class=p>((</span><span class=nx>_</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>div</span>
</span></span><span class=line><span class=cl>                <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>index</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=na>className</span><span class=o>=</span><span class=s>&#39;min-w-24 w-24 sm:min-w-45 sm:w-44&#39;</span>
</span></span><span class=line><span class=cl>              <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#39;relative aspect-2/3 w-full overflow-hidden rounded-lg bg-gray-200 animate-pulse dark:bg-gray-800&#39;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#39;absolute inset-0 bg-gray-300 dark:bg-gray-700&#39;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#39;mt-2 h-4 bg-gray-200 rounded animate-pulse dark:bg-gray-800&#39;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#39;mt-1 h-3 bg-gray-200 rounded animate-pulse dark:bg-gray-800&#39;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>))</span>
</span></span><span class=line><span class=cl>          <span class=o>:</span> <span class=nx>playRecords</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>record</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=kr>const</span> <span class=p>{</span> <span class=nx>source</span><span class=p>,</span> <span class=nx>id</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>parseKey</span><span class=p>(</span><span class=nx>record</span><span class=p>.</span><span class=nx>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span>
</span></span><span class=line><span class=cl>                  <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>record</span><span class=p>.</span><span class=nx>key</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                  <span class=na>className</span><span class=o>=</span><span class=s>&#39;min-w-24 w-24 sm:min-w-45 sm:w-44&#39;</span>
</span></span><span class=line><span class=cl>                <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>VideoCard</span>
</span></span><span class=line><span class=cl>                    <span class=na>id</span><span class=o>=</span><span class=p>{</span><span class=nx>id</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=na>title</span><span class=o>=</span><span class=p>{</span><span class=nx>record</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=na>poster</span><span class=o>=</span><span class=p>{</span><span class=nx>record</span><span class=p>.</span><span class=nx>cover</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=na>year</span><span class=o>=</span><span class=p>{</span><span class=nx>record</span><span class=p>.</span><span class=nx>year</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=na>source</span><span class=o>=</span><span class=p>{</span><span class=nx>source</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=na>source_name</span><span class=o>=</span><span class=p>{</span><span class=nx>record</span><span class=p>.</span><span class=nx>source_name</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=na>progress</span><span class=o>=</span><span class=p>{</span><span class=nx>getProgress</span><span class=p>(</span><span class=nx>record</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>                    <span class=na>episodes</span><span class=o>=</span><span class=p>{</span><span class=nx>record</span><span class=p>.</span><span class=nx>total_episodes</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=na>currentEpisode</span><span class=o>=</span><span class=p>{</span><span class=nx>record</span><span class=p>.</span><span class=nx>index</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=na>query</span><span class=o>=</span><span class=p>{</span><span class=nx>record</span><span class=p>.</span><span class=nx>search_title</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=na>from</span><span class=o>=</span><span class=s>&#39;playrecord&#39;</span>
</span></span><span class=line><span class=cl>                    <span class=na>onDelete</span><span class=o>=</span><span class=p>{()</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>                      <span class=nx>setPlayRecords</span><span class=p>((</span><span class=nx>prev</span><span class=p>)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>                        <span class=nx>prev</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>r</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>r</span><span class=p>.</span><span class=nx>key</span> <span class=o>!==</span> <span class=nx>record</span><span class=p>.</span><span class=nx>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                      <span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=na>type</span><span class=o>=</span><span class=p>{</span><span class=nx>record</span><span class=p>.</span><span class=nx>total_episodes</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=o>?</span> <span class=s1>&#39;tv&#39;</span> <span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                  <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>})}</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>åŒæ­¥æ›´æ–°é¦–é¡µä»£ç  (src/app/page.tsx)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=cm>/* eslint-disable @typescript-eslint/no-explicit-any, react-hooks/exhaustive-deps, no-console */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s1>&#39;use client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>ChevronRight</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;lucide-react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Link</span> <span class=kr>from</span> <span class=s1>&#39;next/link&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Suspense</span><span class=p>,</span> <span class=nx>useEffect</span><span class=p>,</span> <span class=nx>useState</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- API Imports ---
</span></span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>clearAllFavorites</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>getAllFavorites</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>getAllPlayRecords</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>subscribeToDataUpdates</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@/lib/db.client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>getDoubanRecommends</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@/lib/douban.client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>DoubanItem</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@/lib/types&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- Component Imports ---
</span></span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>CapsuleSwitch</span> <span class=kr>from</span> <span class=s1>&#39;@/components/CapsuleSwitch&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ContinueWatching</span> <span class=kr>from</span> <span class=s1>&#39;@/components/ContinueWatching&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>DecoTVFooterCard</span> <span class=kr>from</span> <span class=s1>&#39;@/components/DecoTVFooterCard&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>PageLayout</span> <span class=kr>from</span> <span class=s1>&#39;@/components/PageLayout&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ScrollableRow</span> <span class=kr>from</span> <span class=s1>&#39;@/components/ScrollableRow&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useSite</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@/components/SiteProvider&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>VideoCard</span> <span class=kr>from</span> <span class=s1>&#39;@/components/VideoCard&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// --- Interfaces ---
</span></span></span><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>FavoriteItem</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>id</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>source</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>poster</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>episodes</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>source_name</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>currentEpisode?</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>search_title?</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>origin</span><span class=o>?:</span> <span class=s1>&#39;vod&#39;</span> <span class=o>|</span> <span class=s1>&#39;live&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>year?</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>HomeClient() {</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>activeTab</span><span class=p>,</span> <span class=nx>setActiveTab</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=o>&lt;</span><span class=s1>&#39;home&#39;</span> <span class=o>|</span> <span class=s1>&#39;favorites&#39;</span><span class=o>&gt;</span><span class=p>(</span><span class=s1>&#39;home&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>hotMovies</span><span class=p>,</span> <span class=nx>setHotMovies</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>DoubanItem</span><span class=err>[]</span><span class=p>&gt;([]);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>hotTvShows</span><span class=p>,</span> <span class=nx>setHotTvShows</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>DoubanItem</span><span class=err>[]</span><span class=p>&gt;([]);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>hotVarietyShows</span><span class=p>,</span> <span class=nx>setHotVarietyShows</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>DoubanItem</span><span class=err>[]</span><span class=p>&gt;([]);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>hotAnimes</span><span class=p>,</span> <span class=nx>setHotAnimes</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>DoubanItem</span><span class=err>[]</span><span class=p>&gt;([]);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>loading</span><span class=p>,</span> <span class=nx>setLoading</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>siteName</span><span class=p>,</span> <span class=nx>announcement</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useSite</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>showAnnouncement</span><span class=p>,</span> <span class=nx>setShowAnnouncement</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>favoriteItems</span><span class=p>,</span> <span class=nx>setFavoriteItems</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>FavoriteItem</span><span class=err>[]</span><span class=p>&gt;([]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Announcement logic
</span></span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nb>window</span> <span class=o>!==</span> <span class=s1>&#39;undefined&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>announcement</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>hasSeen</span> <span class=o>=</span> <span class=nx>localStorage</span><span class=p>.</span><span class=nx>getItem</span><span class=p>(</span><span class=s1>&#39;hasSeenAnnouncement&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>hasSeen</span> <span class=o>!==</span> <span class=nx>announcement</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setShowAnnouncement</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>[</span><span class=nx>announcement</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Data fetching logic
</span></span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fetchAllData</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setLoading</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>[</span><span class=nx>moviesRes</span><span class=p>,</span> <span class=nx>tvRes</span><span class=p>,</span> <span class=nx>varietyRes</span><span class=p>,</span> <span class=nx>animeRes</span><span class=p>]</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>([</span>
</span></span><span class=line><span class=cl>          <span class=nx>getDoubanRecommends</span><span class=p>({</span> <span class=nx>kind</span><span class=o>:</span> <span class=s1>&#39;movie&#39;</span><span class=p>,</span> <span class=nx>pageLimit</span>: <span class=kt>20</span><span class=p>,</span> <span class=nx>sort</span><span class=o>:</span> <span class=s1>&#39;U&#39;</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>          <span class=nx>getDoubanRecommends</span><span class=p>({</span> <span class=nx>kind</span><span class=o>:</span> <span class=s1>&#39;tv&#39;</span><span class=p>,</span> <span class=nx>pageLimit</span>: <span class=kt>20</span><span class=p>,</span> <span class=nx>format</span><span class=o>:</span> <span class=s1>&#39;é¢ä½ƒî‹é“?, sort: &#39;</span><span class=nx>U</span><span class=s1>&#39; }),
</span></span></span><span class=line><span class=cl><span class=s1>          getDoubanRecommends({ kind: &#39;</span><span class=nx>tv</span><span class=s1>&#39;, pageLimit: 20, format: &#39;</span><span class=err>ç¼è‰°å£“</span><span class=s1>&#39;, sort: &#39;</span><span class=nx>U</span><span class=s1>&#39; }),
</span></span></span><span class=line><span class=cl><span class=s1>          getDoubanRecommends({ kind: &#39;</span><span class=nx>tv</span><span class=s1>&#39;, pageLimit: 20, category: &#39;</span><span class=err>é”ã„§æ•¾</span><span class=s1>&#39;, format: &#39;</span><span class=err>é¢ä½ƒî‹é“</span><span class=o>?</span><span class=p>,</span> <span class=nx>sort</span><span class=o>:</span> <span class=s1>&#39;U&#39;</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>        <span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>moviesRes</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=nx>setHotMovies</span><span class=p>(</span><span class=nx>moviesRes</span><span class=p>.</span><span class=nx>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>tvRes</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=nx>setHotTvShows</span><span class=p>(</span><span class=nx>tvRes</span><span class=p>.</span><span class=nx>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>varietyRes</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=nx>setHotVarietyShows</span><span class=p>(</span><span class=nx>varietyRes</span><span class=p>.</span><span class=nx>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>animeRes</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=nx>setHotAnimes</span><span class=p>(</span><span class=nx>animeRes</span><span class=p>.</span><span class=nx>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Fetch Error:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nx>fetchAllData</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>[]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Sync favorites and play records
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>updateFavoriteItems</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>allFavorites</span>: <span class=kt>Record</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>,</span> <span class=na>any</span><span class=p>&gt;)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>allPlayRecords</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>getAllPlayRecords</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>sorted</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>allFavorites</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>sort</span><span class=p>(([,</span> <span class=nx>a</span><span class=p>],</span> <span class=p>[,</span> <span class=nx>b</span><span class=p>])</span> <span class=o>=&gt;</span> <span class=nx>b</span><span class=p>.</span><span class=nx>save_time</span> <span class=o>-</span> <span class=nx>a</span><span class=p>.</span><span class=nx>save_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>map</span><span class=p>(([</span><span class=nx>key</span><span class=p>,</span> <span class=nx>fav</span><span class=p>])</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>plusIndex</span> <span class=o>=</span> <span class=nx>key</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s1>&#39;+&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>source</span> <span class=o>=</span> <span class=nx>key</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nx>plusIndex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>key</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=nx>plusIndex</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>playRecord</span> <span class=o>=</span> <span class=nx>allPlayRecords</span><span class=p>[</span><span class=nx>key</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>source</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>title</span>: <span class=kt>fav.title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>year</span>: <span class=kt>fav.year</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>poster</span>: <span class=kt>fav.cover</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>episodes</span>: <span class=kt>fav.total_episodes</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>source_name</span>: <span class=kt>fav.source_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>currentEpisode</span>: <span class=kt>playRecord?.index</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>search_title</span>: <span class=kt>fav?.search_title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>origin</span>: <span class=kt>fav?.origin</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=kr>as</span> <span class=nx>FavoriteItem</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>setFavoriteItems</span><span class=p>(</span><span class=nx>sorted</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>useEffect</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>activeTab</span> <span class=o>!==</span> <span class=s1>&#39;favorites&#39;</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>loadFavorites</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>allFavorites</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>getAllFavorites</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>await</span> <span class=nx>updateFavoriteItems</span><span class=p>(</span><span class=nx>allFavorites</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nx>loadFavorites</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>unsubscribe</span> <span class=o>=</span> <span class=nx>subscribeToDataUpdates</span><span class=p>(</span><span class=s1>&#39;favoritesUpdated&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>newFavs</span>: <span class=kt>any</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>updateFavoriteItems</span><span class=p>(</span><span class=nx>newFavs</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>unsubscribe</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>[</span><span class=nx>activeTab</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>handleCloseAnnouncement</span> <span class=o>=</span> <span class=p>(</span><span class=nx>msg</span>: <span class=kt>string</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setShowAnnouncement</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>localStorage</span><span class=p>.</span><span class=nx>setItem</span><span class=p>(</span><span class=s1>&#39;hasSeenAnnouncement&#39;</span><span class=p>,</span> <span class=nx>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>PageLayout</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=cm>/* Visual Header Section */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;relative pt-20 pb-10 sm:pt-32 sm:pb-16 overflow-hidden&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-75 h-75 sm:w-150 sm:h-150 bg-purple-500/20 rounded-full blur-[80px] sm:blur-[120px] -z-10 pointer-events-none animate-pulse&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;flex flex-col items-center justify-center text-center px-4&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;relative group&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-6xl sm:text-8xl font-black tracking-tighter deco-brand drop-shadow-2xl select-none transition-transform duration-500 group-hover:scale-105&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=nx>siteName</span> <span class=o>||</span> <span class=s1>&#39;DecoTV&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;absolute -inset-8 bg-gradient-to-r from-blue-500/20 via-purple-500/20 to-pink-500/20 blur-2xl -z-10 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mt-8 animate-fade-in-up&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;inline-flex items-center gap-3 px-6 py-2.5 rounded-full bg-white/50 dark:bg-black/30 backdrop-blur-md border border-white/20 dark:border-white/10 shadow-lg&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>span</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-base sm:text-lg font-medium text-gray-800 dark:text-gray-100&#34;</span><span class=p>&gt;</span><span class=err>é™æˆ å¹‡</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>span</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>span</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-base sm:text-lg font-medium text-gray-800 dark:text-gray-100&#34;</span><span class=p>&gt;</span><span class=err>é€æƒ°æ£Œ</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>span</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-1 h-1 rounded-full bg-gray-300 dark:bg-gray-600&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>span</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-base sm:text-lg font-medium text-gray-800 dark:text-gray-100&#34;</span><span class=p>&gt;</span><span class=err>ç¼Ñ…ç”»ç‘™å‚œæ¹…</span><span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;px-2 sm:px-10 py-4 sm:py-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=cm>/* Tab Switcher */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-8 flex justify-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>CapsuleSwitch</span>
</span></span><span class=line><span class=cl>            <span class=na>options</span><span class=o>=</span><span class=p>{[{</span> <span class=nx>label</span><span class=o>:</span> <span class=s1>&#39;æ££æ ­ã€‰&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=o>:</span> <span class=s1>&#39;home&#39;</span> <span class=p>},</span> <span class=p>{</span> <span class=nx>label</span><span class=o>:</span> <span class=s1>&#39;é€æƒ°æ£Œæ¾¶?, value: &#39;</span><span class=nx>favorites</span><span class=s1>&#39; }]}
</span></span></span><span class=line><span class=cl><span class=s1>            active={activeTab}
</span></span></span><span class=line><span class=cl><span class=s1>            onChange={(v) =&gt; setActiveTab(v as any)}
</span></span></span><span class=line><span class=cl><span class=s1>          /&gt;
</span></span></span><span class=line><span class=cl><span class=s1>        &lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>        &lt;div className=&#34;max-w-[95%] mx-auto&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s1>          {activeTab === &#39;</span><span class=nx>favorites</span><span class=s1>&#39; ? (
</span></span></span><span class=line><span class=cl><span class=s1>            /* --- Favorites View --- */
</span></span></span><span class=line><span class=cl><span class=s1>            &lt;section className=&#34;mb-8&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s1>              &lt;div className=&#34;mb-4 flex items-center justify-between&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s1>                &lt;h2 className=&#34;text-xl font-bold text-gray-800 dark:text-gray-200&#34;&gt;é´æˆ æ®‘é€æƒ°æ£Œæ¾¶?/h2&gt;
</span></span></span><span class=line><span class=cl><span class=s1>                {favoriteItems.length &gt; 0 &amp;&amp; (
</span></span></span><span class=line><span class=cl><span class=s1>                  &lt;button 
</span></span></span><span class=line><span class=cl><span class=s1>                    className=&#34;text-sm font-medium text-gray-500 hover:text-purple-600 dark:text-gray-400 dark:hover:text-purple-400 transition-colors&#34;
</span></span></span><span class=line><span class=cl><span class=s1>                    onClick={async () =&gt; { 
</span></span></span><span class=line><span class=cl><span class=s1>                      if(confirm(&#39;</span><span class=err>çº­î†¼ç•¾å¨“å‘¯â”–éµâ‚¬éˆå¤‹æ•¹é’˜å¿šî†‡è¤°æ›æ‚§é”›</span><span class=o>?</span><span class=p>))</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>                        <span class=k>await</span> <span class=nx>clearAllFavorites</span><span class=p>();</span> 
</span></span><span class=line><span class=cl>                        <span class=nx>setFavoriteItems</span><span class=p>([]);</span> 
</span></span><span class=line><span class=cl>                      <span class=p>}</span> 
</span></span><span class=line><span class=cl>                    <span class=p>}}</span>
</span></span><span class=line><span class=cl>                  <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=err>å¨“å‘¯â”–</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>)}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;grid grid-cols-3 gap-x-2 gap-y-14 sm:grid-cols-[repeat(auto-fill,minmax(11rem,1fr))] sm:gap-x-8 sm:gap-y-20&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=nx>favoriteItems</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>VideoCard</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span> <span class=o>+</span> <span class=nx>item</span><span class=p>.</span><span class=nx>source</span><span class=p>}</span> <span class=na>query</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>search_title</span><span class=p>}</span> <span class=p>{</span><span class=na>...item</span><span class=p>}</span> <span class=na>from</span><span class=o>=</span><span class=s>&#34;favorite&#34;</span> <span class=na>type</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>episodes</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=o>?</span> <span class=s1>&#39;tv&#39;</span> <span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>))}</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span><span class=nx>favoriteItems</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;col-span-full text-center py-20 text-gray-400&#34;</span><span class=p>&gt;</span><span class=err>é†å‚›æ£¤é€æƒ°æ£Œéå‘­î†</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>)}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>)</span> <span class=o>:</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=cm>/* --- Home Sections --- */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>ContinueWatching</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=cm>/* 1. Movies */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>section</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-4 flex items-center justify-between&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-xl font-bold text-gray-800 dark:text-gray-200&#34;</span><span class=p>&gt;</span><span class=err>é‘î…¢æ£¬é¢é›å¥–</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>Link</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/douban?type=movie&#34;</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;flex items-center text-sm text-gray-500 hover:text-gray-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=err>éŒãƒ§æ¹…é‡æ‘î˜¿</span> <span class=p>&lt;</span><span class=nt>ChevronRight</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-4 h-4 ml-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;/</span><span class=nt>Link</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span><span class=nx>loading</span> <span class=o>?</span> <span class=nb>Array</span><span class=p>.</span><span class=kr>from</span><span class=p>({</span> <span class=nx>length</span>: <span class=kt>12</span> <span class=p>}).</span><span class=nx>map</span><span class=p>((</span><span class=nx>_</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44 h-64 bg-gray-200 dark:bg-gray-800 animate-pulse rounded-lg&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))</span> <span class=o>:</span> <span class=nx>hotMovies</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>18</span><span class=p>).</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                      <span class=p>&lt;</span><span class=nt>VideoCard</span> <span class=na>from</span><span class=o>=</span><span class=s>&#34;douban&#34;</span> <span class=na>title</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span> <span class=na>poster</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>poster</span><span class=p>}</span> <span class=na>douban_id</span><span class=o>=</span><span class=p>{</span><span class=nb>Number</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=p>)}</span> <span class=na>rate</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>rate</span><span class=p>}</span> <span class=na>year</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>year</span><span class=p>}</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;movie&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))}</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=cm>/* 2. TV Shows */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>section</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-4 flex items-center justify-between&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-xl font-bold text-gray-800 dark:text-gray-200&#34;</span><span class=p>&gt;</span><span class=err>é‘î…¢æ£¬é“Ñ‡æ³¦</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>Link</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/douban?type=tv&#34;</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;flex items-center text-sm text-gray-500 hover:text-gray-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=err>éŒãƒ§æ¹…é‡æ‘î˜¿</span> <span class=p>&lt;</span><span class=nt>ChevronRight</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-4 h-4 ml-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;/</span><span class=nt>Link</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span><span class=nx>loading</span> <span class=o>?</span> <span class=nb>Array</span><span class=p>.</span><span class=kr>from</span><span class=p>({</span> <span class=nx>length</span>: <span class=kt>12</span> <span class=p>}).</span><span class=nx>map</span><span class=p>((</span><span class=nx>_</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44 h-64 bg-gray-200 dark:bg-gray-800 animate-pulse rounded-lg&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))</span> <span class=o>:</span> <span class=nx>hotTvShows</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>18</span><span class=p>).</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                      <span class=p>&lt;</span><span class=nt>VideoCard</span> <span class=na>from</span><span class=o>=</span><span class=s>&#34;douban&#34;</span> <span class=na>title</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span> <span class=na>poster</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>poster</span><span class=p>}</span> <span class=na>douban_id</span><span class=o>=</span><span class=p>{</span><span class=nb>Number</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=p>)}</span> <span class=na>rate</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>rate</span><span class=p>}</span> <span class=na>year</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>year</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))}</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=cm>/* 3. Anime */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>section</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-4 flex items-center justify-between&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-xl font-bold text-gray-800 dark:text-gray-200&#34;</span><span class=p>&gt;</span><span class=err>é‘î…¢æ£¬é£î„å¢½</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>Link</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/douban?type=anime&#34;</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;flex items-center text-sm text-gray-500 hover:text-gray-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=err>éŒãƒ§æ¹…é‡æ‘î˜¿</span> <span class=p>&lt;</span><span class=nt>ChevronRight</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-4 h-4 ml-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;/</span><span class=nt>Link</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span><span class=nx>loading</span> <span class=o>?</span> <span class=nb>Array</span><span class=p>.</span><span class=kr>from</span><span class=p>({</span> <span class=nx>length</span>: <span class=kt>12</span> <span class=p>}).</span><span class=nx>map</span><span class=p>((</span><span class=nx>_</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44 h-64 bg-gray-200 dark:bg-gray-800 animate-pulse rounded-lg&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))</span> <span class=o>:</span> <span class=nx>hotAnimes</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>18</span><span class=p>).</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                      <span class=p>&lt;</span><span class=nt>VideoCard</span> <span class=na>from</span><span class=o>=</span><span class=s>&#34;douban&#34;</span> <span class=na>title</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span> <span class=na>poster</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>poster</span><span class=p>}</span> <span class=na>douban_id</span><span class=o>=</span><span class=p>{</span><span class=nb>Number</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=p>)}</span> <span class=na>rate</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>rate</span><span class=p>}</span> <span class=na>year</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>year</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))}</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=p>{</span><span class=cm>/* 4. Variety Shows */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>section</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-4 flex items-center justify-between&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>h2</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-xl font-bold text-gray-800 dark:text-gray-200&#34;</span><span class=p>&gt;</span><span class=err>é‘î…¢æ£¬ç¼è‰°å£“</span><span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>Link</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;/douban?type=show&#34;</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;flex items-center text-sm text-gray-500 hover:text-gray-700&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=err>éŒãƒ§æ¹…é‡æ‘î˜¿</span> <span class=p>&lt;</span><span class=nt>ChevronRight</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-4 h-4 ml-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;/</span><span class=nt>Link</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span><span class=nx>loading</span> <span class=o>?</span> <span class=nb>Array</span><span class=p>.</span><span class=kr>from</span><span class=p>({</span> <span class=nx>length</span>: <span class=kt>12</span> <span class=p>}).</span><span class=nx>map</span><span class=p>((</span><span class=nx>_</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44 h-64 bg-gray-200 dark:bg-gray-800 animate-pulse rounded-lg&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))</span> <span class=o>:</span> <span class=nx>hotVarietyShows</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>18</span><span class=p>).</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-w-24 w-24 sm:min-w-45 sm:w-44&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                      <span class=p>&lt;</span><span class=nt>VideoCard</span> <span class=na>from</span><span class=o>=</span><span class=s>&#34;douban&#34;</span> <span class=na>title</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span> <span class=na>poster</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>poster</span><span class=p>}</span> <span class=na>douban_id</span><span class=o>=</span><span class=p>{</span><span class=nb>Number</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>id</span><span class=p>)}</span> <span class=na>rate</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>rate</span><span class=p>}</span> <span class=na>year</span><span class=o>=</span><span class=p>{</span><span class=nx>item</span><span class=p>.</span><span class=nx>year</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>))}</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>ScrollableRow</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>section</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>DecoTVFooterCard</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>)}</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=cm>/* --- Announcement Modal --- */</span><span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nx>announcement</span> <span class=o>&amp;&amp;</span> <span class=nx>showAnnouncement</span> <span class=o>&amp;&amp;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-300&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-full max-w-md rounded-xl bg-white p-6 shadow-2xl dark:bg-gray-900 animate-in zoom-in-95 duration-300&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;flex justify-between items-start mb-4&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>h3</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 via-pink-400 to-indigo-500 border-b-2 border-purple-400 pb-1&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=err>ç»¯è¤ç²ºéî„€æ†¡</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>button</span> 
</span></span><span class=line><span class=cl>                <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=o>=&gt;</span> <span class=nx>handleCloseAnnouncement</span><span class=p>(</span><span class=nx>announcement</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>                <span class=na>className</span><span class=o>=</span><span class=s>&#34;text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>svg</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-6 h-6&#34;</span> <span class=na>fill</span><span class=o>=</span><span class=s>&#34;none&#34;</span> <span class=na>stroke</span><span class=o>=</span><span class=s>&#34;currentColor&#34;</span> <span class=na>viewBox</span><span class=o>=</span><span class=s>&#34;0 0 24 24&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>&lt;</span><span class=nt>path</span> <span class=na>strokeLinecap</span><span class=o>=</span><span class=s>&#34;round&#34;</span> <span class=na>strokeLinejoin</span><span class=o>=</span><span class=s>&#34;round&#34;</span> <span class=na>strokeWidth</span><span class=o>=</span><span class=p>{</span><span class=mi>2</span><span class=p>}</span> <span class=na>d</span><span class=o>=</span><span class=s>&#34;M6 18L18 6M6 6l12 12&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>svg</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;mb-6&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;relative overflow-hidden rounded-lg p-4 bg-gradient-to-r from-purple-50 via-pink-50 to-indigo-50 dark:from-purple-900/20 dark:via-pink-900/20 dark:to-indigo-900/20 shadow-inner&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;absolute inset-y-0 left-0 w-1 bg-gradient-to-b from-purple-500 to-indigo-500&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;</span><span class=nt>p</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;ml-2 text-gray-700 dark:text-gray-200 leading-relaxed font-medium whitespace-pre-wrap&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span><span class=nx>announcement</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>              <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=o>=&gt;</span> <span class=nx>handleCloseAnnouncement</span><span class=p>(</span><span class=nx>announcement</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>              <span class=na>className</span><span class=o>=</span><span class=s>&#34;w-full rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 py-3 text-white font-bold shadow-lg hover:opacity-90 active:scale-95 transition-all&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>              <span class=err>é´æˆ ç…¡é–¬æ’²ç°¡</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>)}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>PageLayout</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>Home() {</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>Suspense</span> <span class=na>fallback</span><span class=o>=</span><span class=p>{&lt;</span><span class=nt>div</span> <span class=na>className</span><span class=o>=</span><span class=s>&#34;min-h-screen flex items-center justify-center&#34;</span><span class=p>&gt;</span><span class=nx>Loading</span><span class=p>...&lt;/</span><span class=nt>div</span><span class=p>&gt;}&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>HomeClient</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>Suspense</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><p><strong>AIæé—®ï¼š</strong></p><p><strong>æ ‡é¢˜ï¼šå¼€å‘ [åŠŸèƒ½åç§°] ç»„ä»¶ï¼Œè¦æ±‚å®æ—¶æ•°æ®åŒæ­¥ä¸äº¤äº’ä¸€è‡´æ€§</strong></p><p><strong>1. åŠŸèƒ½èƒŒæ™¯ï¼š</strong> æˆ‘æ­£åœ¨ä½¿ç”¨ Next.js (App Router) å¼€å‘ä¸€ä¸ª [ä¾‹å¦‚ï¼šæ”¶è—å¤¹/æ’­æ”¾å†å²] æ¨¡å—ã€‚æ•°æ®å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„ [ä¾‹å¦‚ï¼šIndexedDB/localStorage] ä¸­ã€‚</p><p><strong>2. æ ¸å¿ƒé€»è¾‘è¦æ±‚ï¼š</strong></p><ul><li><strong>æ•°æ®è·å–ä¸æ’åº</strong>ï¼šåˆå§‹åŒ–æ—¶ä»æ•°æ®åº“è·å–æ‰€æœ‰è®°å½•ã€‚å¦‚æœè®°å½•ä¸­æœ‰ <code>save_time</code>ï¼Œè¯·æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰ã€‚</li><li><strong>å®æ—¶åŒæ­¥</strong>ï¼šå¿…é¡»ä½¿ç”¨ <code>subscribeToDataUpdates</code> è®¢é˜…æ¨¡å¼ã€‚å½“æ•°æ®åº“å‘ç”Ÿå˜åŒ–ï¼ˆå¦‚ <code>playRecordsUpdated</code> äº‹ä»¶ï¼‰æ—¶ï¼Œç»„ä»¶èƒ½è‡ªåŠ¨æ›´æ–°çŠ¶æ€ã€‚</li><li><strong>ç©ºçŠ¶æ€å¤„ç†</strong>ï¼šå¦‚æœæ•°æ®ä¸ºç©ºä¸”ä¸åœ¨åŠ è½½ä¸­ï¼Œåˆ™ä¸æ¸²æŸ“ä»»ä½•å†…å®¹ã€‚</li></ul><p><strong>3. äº¤äº’ä¸ UI è¦æ±‚ï¼š</strong></p><ul><li><strong>æ¸…ç©ºåŠŸèƒ½</strong>ï¼šåœ¨æ ‡é¢˜å³ä¾§æ·»åŠ ä¸€ä¸ªâ€œæ¸…ç©ºâ€æŒ‰é’®ï¼Œæ ·å¼å‚è€ƒ <code>text-gray-500 hover:text-purple-600</code>ã€‚</li><li><strong>äºŒæ¬¡ç¡®è®¤</strong>ï¼šç‚¹å‡»æ¸…ç©ºæ—¶ï¼Œå¿…é¡»å¼¹å‡º <code>confirm()</code> ç¡®è®¤æ¡†ï¼Œç”¨æˆ·ç¡®è®¤åå†æ‰§è¡Œæ¸…ç©ºæ•°æ®åº“å’Œæ›´æ–°çŠ¶æ€çš„æ“ä½œã€‚</li><li><strong>Skeleton åŠ è½½</strong>ï¼šåœ¨æ•°æ®åŠ è½½æœŸé—´ï¼Œæ˜¾ç¤ºå ä½åŠ¨ç”»ï¼ˆéª¨æ¶å±ï¼‰ï¼Œå¹¶ä¿æŒä¸åˆ—è¡¨é¡¹ç›¸åŒçš„å®¹å™¨å°ºå¯¸ã€‚</li></ul><p><strong>4. æŠ€æœ¯ç»†èŠ‚ä¸å®‰å…¨æ€§ï¼š</strong></p><ul><li><strong>TypeScript è§„èŒƒ</strong>ï¼šè¯·ç¡®ä¿æ‰€æœ‰å›è°ƒå‡½æ•°çš„å‚æ•°éƒ½æœ‰æ˜ç¡®çš„ç±»å‹å®šä¹‰ï¼Œç¦æ­¢ä½¿ç”¨ <code>any</code> æˆ– <code>unknown</code>ï¼ˆé¿å… Docker æ„å»ºæ—¶å‡ºç°ç±»å‹æ£€æŸ¥é”™è¯¯ï¼‰ã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šåœ¨ <code>useEffect</code> å¸è½½æ—¶ï¼Œå¿…é¡»è°ƒç”¨ <code>unsubscribe</code> å‡½æ•°é˜²æ­¢å†…å­˜æ³„æ¼ã€‚</li><li><strong>ä»£ç é£æ ¼</strong>ï¼šä½¿ç”¨ <code>client component</code> æ¨¡å¼ï¼Œç¦æ­¢ console æ—¥å¿—è¾“å‡ºã€‚</li></ul><p>ä¿®å¤åˆ†é¡µé€»è¾‘åŠ è½½ä¸å…¨</p><h2 id=ä¿®å¤åˆ†é¡µé€»è¾‘åŠ è½½ä¸å…¨>ä¿®å¤åˆ†é¡µé€»è¾‘åŠ è½½ä¸å…¨</h2><p>ä¸Šä¼ old.douban.page.tsxå’Œnew.douban.page.tsxï¼Œè¿˜æ˜¯é—®<a class=link href=https://gemini.google.com/app target=_blank rel=noopener>gemini</a>ï¼š</p><p>oldå¼€å¤´ä¸¤ä¸ªæ–‡ä»¶æ”¹æˆnewå¼€å¤´ä¸¤ä¸ªæ–‡ä»¶ï¼Œå‡ºç°ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š
1.ç”µå½±å…¨éƒ¨åˆ†ç±»ä¸‹é¢çš„â€œç»¼åˆæ’åºâ€åªèƒ½æ˜¾ç¤º6éƒ¨å½±ç‰‡ï¼Œå°±æ˜¾ç¤ºâ€œå·²åŠ è½½å…¨éƒ¨å†…å®¹â€
2.åŠ¨æ¼«å‰§åœºç‰ˆåˆ†ç±»ä¸‹é¢çš„â€œç»¼åˆæ’åºâ€ã€â€œè¿‘æœŸçƒ­åº¦â€ã€â€œé¦–æ˜ æ—¶é—´â€ã€â€œé«˜åˆ†ä¼˜å…ˆâ€åªèƒ½æ˜¾ç¤º24éƒ¨å½±ç‰‡ï¼Œå°±æ˜¾ç¤ºâ€œå·²åŠ è½½å…¨éƒ¨å†…å®¹â€</p><p>å°† <code>new.page.tsx</code> ä¸­çš„åˆ†é¡µé€»è¾‘æ”¹å›ä¸ <code>old.page.tsx</code> ä¸€è‡´çš„ <code>data.list.length !== 0</code>ã€‚</p><hr><p>ç­”ï¼šä½ éœ€è¦ä¿®æ”¹ <code>new.page.tsx</code> ä¸­çš„ä»¥ä¸‹ä¸¤å¤„ä»£ç ï¼š</p><ol><li><strong>ä¿®æ”¹é¦–å±åŠ è½½é€»è¾‘ (ç¬¬ 210-215 è¡Œå·¦å³)</strong></li></ol><p>åœ¨ <code>loadInitialData</code> å‡½æ•°ä¸­ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// new.page.tsx ä¿®æ”¹å‰
</span></span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isSnapshotEqual</span><span class=p>(</span><span class=nx>snapshot</span><span class=p>,</span> <span class=nx>currentParamsRef</span><span class=p>.</span><span class=nx>current</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setDoubanData</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setHasMore</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>list</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>25</span><span class=p>);</span> <span class=c1>//
</span></span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä¿®æ”¹å
</span></span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isSnapshotEqual</span><span class=p>(</span><span class=nx>snapshot</span><span class=p>,</span> <span class=nx>currentParamsRef</span><span class=p>.</span><span class=nx>current</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setDoubanData</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>list</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setHasMore</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>list</span><span class=p>.</span><span class=nx>length</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>);</span> <span class=c1>// æ”¹å›ä¸ old.page.tsx ä¸€è‡´
</span></span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li><strong>ä¿®æ”¹æ»šåŠ¨åŠ è½½é€»è¾‘ (ç¬¬ 270-275 è¡Œå·¦å³)</strong></li></ol><p>åœ¨ <code>fetchMore</code> å‡½æ•°ä¸­ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// new.page.tsx ä¿®æ”¹å‰
</span></span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isSnapshotEqual</span><span class=p>(</span><span class=nx>snapshot</span><span class=p>,</span> <span class=nx>currentParamsRef</span><span class=p>.</span><span class=nx>current</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setDoubanData</span><span class=p>(</span><span class=nx>prev</span> <span class=o>=&gt;</span> <span class=p>[...</span><span class=nx>prev</span><span class=p>,</span> <span class=p>...</span><span class=nx>data</span><span class=p>.</span><span class=nx>list</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setHasMore</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>list</span><span class=p>.</span><span class=nx>length</span> <span class=o>===</span> <span class=mi>25</span><span class=p>);</span> <span class=c1>//
</span></span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä¿®æ”¹å
</span></span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>code</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isSnapshotEqual</span><span class=p>(</span><span class=nx>snapshot</span><span class=p>,</span> <span class=nx>currentParamsRef</span><span class=p>.</span><span class=nx>current</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setDoubanData</span><span class=p>(</span><span class=nx>prev</span> <span class=o>=&gt;</span> <span class=p>[...</span><span class=nx>prev</span><span class=p>,</span> <span class=p>...</span><span class=nx>data</span><span class=p>.</span><span class=nx>list</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setHasMore</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>list</span><span class=p>.</span><span class=nx>length</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>);</span> <span class=c1>// æ”¹å›ä¸ old.page.tsx ä¸€è‡´
</span></span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>é¢„æœŸæ•ˆæœ</strong></p><ul><li><strong>ç”µå½±å…¨éƒ¨åˆ†ç±»</strong>ï¼šé¦–å±æ˜¾ç¤º 6 éƒ¨åï¼Œ<code>hasMore</code> ä¸º <code>true</code>ï¼Œç”¨æˆ·å‘ä¸‹æ»šåŠ¨ä¼šæ­£å¸¸è§¦å‘ä¸‹ä¸€é¡µè¯·æ±‚ã€‚</li><li><strong>åŠ¨æ¼«å‰§åœºç‰ˆ</strong>ï¼šæ˜¾ç¤º 24 éƒ¨åï¼Œä¸å†è¢«åˆ¤å®šä¸ºâ€œå·²å…¨éƒ¨åŠ è½½â€ï¼Œä¼šè‡ªåŠ¨å°è¯•è¯·æ±‚åç»­å†…å®¹ã€‚</li><li><strong>åœæ­¢æ¡ä»¶</strong>ï¼šåªæœ‰å½“ <code>data.list</code> å½»åº•ä¸ºç©ºæ—¶ï¼Œé¡µé¢åº•éƒ¨æ‰ä¼šæ˜¾ç¤ºâ€œå·²åŠ è½½å…¨éƒ¨å†…å®¹â€ã€‚</li></ul><h2 id=å»ç©ºæ ¼æœç´¢>å»ç©ºæ ¼æœç´¢</h2><p>æ–¹æ³•å¦‚ä¸Šï¼Œè¿˜æ˜¯é—®<a class=link href=https://gemini.google.com/app target=_blank rel=noopener>gemini</a>ï¼šï¼Œä¸Šä¼ <code>/src/app/api/search</code>ä¸‹é¢çš„5ä¸ªè·¯ç”±æ–‡ä»¶ï¼Œ<strong>æé—®</strong>ï¼š</p><p><strong>æ ‡é¢˜ï¼šè§£å†³åç«¯å­˜å‚¨ä¸å‰ç«¯æœç´¢å…³é”®è¯çš„â€œç©ºæ ¼ä¸æ•æ„Ÿâ€èšåˆé—®é¢˜</strong></p><p><strong>1. ç°çŠ¶æè¿°ï¼š</strong></p><blockquote><p>â€œæˆ‘çš„ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªè§†é¢‘æœç´¢åŠŸèƒ½ï¼Œåç«¯ä½¿ç”¨ Kvrocksï¼ˆå…¼å®¹ Redisï¼‰å­˜å‚¨ã€‚ç›®å‰å‘ç°ä¸€ä¸ª Bugï¼šå½“ç”¨æˆ·æœç´¢å¸¦ç©ºæ ¼çš„å…³é”®è¯ï¼ˆå¦‚â€˜å‰‘æ¥ ç¬¬äºŒå­£â€™ï¼‰å’Œä¸å¸¦ç©ºæ ¼çš„å…³é”®è¯ï¼ˆå¦‚â€˜å‰‘æ¥ç¬¬äºŒå­£â€™ï¼‰æ—¶ï¼Œè¿”å›çš„æ’­æ”¾æºæ•°é‡ä¸ä¸€è‡´ã€‚å¸¦ç©ºæ ¼çš„é“¾æ¥èƒ½æœåˆ°æ›´å¤šæºï¼Œè€Œæ— ç©ºæ ¼çš„é“¾æ¥æ¼æ‰äº†å¾ˆå¤šæºã€‚â€</p></blockquote><p><strong>2. æä¾›æ ¸å¿ƒä»£ç ï¼š</strong></p><blockquote><p>â€œè¿™æ˜¯æˆ‘å¤„ç†æœç´¢çš„æ ¸å¿ƒæ–‡ä»¶ï¼š</p><ul><li><code>route.ts</code> / <code>ws.route.ts</code>ï¼šè´Ÿè´£å‘èµ·æœç´¢è¯·æ±‚ã€‚</li><li><code>one.route.ts</code>ï¼šè´Ÿè´£åœ¨æ’­æ”¾é¡µç²¾å‡†åŒ¹é…ç‰¹å®šæºã€‚</li><li><code>suggestions.route.ts</code>ï¼šè´Ÿè´£æœç´¢å»ºè®®ã€‚ ï¼ˆæ­¤å¤„ç²˜è´´ä½ ä¹‹å‰çš„ä»£ç ç‰‡æ®µï¼‰â€</li></ul></blockquote><p><strong>3. æ˜ç¡®é€»è¾‘é¢„æœŸï¼š</strong></p><blockquote><p>â€œæˆ‘å¸Œæœ›å®ç°ä»¥ä¸‹æ•ˆæœï¼š</p><ul><li><strong>æœç´¢é˜¶æ®µ</strong>ï¼šæ— è®ºç”¨æˆ·è¾“å…¥æ˜¯å¦æœ‰ç©ºæ ¼ï¼Œéƒ½èƒ½åŒæ—¶æŸ¥è¯¢å¸¦ç©ºæ ¼å’Œä¸å¸¦ç©ºæ ¼çš„ Keyã€‚</li><li><strong>è¿‡æ»¤é˜¶æ®µ</strong>ï¼šåœ¨å¯¹æ¯”æ ‡é¢˜æ—¶ï¼Œè‡ªåŠ¨å¿½ç•¥ç©ºæ ¼å’Œå¤§å°å†™ï¼Œå®ç°â€˜è„±æ°´åŒ¹é…â€™ã€‚</li><li><strong>å±•ç¤ºé˜¶æ®µ</strong>ï¼šä¾ç„¶ä¿ç•™æ•°æ®åº“åŸå§‹çš„æ ‡é¢˜æ˜¾ç¤ºæ ¼å¼ï¼Œä¸è¦ä¿®æ”¹åŸå§‹æ•°æ®ã€‚</li></ul><p>è¯·å‘Šè¯‰æˆ‘ä¸ºäº†å®ç°è¿™ä¸ªâ€˜å…¨é“¾è·¯ç©ºæ ¼å®¹é”™â€™ï¼Œæˆ‘éœ€è¦åˆ†åˆ«ä¿®æ”¹è¿™å‡ ä¸ªæ–‡ä»¶çš„å“ªäº›ä½ç½®ï¼Ÿâ€</p></blockquote><h2 id=åŠ ç©ºæ ¼æœç´¢>åŠ ç©ºæ ¼æœç´¢</h2><p>æ–¹æ³•å¦‚ä¸Šï¼Œè¿˜æ˜¯é—®<a class=link href=https://gemini.google.com/app target=_blank rel=noopener>gemini</a>ï¼šï¼Œä¸Šä¼ <code>/src/app/api/search</code>ä¸‹é¢çš„5ä¸ªè·¯ç”±æ–‡ä»¶ï¼Œ<strong>æé—®</strong>ï¼š</p><p><strong>æç¤ºè¯ï¼š</strong> æˆ‘æ­£åœ¨ä¿®æ”¹ä¸€ä¸ªè§†é¢‘æœç´¢çš„ API é€»è¾‘ï¼Œä»£ç åœ¨ <code>route.ts</code> ä¸­ã€‚</p><p><strong>1. ä¸Šä¸‹æ–‡ï¼š</strong> > å½“å‰é€»è¾‘é€šè¿‡ <code>normalizedQuery</code> å’Œ <code>query</code> ç”Ÿæˆä¸€ä¸ª <code>searchQueries</code> æ•°ç»„è¿›è¡Œå¹¶å‘æœç´¢ã€‚</p><p><strong>2. æ ¸å¿ƒéœ€æ±‚ï¼š</strong> > æˆ‘éœ€è¦ä¼˜åŒ–æœç´¢å…³é”®è¯çš„ç”Ÿæˆé€»è¾‘ã€‚å¦‚æœç”¨æˆ·è¾“å…¥ç±»ä¼¼â€œå‰‘æ¥ç¬¬äºŒå­£â€è¿™ç§â€œåç§°+ç¬¬xå­£/éƒ¨â€çš„æ ‡é¢˜ï¼Œç³»ç»Ÿåº”è¯¥åŒæ—¶æœç´¢ä¸¤ä¸ªç‰ˆæœ¬ï¼š</p><ul><li><strong>åŸç‰ˆ/ç´§å‡‘ç‰ˆ</strong>ï¼šä¾‹å¦‚â€œå‰‘æ¥ç¬¬äºŒå­£â€</li><li><strong>å¸¦ç©ºæ ¼ç‰ˆæœ¬</strong>ï¼šä¾‹å¦‚â€œå‰‘æ¥ ç¬¬äºŒå­£â€</li></ul><p><strong>3. é€»è¾‘è¦æ±‚ï¼š</strong></p><ul><li>è¯·ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…â€œç¬¬[æ•°å­—]å­£/éƒ¨â€ã€‚</li><li>åŒæ—¶ä¿ç•™ç°æœ‰çš„â€œç©ºæ ¼åˆå¹¶â€é€»è¾‘ï¼ˆå°†å¸¦ç©ºæ ¼çš„è¯è½¬ä¸ºä¸å¸¦ç©ºæ ¼çš„è¯ï¼‰ã€‚</li><li>ä½¿ç”¨ <code>Set</code> æˆ– <code>includes</code> æ£€æŸ¥è¿›è¡Œå»é‡ï¼Œé˜²æ­¢é‡å¤æœç´¢ã€‚</li><li>ä¹Ÿè¦å¯¹åŸå§‹è¾“å…¥ï¼ˆ<code>query</code>ï¼‰å’Œç®€ä½“åŒ–è¾“å…¥ï¼ˆ<code>normalizedQuery</code>ï¼‰åŒæ—¶åšè¿™ç§å¤„ç†ã€‚</li></ul><p>è¯·ç»™å‡ºè¿™éƒ¨åˆ†é€»è¾‘çš„æ•´ä½“æ›¿æ¢ä»£ç ã€‚</p><hr><p><del>å¦‚æœä½ å¸Œæœ›æ•ˆæœæ›´å®Œç¾ï¼ˆåŒ…å«è”æƒ³è¯ï¼‰ï¼š</del></p><p><del>ä½ å¯ä»¥åœ¨æé—®æœ€ååŠ ä¸Šï¼š</del></p><blockquote><p><del>â€œåŒæ—¶ï¼Œè¯·å¸®æˆ‘ä¿®æ”¹ <code>suggestions.route.ts</code> çš„é€»è¾‘ï¼Œè®©æœç´¢å»ºè®®åœ¨è¿”å›ç»“æœæ—¶ï¼Œå¦‚æœå‘ç°åŒ¹é…å­£æ•°çš„å†…å®¹ï¼Œè‡ªåŠ¨è¡¥å…¨å¦ä¸€ç§ï¼ˆå¸¦ç©ºæ ¼æˆ–ä¸å¸¦ç©ºæ ¼ï¼‰çš„å»ºè®®é¡¹ã€‚â€</del></p></blockquote><h2 id=å»å†’å·æœç´¢>å»å†’å·æœç´¢</h2><p>ä¸Šä¼ <code>\src\app\api\search\route.ts</code>ã€<code>\src\app\api\search\ws\route.ts</code>ã€<code>\src\app\search\page.tsx</code>ã€<code>\src\app\play\page.tsx</code>å››ä¸ªæ–‡ä»¶ï¼Œé—®<a class=link href=https://gemini.google.com/app target=_blank rel=noopener>gemini</a>ï¼š</p><blockquote><p>â€œè¯·å¸®æˆ‘å¢å¼ºæœç´¢é€»è¾‘ã€‚å½“è¾“å…¥åŒ…å«<strong>å†’å·</strong>æˆ–<strong>å‰¯æ ‡é¢˜</strong>æ—¶ï¼Œå®ç°<strong>å»ç¬¦å·åŒ–æœç´¢</strong>ã€‚è¦æ±‚ï¼š</p><ul><li><strong>æ‹†åˆ†ç”Ÿæˆ</strong>ï¼šæå–å†’å·å‰åçš„å†…å®¹ï¼Œåˆ†åˆ«ç”Ÿæˆã€ä¸»æ ‡é¢˜+ç©ºæ ¼+å‰¯æ ‡é¢˜ã€ã€ã€ä¸»æ ‡é¢˜å‰¯æ ‡é¢˜ç´§å‡‘ç‰ˆã€ä»¥åŠã€ä»…å‰¯æ ‡é¢˜ç‰ˆã€è¿›è¡Œå¹¶å‘æœç´¢ã€‚</li><li><strong>å…¼å®¹ç¬¦å·</strong>ï¼šè‡ªåŠ¨å¤„ç†ä¸­è‹±æ–‡å†’å·äº’æ¢ï¼Œç¡®ä¿ä¸åŒèµ„æºç«™çš„å‘½åå·®å¼‚éƒ½èƒ½è¢«å¬å›ã€‚</li><li><strong>å‰ç«¯æ”¾å®½</strong>ï¼šä¿®æ”¹å‰ç«¯èšåˆè¿‡æ»¤é€»è¾‘ï¼Œä½¿å…¶å…è®¸åŒ¹é…å‰¯æ ‡é¢˜å­é¡¹ï¼Œé˜²æ­¢æœ‰æ•ˆç»“æœè¢«è¯¯æ€ã€‚</li><li><strong>æ— æ„ŸåŒ¹é…</strong>ï¼šåœ¨æ’­æ”¾é¡µæ¢æºæ—¶ï¼Œé€šè¿‡ã€å»é™¤ç¬¦å·æ¯”å¯¹ã€å®ç°æ ‡é¢˜çš„åŒ…å«å…³ç³»åŒ¹é…ï¼Œè€Œéç®€å•çš„å¼€å¤´åŒ¹é…ã€‚â€</li></ul></blockquote><hr><p>PSï¼šå¾ˆå¤šaiè®¤ä¸ºåªç”¨æ”¹å‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œåªæœ‰<a class=link href=https://claude.ai/new target=_blank rel=noopener>claude</a>å‘ç°ï¼š</p><p>çœ‹äº†å‰ç«¯ä»£ç ï¼ˆ<code>\src\app\search\page.tsx</code>ï¼‰,æˆ‘å‘ç°äº†ä¸€ä¸ªå…³é”®é—®é¢˜:<strong>å‰ç«¯çš„èšåˆé€»è¾‘ä¼šè¿‡æ»¤æ‰ä¸ç›¸å…³çš„ç»“æœ</strong>!</p><p><strong>é—®é¢˜åˆ†æ</strong></p><p>çœ‹è¿™æ®µä»£ç (ç¬¬215-267è¡Œ):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// è¿‡æ»¤:åªä¿ç•™æ ‡é¢˜ç›¸å…³çš„ç»“æœ
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>relevantResults</span> <span class=o>=</span> <span class=nx>searchResults</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>item</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>item</span><span class=p>.</span><span class=nx>title</span><span class=p>.</span><span class=nx>toLowerCase</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>titleNoSpace</span> <span class=o>=</span> <span class=nx>title</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\s+/g</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// åŒ…å«å®Œæ•´å…³é”®è¯ (æ£€æŸ¥åŸè¯å’Œè½¬æ¢åçš„è¯)
</span></span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>title</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>query</span><span class=p>)</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>    <span class=nx>titleNoSpace</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>queryNoSpace</span><span class=p>)</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>    <span class=nx>title</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>normQuery</span><span class=p>)</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>    <span class=nx>titleNoSpace</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>normQueryNoSpace</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ... å…¶ä»–æ¨¡ç³ŠåŒ¹é…é€»è¾‘
</span></span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>å½“ä½ æœç´¢ <code>é¬¼ç­ä¹‹åˆƒ:æ¸¸éƒ­ç¯‡</code> æ—¶:</p><ul><li><code>query</code> = <code>"é¬¼ç­ä¹‹åˆƒ:æ¸¸éƒ­ç¯‡"</code></li><li>åªæœ‰æ ‡é¢˜å®Œå…¨åŒ…å«è¿™ä¸ªå­—ç¬¦ä¸²çš„ç»“æœæ‰ä¼šé€šè¿‡è¿‡æ»¤</li><li>å…¶ä»–ç»“æœ(å¦‚åªæœ‰"é¬¼ç­ä¹‹åˆƒ"çš„)éƒ½è¢«è¿‡æ»¤æ‰äº†</li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><p>æˆ‘éœ€è¦ä¿®æ”¹å‰ç«¯çš„è¿‡æ»¤é€»è¾‘,è®©å®ƒèƒ½è¯†åˆ«<strong>å†’å·åˆ†éš”çš„æ ‡é¢˜</strong>ã€‚</p><p>è¯·é—®:ä½ å¸Œæœ›æˆ‘ä¿®æ”¹å‰ç«¯çš„ <code>page.tsx</code> æ¥é€‚é…å†’å·æœç´¢å—?è¿˜æ˜¯æœ‰å…¶ä»–æ–¹æ¡ˆ?</p><p>æˆ–è€…,ä½ å¯ä»¥å…ˆæµ‹è¯•:<strong>ç›´æ¥æœç´¢ <code>é¬¼ç­ä¹‹åˆƒ</code> (ä¸å¸¦å†’å·å’Œå‰¯æ ‡é¢˜)</strong>,çœ‹çœ‹æ˜¯å¦èƒ½æœåˆ°æ›´å¤šç»“æœã€‚è¿™æ ·å¯ä»¥ç¡®è®¤åç«¯çš„å¤šå…³é”®è¯æœç´¢æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p><hr><p>å½“geminiåªæ”¹ä¸¤ä¸ªæ–‡ä»¶æ—¶ï¼Œå°†ä¸Šè¿°æ–‡å­—ç»™å®ƒï¼Œæœ€ç»ˆç»™å‡ºæ–¹æ³•ã€‚</p><p>**ç­”ï¼š**ä¸ºäº†å®ç°æ‚¨è¦æ±‚çš„â€œå»å†’å·æœç´¢â€å¢å¼ºåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å¯¹åç«¯æœç´¢é€»è¾‘ã€å‰ç«¯æœç´¢é¡µé¢ï¼ˆèšåˆè¿‡æ»¤ï¼‰ä»¥åŠæ’­æ”¾é¡µé¢çš„æºè¿‡æ»¤é€»è¾‘è¿›è¡ŒåŒæ­¥å‡çº§ã€‚</p><p>ä»¥ä¸‹æ˜¯é’ˆå¯¹å››ä¸ªæ ¸å¿ƒæ–‡ä»¶çš„ä¿®æ”¹æ–¹æ¡ˆï¼š</p><h3 id=1-ä¿®æ”¹-apisearchroutets-åç«¯æ ‡å‡†æœç´¢>1. ä¿®æ”¹ <code>api/search/route.ts</code> (åç«¯æ ‡å‡†æœç´¢)</h3><p>åœ¨ <code>normalizedQuery</code> å¤„ç†ä¹‹åï¼Œç”Ÿæˆ <code>searchQueries</code> åˆ—è¡¨æ—¶åŠ å…¥å†’å·è§£æé€»è¾‘ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// ... åŸæœ‰ä»£ç  ...
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>searchQueries</span> <span class=o>=</span> <span class=p>[</span><span class=nx>normalizedQuery</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// âœ¨ æ–°å¢ï¼šå¤„ç†å†’å·é€»è¾‘ (å»å†’å·ã€å‰¯æ ‡é¢˜æå–)
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>colonRegex</span> <span class=o>=</span> <span class=sr>/[:ï¼š]/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>colonRegex</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>normalizedQuery</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>parts</span> <span class=o>=</span> <span class=nx>normalizedQuery</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=nx>colonRegex</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>p</span> <span class=o>=&gt;</span> <span class=nx>p</span><span class=p>.</span><span class=nx>trim</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>parts</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>mainTitle</span> <span class=o>=</span> <span class=nx>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>subTitle</span> <span class=o>=</span> <span class=nx>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 1. æ·»åŠ ç©ºæ ¼åˆ†éš”ç‰ˆæœ¬ (ä¾‹å¦‚: &#34;å‡¡äººä¿®ä»™ä¼  ä»™ç•Œç¯‡&#34;)
</span></span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>spaced</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>mainTitle</span><span class=si>}</span><span class=sb> </span><span class=si>${</span><span class=nx>subTitle</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>searchQueries</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>spaced</span><span class=p>))</span> <span class=nx>searchQueries</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>spaced</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 2. æ·»åŠ ç´§å¯†è¿æ¥ç‰ˆæœ¬ (ä¾‹å¦‚: &#34;å‡¡äººä¿®ä»™ä¼ ä»™ç•Œç¯‡&#34;)
</span></span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>combined</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>mainTitle</span><span class=si>}${</span><span class=nx>subTitle</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>searchQueries</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>combined</span><span class=p>))</span> <span class=nx>searchQueries</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>combined</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 3. æ·»åŠ ä»…å‰¯æ ‡é¢˜ (å¦‚æœé•¿åº¦ &gt;= 2)
</span></span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>subTitle</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;=</span> <span class=mi>2</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>searchQueries</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>subTitle</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>searchQueries</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>subTitle</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// 4. ç¬¦å·äº’æ¢ç‰ˆæœ¬ (å¦‚æœæ˜¯ä¸­æ–‡å†’å·åˆ™è¡¥ä¸€ä¸ªè‹±æ–‡å†’å·ç‰ˆï¼Œåä¹‹äº¦ç„¶)
</span></span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>swapped</span> <span class=o>=</span> <span class=nx>normalizedQuery</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=o>?</span> <span class=nx>normalizedQuery</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=s1>&#39;ï¼š&#39;</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=o>:</span> <span class=nx>normalizedQuery</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=s1>&#39;ï¼š&#39;</span><span class=p>,</span> <span class=s1>&#39;:&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>searchQueries</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>swapped</span><span class=p>))</span> <span class=nx>searchQueries</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>swapped</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ... åç»­åŸæœ‰çš„ seasonRegex å¤„ç†é€»è¾‘ä¿æŒä¸å˜ ...
</span></span></span></code></pre></td></tr></table></div></div><h3 id=2-ä¿®æ”¹-apisearchwsroutets-åç«¯æµå¼æœç´¢>2. ä¿®æ”¹ <code>api/search/ws/route.ts</code> (åç«¯æµå¼æœç´¢)</h3><p>åŒæ­¥ä¿®æ”¹æµå¼æœç´¢çš„å…³é”®è¯ç”Ÿæˆéƒ¨åˆ†ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// ... æ‰¾åˆ° searchQueries å®šä¹‰ä½ç½® ...
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>searchQueries</span> <span class=o>=</span> <span class=p>[</span><span class=nx>normalizedQuery</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// âœ¨ æ–°å¢ï¼šå¤„ç†å†’å·é€»è¾‘
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>colonRegex</span> <span class=o>=</span> <span class=sr>/[:ï¼š]/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>colonRegex</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>normalizedQuery</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>parts</span> <span class=o>=</span> <span class=nx>normalizedQuery</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=nx>colonRegex</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>p</span> <span class=o>=&gt;</span> <span class=nx>p</span><span class=p>.</span><span class=nx>trim</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>parts</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>mainTitle</span> <span class=o>=</span> <span class=nx>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>subTitle</span> <span class=o>=</span> <span class=nx>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>spaced</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>mainTitle</span><span class=si>}</span><span class=sb> </span><span class=si>${</span><span class=nx>subTitle</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>searchQueries</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>spaced</span><span class=p>))</span> <span class=nx>searchQueries</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>spaced</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>combined</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>mainTitle</span><span class=si>}${</span><span class=nx>subTitle</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>searchQueries</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>combined</span><span class=p>))</span> <span class=nx>searchQueries</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>combined</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>subTitle</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;=</span> <span class=mi>2</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>searchQueries</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>subTitle</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>searchQueries</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>subTitle</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>swapped</span> <span class=o>=</span> <span class=nx>normalizedQuery</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=o>?</span> <span class=nx>normalizedQuery</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=s1>&#39;ï¼š&#39;</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=o>:</span> <span class=nx>normalizedQuery</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=s1>&#39;ï¼š&#39;</span><span class=p>,</span> <span class=s1>&#39;:&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>searchQueries</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>swapped</span><span class=p>))</span> <span class=nx>searchQueries</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>swapped</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ... åç»­é€»è¾‘ ...
</span></span></span></code></pre></td></tr></table></div></div><h3 id=3-ä¿®æ”¹-searchpagetsx-å‰ç«¯èšåˆè¿‡æ»¤>3. ä¿®æ”¹ <code>search.page.tsx</code> (å‰ç«¯èšåˆè¿‡æ»¤)</h3><p>ä¿®æ”¹ <code>relevantResults</code> çš„è¿‡æ»¤é€»è¾‘ï¼Œé˜²æ­¢å‰¯æ ‡é¢˜ç»“æœåœ¨èšåˆæ¨¡å¼ä¸‹è¢«è¯¯æ€ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// æ‰¾åˆ° search.page.tsx ç¬¬ 215 è¡Œèµ·çš„ relevantResults å®šä¹‰
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>relevantResults</span> <span class=o>=</span> <span class=nx>searchResults</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>item</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>title</span> <span class=o>=</span> <span class=nx>item</span><span class=p>.</span><span class=nx>title</span><span class=p>.</span><span class=nx>toLowerCase</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>titleNoSpace</span> <span class=o>=</span> <span class=nx>title</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\s+/g</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// åŸºç¡€åŒ¹é…
</span></span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>title</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>query</span><span class=p>)</span> <span class=o>||</span> <span class=nx>titleNoSpace</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>queryNoSpace</span><span class=p>))</span> <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>normQuery</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=nx>title</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>normQuery</span><span class=p>)</span> <span class=o>||</span> <span class=nx>titleNoSpace</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>normQueryNoSpace</span><span class=p>)))</span> <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// âœ¨ æ–°å¢ï¼šå†’å·å­é¡¹åŒ¹é…
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>colonRegex</span> <span class=o>=</span> <span class=sr>/[:ï¼š]/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>colonRegex</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>query</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>parts</span> <span class=o>=</span> <span class=nx>query</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=nx>colonRegex</span><span class=p>).</span><span class=nx>map</span><span class=p>(</span><span class=nx>p</span> <span class=o>=&gt;</span> <span class=nx>p</span><span class=p>.</span><span class=nx>trim</span><span class=p>().</span><span class=nx>toLowerCase</span><span class=p>()).</span><span class=nx>filter</span><span class=p>(</span><span class=nx>p</span> <span class=o>=&gt;</span> <span class=nx>p</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åªè¦ç»“æœæ ‡é¢˜åŒ…å«å†’å·å‰åçš„ä¸»è¦éƒ¨åˆ†ï¼Œå°±ä¿ç•™åœ¨èšåˆç»“æœä¸­
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>parts</span><span class=p>.</span><span class=nx>some</span><span class=p>(</span><span class=nx>part</span> <span class=o>=&gt;</span> <span class=nx>title</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>part</span><span class=p>)))</span> <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ... åŸæœ‰çš„æ¨¡ç³ŠåŒ¹é…å­—ç¬¦åºåˆ—é€»è¾‘ä¿æŒä¸å˜ ...
</span></span></span></code></pre></td></tr></table></div></div><h3 id=4-ä¿®æ”¹-playpagetsx-æ’­æ”¾é¡µæºè¿‡æ»¤>4. ä¿®æ”¹ <code>play.page.tsx</code> (æ’­æ”¾é¡µæºè¿‡æ»¤)</h3><p>æŒ‰ç…§æ‚¨çš„è¦æ±‚ï¼Œå¯¹ <code>fetchSourcesData</code> ä¸­çš„è¿‡æ»¤é€»è¾‘è¿›è¡Œæ•´ä½“æ›¿æ¢ï¼Œå¢å¼ºå¯¹å†’å·æ ‡é¢˜çš„å…¼å®¹æ€§ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fetchSourcesData</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>query</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>SearchResult</span><span class=err>[]</span><span class=p>&gt;</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=sb>`/api/search?q=</span><span class=si>${</span><span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>query</span><span class=p>.</span><span class=nx>trim</span><span class=p>())</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>response</span><span class=p>.</span><span class=nx>ok</span><span class=p>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;æœç´¢å¤±è´¥&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>response</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>rawResults</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>results</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 1. é¢„å¤„ç†ï¼šè·å–æ¸…æ´—åçš„ä¸»æ ‡é¢˜ï¼ˆå»é™¤æ‰€æœ‰ç©ºæ ¼å’Œå†’å·ï¼‰
</span></span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>mainTitle</span> <span class=o>=</span> <span class=p>(</span><span class=nx>videoTitleRef</span><span class=p>.</span><span class=nx>current</span> <span class=o>||</span> <span class=s1>&#39;&#39;</span><span class=p>).</span><span class=nx>trim</span><span class=p>().</span><span class=nx>toLowerCase</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>mainTitleClean</span> <span class=o>=</span> <span class=nx>mainTitle</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/[:ï¼š\s+]/g</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>searchType</span> <span class=o>=</span> <span class=nx>searchParams</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=s1>&#39;stype&#39;</span><span class=p>)</span> <span class=o>||</span> <span class=nx>searchParams</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=s1>&#39;type&#39;</span><span class=p>)</span> <span class=o>||</span> <span class=s1>&#39;vod&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 2. ç»Ÿè®¡ä¼—æ•°é€»è¾‘
</span></span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>searchType</span> <span class=o>===</span> <span class=s1>&#39;movie&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>baseEpisodeCountRef</span><span class=p>.</span><span class=nx>current</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>perfectMatches</span> <span class=o>=</span> <span class=nx>rawResults</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>r</span>: <span class=kt>SearchResult</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>rTitleClean</span> <span class=o>=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>title</span><span class=p>.</span><span class=nx>trim</span><span class=p>().</span><span class=nx>toLowerCase</span><span class=p>().</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/[:ï¼š\s+]/g</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>rTitleClean</span> <span class=o>===</span> <span class=nx>mainTitleClean</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>});</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>perfectMatches</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>counts</span>: <span class=kt>Record</span><span class=p>&lt;</span><span class=nt>number</span><span class=p>,</span> <span class=na>number</span><span class=p>&gt;</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>            <span class=nx>perfectMatches</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>r</span>: <span class=kt>any</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=kr>const</span> <span class=nx>len</span> <span class=o>=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>episodes</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span> <span class=o>||</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=p>(</span><span class=nx>len</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=nx>counts</span><span class=p>[</span><span class=nx>len</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=nx>counts</span><span class=p>[</span><span class=nx>len</span><span class=p>]</span> <span class=o>||</span> <span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>modeCount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>maxFreq</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=p>[</span><span class=nx>count</span><span class=p>,</span> <span class=nx>freq</span><span class=p>]</span> <span class=k>of</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>entries</span><span class=p>(</span><span class=nx>counts</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=p>(</span><span class=nx>freq</span> <span class=o>&gt;</span> <span class=nx>maxFreq</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>maxFreq</span> <span class=o>=</span> <span class=nx>freq</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=nx>modeCount</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>count</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=nx>baseEpisodeCountRef</span><span class=p>.</span><span class=nx>current</span> <span class=o>=</span> <span class=nx>modeCount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>		 
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 3. âœ¨ æ‰§è¡Œå¢å¼ºåçš„è¿‡æ»¤é€»è¾‘
</span></span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>results</span> <span class=o>=</span> <span class=nx>rawResults</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>result</span>: <span class=kt>SearchResult</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>result</span><span class=p>.</span><span class=nx>title</span><span class=p>)</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>sourceTitle</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>title</span><span class=p>.</span><span class=nx>trim</span><span class=p>().</span><span class=nx>toLowerCase</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>sourceTitleClean</span> <span class=o>=</span> <span class=nx>sourceTitle</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/[:ï¼š\s+]/g</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>episodeCount</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>episodes</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span> <span class=o>??</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>baseCount</span> <span class=o>=</span> <span class=nx>baseEpisodeCountRef</span><span class=p>.</span><span class=nx>current</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=c1>// â˜… æ¡ä»¶ Aï¼šæ ‡é¢˜åŒ¹é…ï¼ˆå»é™¤å†’å·åï¼Œäº’ç›¸åŒ…å«å³å¯ï¼Œä¸å†æ­»å®ˆ startsWithï¼‰
</span></span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>isTitleMatch</span> <span class=o>=</span> <span class=nx>sourceTitleClean</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>mainTitleClean</span><span class=p>)</span> <span class=o>||</span> 
</span></span><span class=line><span class=cl>                               <span class=nx>mainTitleClean</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>sourceTitleClean</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isTitleMatch</span><span class=p>)</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// â˜… æ¡ä»¶ Bï¼šç”µå½±/ç”µè§†å‰§é›†æ•°æ‹¦æˆª
</span></span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>searchType</span> <span class=o>===</span> <span class=s1>&#39;movie&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>episodeCount</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>)</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>baseCount</span> <span class=o>&gt;</span> <span class=mi>6</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=kr>const</span> <span class=nx>diff</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>abs</span><span class=p>(</span><span class=nx>episodeCount</span> <span class=o>-</span> <span class=nx>baseCount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=p>(</span><span class=nx>diff</span> <span class=o>&gt;</span> <span class=nx>baseCount</span> <span class=o>*</span> <span class=mf>0.3</span><span class=p>)</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// â˜… æ¡ä»¶ Cï¼šå¹´ä»½åŒ¹é…
</span></span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>yearMatch</span> <span class=o>=</span> <span class=nx>videoYearRef</span><span class=p>.</span><span class=nx>current</span>
</span></span><span class=line><span class=cl>            <span class=o>?</span> <span class=nx>result</span><span class=p>.</span><span class=nx>year</span><span class=o>?</span><span class=p>.</span><span class=nx>toString</span><span class=p>().</span><span class=nx>toLowerCase</span><span class=p>()</span> <span class=o>===</span> <span class=nx>videoYearRef</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>toString</span><span class=p>().</span><span class=nx>toLowerCase</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=o>:</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=nx>yearMatch</span><span class=p>;</span>		    
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>setAvailableSources</span><span class=p>(</span><span class=nx>results</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>results</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setSourceSearchError</span><span class=p>(</span><span class=nx>err</span> <span class=k>instanceof</span> <span class=nb>Error</span> <span class=o>?</span> <span class=nx>err</span><span class=p>.</span><span class=nx>message</span> <span class=o>:</span> <span class=s1>&#39;æœç´¢å¤±è´¥&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>setAvailableSources</span><span class=p>([]);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setSourceSearchLoading</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ä¿®æ”¹è¦ç‚¹æ€»ç»“>ä¿®æ”¹è¦ç‚¹æ€»ç»“</h3><ol><li><strong>åç«¯å¤šè¯å¬å›</strong>ï¼šé€šè¿‡å°† <code>é¬¼ç­ä¹‹åˆƒ:æ¸¸éƒ­ç¯‡</code> æ‹†è§£ä¸º <code>æ¸¸éƒ­ç¯‡</code> ç­‰å­è¯ï¼Œç¡®ä¿èƒ½ä»èµ„æºç«™æœåˆ°é‚£äº›å‘½åä¸è§„èŒƒï¼ˆå¦‚çœç•¥ä¸»æ ‡é¢˜ï¼‰çš„æºã€‚</li><li><strong>èšåˆé¡µæ”¾å®½è¿‡æ»¤</strong>ï¼šå‰ç«¯èšåˆä¸å†è¦æ±‚æ ‡é¢˜å¿…é¡»åŒ…å«å†’å·ï¼Œåªè¦åŒ…å«â€œå‰¯æ ‡é¢˜â€å…³é”®å­—å³å¯æ˜¾ç¤ºï¼Œé˜²æ­¢ç»“æœè¢«è¯¯éšè—ã€‚</li><li><strong>æ’­æ”¾é¡µæ¨¡ç³ŠåŒ¹é…</strong>ï¼šæ’­æ”¾é¡µæ¢æºåˆ—è¡¨é€šè¿‡â€œå»é™¤æ‰€æœ‰ç¬¦å·åæ¯”å¯¹â€çš„é€»è¾‘ï¼Œç¡®ä¿å¸¦å†’å·å’Œä¸å¸¦å†’å·çš„åŒåèµ„æºèƒ½äº’ç›¸è¯†åˆ«ã€‚</li></ol><h2 id=è‡ªåŠ¨æ‹†åˆ†æœç´¢å…³é”®è¯>è‡ªåŠ¨æ‹†åˆ†æœç´¢å…³é”®è¯</h2><p>ä¸Šä¼ <code>\src\app\api\search\route.ts</code>ã€<code>\src\app\api\search\ws\route.ts</code>ä¸¤ä¸ªæ–‡ä»¶ï¼Œé—®<a class=link href=https://gemini.google.com/app target=_blank rel=noopener>gemini</a>ï¼š</p><p><strong>æé—®æ¨¡æ¿ï¼š</strong> â€œæˆ‘æƒ³ä¼˜åŒ–ä¸€ä¸ªæœç´¢å…³é”®è¯çš„å¤„ç†é€»è¾‘ã€‚</p><ol><li><strong>ç›®æ ‡åœºæ™¯</strong>ï¼šå½“ç”¨æˆ·è¾“å…¥â€˜ä½œå“å+ç¯‡ç« åâ€™ï¼ˆå¦‚ï¼š<strong>é¬¼ç­ä¹‹åˆƒæŸ±è®­ç»ƒç¯‡</strong>ï¼‰ä¸”ä¸­é—´æ²¡ç©ºæ ¼æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå¸¦ç©ºæ ¼çš„ç‰ˆæœ¬ï¼ˆ<strong>é¬¼ç­ä¹‹åˆƒ æŸ±è®­ç»ƒç¯‡</strong>ï¼‰å­˜å…¥æœç´¢æ•°ç»„ã€‚</li><li><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼šè¯·ä½¿ç”¨æ­£åˆ™åŒ¹é…ã€‚å·²çŸ¥ç¯‡ç« å…³é”®å­—åŒ…æ‹¬ï¼š<strong>æ— é™åˆ—è½¦ã€æ¸¸éƒ­ã€é”»åˆ€æ‘ã€æŸ±è®­ç»ƒã€ç¯‡ç« </strong>ã€‚</li><li><strong>è´Ÿé¢çº¦æŸ</strong>ï¼šå¿…é¡»ç¡®ä¿æ‹†åˆ†ç‚¹å‡†ç¡®ã€‚ä¾‹å¦‚ï¼Œä¸èƒ½æŠŠâ€˜é¬¼ç­ä¹‹åˆƒâ€™æ‹†æˆâ€˜é¬¼ç­ä¹‹â€™å’Œâ€˜åˆƒæŸ±è®­ç»ƒç¯‡â€™ï¼Œâ€˜åˆƒâ€™å­—å¿…é¡»ç•™åœ¨å‰åŠéƒ¨åˆ†ã€‚</li><li><strong>ä»£ç è¦æ±‚</strong>ï¼šæ¯è¡Œå¼€å¤´ç•™2ç©ºæ ¼ï¼Œå¹¶åŠ å…¥é•¿åº¦æ ¡éªŒï¼ˆå¦‚ä¸»æ ‡é¢˜è‡³å°‘2ä¸ªå­—ï¼‰é˜²æ­¢è¯¯ä¼¤ã€‚â€</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl>  <span class=c1>// 2.ä¼˜åŒ–åçš„ç¯‡ç« æ‹†åˆ†é€»è¾‘ï¼šé’ˆå¯¹ç‰¹å®šç¯‡ç« åè¿›è¡Œé”šå®š
</span></span></span><span class=line><span class=cl>  <span class=c1>// åŒ¹é…åŸç†ï¼š(ä½œå“å)(ç¯‡ç« å…³é”®å­—)(ç¯‡)
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>knownArcs</span> <span class=o>=</span> <span class=s1>&#39;æ— é™åˆ—è½¦|æ¸¸éƒ­|é”»åˆ€æ‘|åˆ€åŒ æ‘|æŸ±è®­ç»ƒ|æ— é™åŸ|ç«‹å¿—|ç¯‡ç« &#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>arcPattern</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>RegExp</span><span class=p>(</span><span class=sb>`(.+?)((</span><span class=si>${</span><span class=nx>knownArcs</span><span class=si>}</span><span class=sb>)ç¯‡)$`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>arcMatch</span> <span class=o>=</span> <span class=nx>normalizedQuery</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>arcPattern</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>arcMatch</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>normalizedQuery</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>mainTitle</span> <span class=o>=</span> <span class=nx>arcMatch</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span> <span class=c1>// ç»“æœï¼šé¬¼ç­ä¹‹åˆƒ
</span></span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>arcName</span> <span class=o>=</span> <span class=nx>arcMatch</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>   <span class=c1>// ç»“æœï¼šæŸ±è®­ç»ƒç¯‡
</span></span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=c1>// ç¡®ä¿ä¸»æ ‡é¢˜æœ‰æ„ä¹‰ï¼ˆé•¿åº¦ &gt;= 2ï¼‰ï¼Œé¿å…æ‹†åˆ†å•å­—
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>mainTitle</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>arcSpaced</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>mainTitle</span><span class=si>}</span><span class=sb> </span><span class=si>${</span><span class=nx>arcName</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>searchQueries</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>arcSpaced</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>searchQueries</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>arcSpaced</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=æå–ä¸»æ ‡é¢˜ä¸åç¼€>æå–ä¸»æ ‡é¢˜ä¸åç¼€</h2><p>ä¸Šä¼ <code>\src\app\api\search\route.ts</code>ã€<code>\src\app\api\search\ws\route.ts</code>ã€<code>\src\app\play\page.tsx</code>ä¸‰ä¸ªæ–‡ä»¶ï¼Œé—®<a class=link href=https://gemini.google.com/app target=_blank rel=noopener>gemini</a>ï¼š</p><p>å½“åç¼€å¸¦æœ‰ï¼šå›½è¯­ã€ç²¤è¯­ã€å›½è¯­ç‰ˆã€ç²¤è¯­ç‰ˆã€æ™®é€šè¯ç‰ˆã€(ç²¤è¯­)ã€(å›½è¯­)ã€(å›½è¯­ç‰ˆ)ã€(ç²¤è¯­ç‰ˆ)ã€ï¼ˆæ™®é€šè¯ç‰ˆï¼‰ã€å¹´ä»½ï¼Œèƒ½å¤šåŠ å…¥åç¼€å‰é¢ä¸»æ ‡é¢˜è¿›è¡Œæœç´¢</p><h3 id=ä¿®æ”¹-routets-api-è·¯ç”±>ä¿®æ”¹ <code>route.ts</code> (API è·¯ç”±)</h3><p>åœ¨ <code>route.ts</code> ä¸­ï¼Œå°†å¤„ç†æœç´¢è¯ç”Ÿæˆçš„é€»è¾‘æ›´æ–°å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl>  <span class=c1>//3.æ–°å¢ï¼šåç¼€å‰¥ç¦»ä¸å‰ç¼€æå–é€»è¾‘
</span></span></span><span class=line><span class=cl>  <span class=c1>// åŒ¹é…ï¼š(æ ¸å¿ƒä¸»æ ‡é¢˜) + (å¹´ä»½/è¯­è¨€/ç‰ˆæœ¬åç¼€)
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>metaSuffixRegex</span> <span class=o>=</span> <span class=sr>/(.+?)((?:\(|ï¼ˆ)?(?:å›½è¯­|ç²¤è¯­|æ™®é€šè¯)(?:ç‰ˆ)?(?:\)|ï¼‰)?|(?:\(|ï¼ˆ)?\d{4}å¹´?(?:\)|ï¼‰)?)$/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>metaMatch</span> <span class=o>=</span> <span class=nx>normalizedQuery</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>metaSuffixRegex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>metaMatch</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>coreTitle</span> <span class=o>=</span> <span class=nx>metaMatch</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=nx>trim</span><span class=p>();</span> <span class=c1>// å¾—åˆ°ï¼šæ•é£è¿½å½±
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>coreTitle</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;=</span> <span class=mi>2</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>searchQueries</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>coreTitle</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>searchQueries</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>coreTitle</span><span class=p>);</span> <span class=c1>// å°†æœ€æ ¸å¿ƒçš„è¯åŠ å…¥æœç´¢ï¼Œä»¥è·å–æ‰€æœ‰ç›¸å…³ç»“æœ
</span></span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ä¿®æ”¹-wsroutets-websocket-è·¯ç”±>ä¿®æ”¹ <code>ws.route.ts</code> (WebSocket è·¯ç”±)</h3><p>åœ¨ <code>ws.route.ts</code> ä¸­åŒæ­¥æ­¤é€»è¾‘ï¼Œç¡®ä¿æµå¼æœç´¢ä¹Ÿèƒ½è¦†ç›–å®½æ³›ç»“æœï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl>  <span class=c1>//3.æ–°å¢ï¼šåç¼€å‰¥ç¦»ä¸å‰ç¼€æå–é€»è¾‘
</span></span></span><span class=line><span class=cl>  <span class=c1>// åŒ¹é…ï¼š(æ ¸å¿ƒä¸»æ ‡é¢˜) + (å¹´ä»½/è¯­è¨€/ç‰ˆæœ¬åç¼€)
</span></span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>metaSuffixRegex</span> <span class=o>=</span> <span class=sr>/(.+?)((?:\(|ï¼ˆ)?(?:å›½è¯­|ç²¤è¯­|æ™®é€šè¯)(?:ç‰ˆ)?(?:\)|ï¼‰)?|(?:\(|ï¼ˆ)?\d{4}å¹´?(?:\)|ï¼‰)?)$/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>metaMatch</span> <span class=o>=</span> <span class=nx>normalizedQuery</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>metaSuffixRegex</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>metaMatch</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>coreTitle</span> <span class=o>=</span> <span class=nx>metaMatch</span><span class=p>[</span><span class=mi>1</span><span class=p>].</span><span class=nx>trim</span><span class=p>();</span> <span class=c1>// å¾—åˆ°ï¼šæ•é£è¿½å½±
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>coreTitle</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;=</span> <span class=mi>2</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>searchQueries</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>coreTitle</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>searchQueries</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>coreTitle</span><span class=p>);</span> <span class=c1>// å°†æœ€æ ¸å¿ƒçš„è¯åŠ å…¥æœç´¢ï¼Œä»¥è·å–æ‰€æœ‰ç›¸å…³ç»“æœ
</span></span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ä¿®æ”¹-srcappplaypagetsx>ä¿®æ”¹ <code>\src\app\play\page.tsx</code></h3><p>è¯·åœ¨ <code>page.tsx</code> ä¸­æ‰¾åˆ° <code>const results = rawResults.filter(...)</code> éƒ¨åˆ†ï¼Œå°†å…¶æ›¿æ¢ä¸ºä»¥ä¸‹å¢å¼ºé€»è¾‘ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl>        <span class=c1>// 3. âœ¨ æ‰§è¡Œå¢å¼ºåçš„è¿‡æ»¤é€»è¾‘ (æ”¯æŒå‰ç¼€åŒ¹é…ä¸åç¼€å‰¥ç¦»)
</span></span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>results</span> <span class=o>=</span> <span class=nx>rawResults</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>result</span>: <span class=kt>SearchResult</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>result</span><span class=p>.</span><span class=nx>title</span><span class=p>)</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>sourceTitle</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>title</span><span class=p>.</span><span class=nx>trim</span><span class=p>().</span><span class=nx>toLowerCase</span><span class=p>();</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>mainTitle</span> <span class=o>=</span> <span class=p>(</span><span class=nx>videoTitleRef</span><span class=p>.</span><span class=nx>current</span> <span class=o>||</span> <span class=s1>&#39;&#39;</span><span class=p>).</span><span class=nx>trim</span><span class=p>().</span><span class=nx>toLowerCase</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=c1>// å®šä¹‰åç¼€å‰¥ç¦»æ­£åˆ™ï¼šç§»é™¤å¹´ä»½ã€è¯­è¨€ç‰ˆæœ¬ã€æ‹¬å·ç­‰å¹²æ‰°é¡¹
</span></span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>suffixRegex</span> <span class=o>=</span> <span class=sr>/(.+?)((?:\(|ï¼ˆ)?(?:å›½è¯­|ç²¤è¯­|æ™®é€šè¯)(?:ç‰ˆ)?(?:\)|ï¼‰)?|(?:\(|ï¼ˆ)?\d{4}å¹´?(?:\)|ï¼‰)?)$/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=c1>// æ¸…æ´—é€»è¾‘ï¼šå»é™¤å†’å·ã€ç©ºæ ¼ï¼Œå¹¶å‰¥ç¦»åç¼€
</span></span></span><span class=line><span class=cl>          <span class=c1>// è¿™æ · &#34;æ•é£è¿½å½±ç²¤è¯­&#34; å’Œ &#34;æ•é£è¿½å½±&#34; éƒ½ä¼šå˜æˆ &#34;æ•é£è¿½å½±&#34;
</span></span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>cleanSource</span> <span class=o>=</span> <span class=nx>sourceTitle</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/[:ï¼š\s+]/g</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>).</span><span class=nx>replace</span><span class=p>(</span><span class=nx>suffixRegex</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>cleanMain</span> <span class=o>=</span> <span class=nx>mainTitle</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/[:ï¼š\s+]/g</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>).</span><span class=nx>replace</span><span class=p>(</span><span class=nx>suffixRegex</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=c1>// â˜… æ¡ä»¶ Aï¼šæ ‡é¢˜åŒ¹é…ï¼ˆæ ¸å¿ƒæ”¹è¿›ï¼‰
</span></span></span><span class=line><span class=cl>          <span class=c1>// â˜… ä¿®æ”¹ä¸ºï¼šæ ‡é¢˜å¼€å¤´åŒ¹é… (startsWith)
</span></span></span><span class=line><span class=cl>          <span class=c1>// è§£å†³ &#34;ç–¯ç‹‚åŠ¨ç‰©åŸ&#34; åŒ¹é…åˆ° &#34;æ„å»ºç–¯ç‹‚åŠ¨ç‰©åŸ&#34; çš„é—®é¢˜
</span></span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>isTitleMatch</span> <span class=o>=</span> <span class=nx>cleanSource</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=nx>cleanMain</span><span class=p>)</span> <span class=o>||</span> <span class=nx>cleanMain</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=nx>cleanSource</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isTitleMatch</span><span class=p>)</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>episodeCount</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>episodes</span><span class=o>?</span><span class=p>.</span><span class=nx>length</span> <span class=o>??</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>baseCount</span> <span class=o>=</span> <span class=nx>baseEpisodeCountRef</span><span class=p>.</span><span class=nx>current</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>searchType</span> <span class=o>=</span> <span class=nx>searchParams</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=s1>&#39;stype&#39;</span><span class=p>)</span> <span class=o>||</span> <span class=nx>searchParams</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=s1>&#39;type&#39;</span><span class=p>)</span> <span class=o>||</span> <span class=s1>&#39;vod&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=c1>// â˜… æ¡ä»¶ Bï¼šç”µå½±/ç”µè§†å‰§é›†æ•°æ‹¦æˆª
</span></span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>searchType</span> <span class=o>===</span> <span class=s1>&#39;movie&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>episodeCount</span> <span class=o>&gt;</span> <span class=mi>5</span><span class=p>)</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span> <span class=c1>// ç”µå½±é›†æ•°é€šå¸¸ä¸åº”è¿‡å¤š
</span></span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>baseCount</span> <span class=o>&gt;</span> <span class=mi>6</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=kr>const</span> <span class=nx>diff</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>abs</span><span class=p>(</span><span class=nx>episodeCount</span> <span class=o>-</span> <span class=nx>baseCount</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=p>(</span><span class=nx>diff</span> <span class=o>&gt;</span> <span class=nx>baseCount</span> <span class=o>*</span> <span class=mf>0.3</span><span class=p>)</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span> <span class=c1>// å‰§é›†æ•°é‡åå·®è¶…è¿‡ 30% åˆ™æ‹¦æˆª
</span></span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// â˜… æ¡ä»¶ Cï¼šå¹´ä»½åŒ¹é…
</span></span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>yearMatch</span> <span class=o>=</span> <span class=nx>videoYearRef</span><span class=p>.</span><span class=nx>current</span>
</span></span><span class=line><span class=cl>            <span class=o>?</span> <span class=nx>result</span><span class=p>.</span><span class=nx>year</span><span class=o>?</span><span class=p>.</span><span class=nx>toString</span><span class=p>().</span><span class=nx>toLowerCase</span><span class=p>()</span> <span class=o>===</span> <span class=nx>videoYearRef</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>toString</span><span class=p>().</span><span class=nx>toLowerCase</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=o>:</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=nx>yearMatch</span><span class=p>;</span>		    
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><hr><p>AIæé—®ï¼šâ€œæˆ‘æƒ³ä¼˜åŒ–æ¢æºä½“éªŒã€‚è¯·å¸®æˆ‘ä¿®æ”¹ <code>route.ts</code> å’Œ <code>page.tsx</code>ï¼š</p><ol><li><strong>åç«¯</strong>ï¼šä½¿ç”¨æ­£åˆ™å‰¥ç¦»è¯­è¨€å’Œå¹´ä»½åç¼€ï¼Œæå–æ ¸å¿ƒè¯å¹¶å®ç°å¹¶å‘æœç´¢ã€‚</li><li><strong>å‰ç«¯</strong>ï¼šå‰¥ç¦»æ ‡é¢˜å™ªéŸ³åï¼Œç”¨ <code>startsWith</code> é€»è¾‘å®ç°æ ‡é¢˜å¼€å¤´åŒ¹é…ï¼Œè®©â€˜æ•é£è¿½å½±ç²¤è¯­â€™çš„æ’­æ”¾é¡µèƒ½çœ‹åˆ°æ•´ä¸ªâ€˜æ•é£è¿½å½±â€™ç³»åˆ—ã€‚</li><li><strong>å»å™ª</strong>ï¼šåŒ¹é…å‰ç»Ÿä¸€ç§»é™¤ç©ºæ ¼å’Œä¸­è‹±æ–‡å†’å·ã€‚</li></ol><hr><h2 id=åˆ é™¤é¦–é¡µé¦–å°¾ç©ºç™½>åˆ é™¤é¦–é¡µé¦–å°¾ç©ºç™½</h2><p>ä¸Šä¼ <code>\src\app\page.tsx</code>å’Œéœ€è¦åˆ é™¤å†…å®¹çš„ä¸¤å¼ å›¾ç‰‡ï¼Œé—®<a class=link href=https://gemini.google.com/app target=_blank rel=noopener>gemini</a>ï¼šå¸®æˆ‘åˆ é™¤å›¾ç‰‡å†…å®¹ï¼Œè¯·ç»™æˆ‘å®Œæ•´ä»£ç </p><hr><p><strong>AIæé—®ï¼š</strong></p><p><strong>ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ ä»£ç </strong> â€œè¿™æ˜¯æˆ‘çš„ <code>page.tsx</code> å®Œæ•´ä»£ç ï¼Œè¯·å…ˆé˜…è¯»ã€‚â€</p><p><strong>ç¬¬äºŒæ­¥ï¼šæè¿°ä¿®æ”¹éœ€æ±‚</strong> â€œæˆ‘æƒ³å¯¹è¿™ä¸ªé¡µé¢åšä»¥ä¸‹è°ƒæ•´ï¼š</p><ol><li><strong>å¤´éƒ¨</strong>ï¼šåˆ é™¤å›¾ç‰‡ä¸­æ˜¾ç¤ºçš„ Logo å’ŒåŠŸèƒ½æ ‡ç­¾ï¼Œå¹¶é€‚å½“æ”¶ç¼©é¡¶éƒ¨çš„é—´è·ã€‚</li><li><strong>å°¾éƒ¨</strong>ï¼šå®Œå…¨ç§»é™¤åŒ…å« &lsquo;Powered by&rsquo; å­—æ ·çš„åº•éƒ¨ç»„ä»¶ã€‚</li><li><strong>ä¿®å¤</strong>ï¼šå…¬å‘Šå¼¹çª—çš„æ ‡é¢˜é¢œè‰²æ˜¾ç¤ºå¼‚å¸¸ï¼Œè¯·æ”¹ä¸ºæ­£å¸¸çš„çº¯è‰²ã€‚</li><li><strong>ä¿æŒ</strong>ï¼šè¯·ä¿ç•™æ‰€æœ‰æ•°æ®çš„æŠ“å–å’Œæ˜¾ç¤ºé€»è¾‘ã€‚â€</li></ol><p><strong>ç¬¬ä¸‰æ­¥ï¼šç´¢è¦ç»“æœ</strong> â€œè¯·ç›´æ¥ç»™æˆ‘ä¿®æ”¹åçš„<strong>å®Œæ•´ä»£ç </strong>ã€‚â€</p><hr><h2 id=æŒ‡å®šæºæ— æ•ˆè‡ªåŠ¨é™çº§è‡ªåŠ¨ä¿®å¤è§‚çœ‹å†å²å’Œæ”¶è—>æŒ‡å®šæºæ— æ•ˆè‡ªåŠ¨é™çº§&&è‡ªåŠ¨ä¿®å¤è§‚çœ‹å†å²å’Œæ”¶è—</h2><p>ä¸Šä¼ <code>\src\app\play\page.tsx</code>ï¼Œé—®<a class=link href=https://gemini.google.com/app target=_blank rel=noopener>gemini</a>ï¼š</p><p><strong>è§’è‰²è®¾å®šï¼š</strong> ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ Next.js å’Œ TypeScript ä¸“å®¶ï¼Œä¸“æ³¨äºæµåª’ä½“æ’­æ”¾å™¨çš„å¼€å‘å’Œä¼˜åŒ–ã€‚</p><p><strong>èƒŒæ™¯ä¸ç›®æ ‡ï¼š</strong> æˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ªè§†é¢‘æ’­æ”¾é¡µ (<code>page.tsx</code>)ã€‚ç›®å‰çš„ <code>initAll</code> å‡½æ•°é€»è¾‘æ¯”è¾ƒè„†å¼±ï¼šå½“ URL å‚æ•°æŒ‡å®šçš„æºï¼ˆ<code>currentSource</code>ï¼‰å¤±æ•ˆæˆ–æ— é›†æ•°æ—¶ï¼Œé¡µé¢ä¼šç›´æ¥æŠ¥é”™â€œæœªæ‰¾åˆ°åŒ¹é…ç»“æœâ€ã€‚</p><p><strong>ä»»åŠ¡è¦æ±‚ï¼š</strong> è¯·é‡æ„ <code>PlayPageClient</code> ç»„ä»¶ä¸­çš„ <code>initAll</code> å‡½æ•°ï¼Œå®ç°ä»¥ä¸‹<strong>é«˜å¯ç”¨æ€§</strong>å’Œ<strong>è‡ªæ„ˆ</strong>é€»è¾‘ï¼š</p><ol><li><strong>ä¿®å¤æ•°æ®è¦†ç›– Bugï¼š</strong><ul><li>å½“å‰ä»£ç ä¸­ï¼Œå½“å•ç‹¬è·å–æŒ‡å®šæºè¯¦æƒ… (<code>fetchSourceDetail</code>) æ—¶ï¼Œä¼šç›´æ¥è¦†ç›– <code>sourcesInfo</code> åˆ—è¡¨ã€‚</li><li>è¯·æ”¹ä¸º**è¿½åŠ ï¼ˆAppendï¼‰**æ¨¡å¼ï¼Œä¿ç•™ä¹‹å‰æœç´¢åˆ°çš„ç»“æœä½œä¸ºå¤‡é€‰å…œåº•ã€‚</li></ul></li><li><strong>å®ç°è‡ªåŠ¨é™çº§ï¼ˆAuto-Fallbackï¼‰ï¼š</strong><ul><li>å¦‚æœ URL æŒ‡å®šçš„æºæ— æ•ˆï¼ˆä¸å­˜åœ¨æˆ– <code>episodes</code> ä¸ºç©ºï¼‰ï¼Œ<strong>ä¸è¦æŠ¥é”™</strong>ã€‚</li><li>åˆ©ç”¨ <code>optimizationEnabled</code> é€»è¾‘ï¼Œè‡ªåŠ¨ä» <code>sourcesInfo</code> å‰©ä½™çš„æºä¸­ä¼˜é€‰æœ€ä½³æºè¿›è¡Œæ’­æ”¾ã€‚</li></ul></li><li><strong>å®ç°â€œæ•°æ®è‡ªæ„ˆâ€åŠŸèƒ½ï¼ˆæ ¸å¿ƒéœ€æ±‚ï¼‰ï¼š</strong><ul><li><strong>åœºæ™¯ä¸€ï¼ˆå½»åº•æ­»é“¾ï¼‰ï¼š</strong> å¦‚æœæŒ‡å®šæºå¤±æ•ˆä¸”å…¨ç½‘æ— æ›¿ä»£æºï¼Œè‡ªåŠ¨å¼‚æ­¥åˆ é™¤æ•°æ®åº“ä¸­çš„â€œæ”¶è—â€å’Œâ€œæ’­æ”¾è®°å½•â€ï¼Œå¹¶æç¤ºç”¨æˆ·ã€‚</li><li><strong>åœºæ™¯äºŒï¼ˆè‡ªåŠ¨ä¿®å¤ï¼‰ï¼š</strong> å¦‚æœæŒ‡å®šæºå¤±æ•ˆï¼Œä½†æ‰¾åˆ°äº†æ–°çš„æ›¿ä»£æºï¼š<ul><li><strong>æ”¶è—ä¿®å¤ï¼š</strong> è‡ªåŠ¨å°†æ•°æ®åº“ä¸­çš„æ—§æ”¶è—é“¾æ¥æ›´æ–°ä¸ºæ–°æºã€‚</li><li><strong>å†å²è¿ç§»ï¼š</strong> è‡ªåŠ¨å°†æ—§æºçš„æ’­æ”¾è®°å½•ï¼ˆ<code>PlayRecord</code>ï¼‰è¿ç§»åˆ°æ–°æºï¼Œå¹¶<strong>å¿…é¡»ä¿ç•™</strong>ç”¨æˆ·çš„è§‚çœ‹è¿›åº¦ï¼ˆ<code>play_time</code>ï¼‰å’Œé›†æ•°ç´¢å¼•ã€‚</li><li><strong>æ— æ„Ÿä½“éªŒï¼š</strong> æ‰€æœ‰æ•°æ®åº“æ“ä½œéœ€åœ¨åå°å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡è§†é¢‘èµ·æ’­ã€‚</li></ul></li></ul></li><li><strong>TypeScript ç±»å‹å®‰å…¨ï¼š</strong><ul><li>æ³¨æ„ï¼šè°ƒç”¨ <code>savePlayRecord(source, id, data)</code> æ—¶ï¼Œ<code>data</code> å¯¹è±¡ä¸­<strong>ä¸éœ€è¦</strong>å†åŒ…å« <code>source</code> å’Œ <code>id</code> å­—æ®µï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚è¯·ç¡®ä¿ä»£ç ç¬¦åˆ TS ç±»å‹å®šä¹‰ã€‚</li></ul></li></ol><p><strong>è¾“å‡ºè¦æ±‚ï¼š</strong> è¯·æä¾›ä¿®æ”¹åçš„å®Œæ•´ <code>initAll</code> å‡½æ•°ä»£ç ï¼Œå¹¶åœ¨å…³é”®é€»è¾‘å¤„æ·»åŠ æ³¨é‡Šã€‚</p><h2 id=ç¦æ­¢è®¿é—®æŒ‡å®šç½‘é¡µ>ç¦æ­¢è®¿é—®æŒ‡å®šç½‘é¡µ</h2><h3 id=é¡¹ç›®æ ¹ç›®å½•æ–°å»ºmiddlewarets>é¡¹ç›®æ ¹ç›®å½•æ–°å»ºmiddleware.ts</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>//</span> <span class=n>middleware</span><span class=o>.</span><span class=n>ts</span> <span class=err>ï¼ˆæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=p>{</span> <span class=n>NextResponse</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;next/server&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>type</span> <span class=p>{</span> <span class=n>NextRequest</span> <span class=p>}</span> <span class=n>from</span> <span class=s1>&#39;next/server&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=err>ç¦æ­¢å…³é”®è¯åˆ—è¡¨ï¼ˆæ”¯æŒå¤šä¸ªï¼‰</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>BANNED_KEYWORDS</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;AAA&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;BBB&#39;</span><span class=p>,</span>  
</span></span><span class=line><span class=cl>  <span class=o>//</span> <span class=s1>&#39;å¦ä¸€ä¸ªç¦æ­¢æ ‡é¢˜&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>export</span> <span class=n>function</span> <span class=n>middleware</span><span class=p>(</span><span class=n>request</span><span class=p>:</span> <span class=n>NextRequest</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=o>//</span> <span class=err>ç›´æ¥è·å–</span> <span class=n>title</span> <span class=err>å‚æ•°ï¼ˆ</span><span class=n>Next</span><span class=o>.</span><span class=n>js</span> <span class=err>å·²è‡ªåŠ¨è§£ç æ±‰å­—ï¼‰</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=n>title</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>nextUrl</span><span class=o>.</span><span class=n>searchParams</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;title&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=o>//</span> <span class=err>æ£€æŸ¥</span> <span class=n>title</span> <span class=err>æ˜¯å¦åŒ…å«ç¦æ­¢å…³é”®è¯ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>title</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>lowerTitle</span> <span class=o>=</span> <span class=n>title</span><span class=o>.</span><span class=n>toLowerCase</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>isBanned</span> <span class=o>=</span> <span class=n>BANNED_KEYWORDS</span><span class=o>.</span><span class=n>some</span><span class=p>(</span><span class=n>keyword</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>      <span class=n>lowerTitle</span><span class=o>.</span><span class=n>includes</span><span class=p>(</span><span class=n>keyword</span><span class=o>.</span><span class=n>toLowerCase</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>isBanned</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=o>//</span> <span class=err>è¿”å›</span> <span class=mi>404</span><span class=err>ï¼ˆæ¨èä½¿ç”¨è‡ªå®šä¹‰é¡µé¢ï¼‰</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>NextResponse</span><span class=o>.</span><span class=n>rewrite</span><span class=p>(</span><span class=n>new</span> <span class=n>URL</span><span class=p>(</span><span class=s1>&#39;/404&#39;</span><span class=p>,</span> <span class=n>request</span><span class=o>.</span><span class=n>url</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=o>//</span> <span class=err>æˆ–ä½¿ç”¨å†…ç½®ï¼š</span><span class=k>return</span> <span class=n>new</span> <span class=n>Response</span><span class=p>(</span><span class=s1>&#39;Not Found&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=n>status</span><span class=p>:</span> <span class=mi>404</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=o>//</span> <span class=err>æ­£å¸¸é€šè¿‡</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>NextResponse</span><span class=o>.</span><span class=n>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=err>ç¡®ä¿å¯¹æ‰€æœ‰è·¯å¾„ç”Ÿæ•ˆï¼ˆç‰¹åˆ«æ˜¯</span> <span class=o>/</span><span class=n>play</span><span class=err>ï¼‰</span>
</span></span><span class=line><span class=cl><span class=k>export</span> <span class=k>const</span> <span class=n>config</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>matcher</span><span class=p>:</span> <span class=s1>&#39;/:path*&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=åˆ›å»ºè‡ªå®šä¹‰-404-é¡µé¢app404tsx>åˆ›å»ºè‡ªå®šä¹‰ 404 é¡µé¢ï¼ˆapp/404.tsxï¼‰</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>//</span> <span class=n>app</span><span class=o>/</span><span class=mf>404.</span><span class=n>tsx</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>Link</span> <span class=n>from</span> <span class=s1>&#39;next/link&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>export</span> <span class=n>default</span> <span class=n>function</span> <span class=n>Custom404</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=n>div</span> <span class=n>className</span><span class=o>=</span><span class=s2>&#34;flex flex-col items-center justify-center min-h-screen bg-gray-50 dark:bg-gray-900&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=n>h1</span> <span class=n>className</span><span class=o>=</span><span class=s2>&#34;text-6xl font-bold text-red-600 mb-6&#34;</span><span class=o>&gt;</span><span class=mi>404</span><span class=o>&lt;/</span><span class=n>h1</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=n>p</span> <span class=n>className</span><span class=o>=</span><span class=s2>&#34;text-2xl mb-8&#34;</span><span class=o>&gt;</span><span class=err>é¡µé¢ä¸å­˜åœ¨æˆ–å·²è¢«ç¦æ­¢è®¿é—®</span><span class=o>&lt;/</span><span class=n>p</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=n>Link</span> <span class=n>href</span><span class=o>=</span><span class=s2>&#34;/&#34;</span> <span class=n>className</span><span class=o>=</span><span class=s2>&#34;px-8 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=err>è¿”å›é¦–é¡µ</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;/</span><span class=n>Link</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;/</span><span class=n>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™æ ·ï¼Œå½“è®¿é—®åŒ…å« title=AAAï¼ˆæ— è®ºæ˜¯å¦ç¼–ç ï¼‰çš„é“¾æ¥æ—¶ï¼Œéƒ½ä¼šç›´æ¥æ˜¾ç¤º 404 é¡µé¢ï¼Œä¸”çœŸå®è¿”å› 404 çŠ¶æ€ç ã€‚</p><h2 id=ç§»é™¤ç‰ˆæœ¬æ£€æµ‹>ç§»é™¤ç‰ˆæœ¬æ£€æµ‹</h2><p>é—®<a class=link href=https://gemini.google.com/app target=_blank rel=noopener>Gemini</a>ï¼šæ€æ ·ä¿®æ”¹æ‰èƒ½ä½¿ç›®æ ‡ä»“åº“æ— è®ºä½•æ—¶æ›´æ–°ï¼Œv0.8éƒ½æ˜¯æœ€æ–°ç‰ˆæœ¬</p><p>ç­”ï¼šæ–¹æ¡ˆäºŒï¼šé”å®šæœ¬åœ°æ—¶é—´æˆ³ä¸ºâ€œæœªæ¥æ—¶é—´â€</p><p>å¦‚æœæ‚¨ä¸æƒ³æ”¹åŠ¨å‡½æ•°é€»è¾‘ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸€ä¸ª<strong>æå¤§</strong>çš„æ—¶é—´æˆ³æ¥æ¬ºéª—ç³»ç»Ÿã€‚ç‰ˆæœ¬æ£€æµ‹æ¨¡å—é€šè¿‡ <code>YYYYMMDDHHMMSS</code> æ ¼å¼è¿›è¡Œ <code>BigInt</code> æ¯”è¾ƒ</p><ol><li><strong>ä¿®æ”¹ <code>VERSION.txt</code>ï¼š</strong> å°†å…¶æ”¹ä¸ºä¸€ä¸ªè¿œæœªæ¥çš„æ—¶é—´ï¼ˆä¾‹å¦‚ 2099 å¹´ï¼‰ ã€‚<ul><li>å†…å®¹æ”¹ä¸ºï¼š<code>20991231235959</code></li></ul></li><li><strong>ä¿®æ”¹ <code>version.ts</code> ä¸­çš„ <code>BUILD_TIMESTAMP</code>ï¼š</strong> ç¡®ä¿å›é€€å€¼ä¹Ÿè¶³å¤Ÿå¤§ã€‚<ul><li>ä¿®æ”¹ä¸ºï¼š<code>export const BUILD_TIMESTAMP = '20991231235959';</code></li></ul></li></ol><h2 id=å›ºå®šv09ç‰ˆæœ¬>å›ºå®šV0.9ç‰ˆæœ¬</h2><p>V0.9ç‰ˆæœ¬æœ€å¿«</p><p>1.æ–°å»ºä»“åº“ï¼Œå¦‚ï¼šhttps://github.com/iwyang/yangtv</p><p>2.åˆ›å»º github è®¿é—® tokenï¼Œå¹¶æ·»åŠ åˆ°ä»“åº“ç¯å¢ƒå˜é‡ï¼Œåç§°ä¸º<code>YANGTV</code>ï¼ˆæ–¹æ³•è§ä¸Šï¼‰</p><p>3.ä¸‹è½½V0.9æºç åˆ°æœ¬åœ°</p><p>4.ä¿®æ”¹ docker-image.yml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build &amp; Push Docker Image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>inputs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tag</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Docker æ ‡ç­¾&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>required</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>default</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;latest&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>main, master]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>main, master]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>concurrency</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.workflow }}-${{ github.ref }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cancel-in-progress</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>permissions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>contents</span><span class=p>:</span><span class=w> </span><span class=l>write</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>packages</span><span class=p>:</span><span class=w> </span><span class=l>write</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>actions</span><span class=p>:</span><span class=w> </span><span class=l>write</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>strategy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>include</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>linux/amd64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>os</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>platform</span><span class=p>:</span><span class=w> </span><span class=l>linux/arm64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>os</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-24.04-arm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>${{ matrix.os }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Prepare platform identifier</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>platform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          PLATFORM_ID=$(echo &#34;${{ matrix.platform }}&#34; | sed &#39;s|/|-|g&#39;)
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;id=${PLATFORM_ID}&#34; &gt;&gt; $GITHUB_OUTPUT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout source code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set up Docker Buildx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/setup-buildx-action@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Login to GitHub Container Registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/login-action@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>registry</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.actor }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.YANGTV }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set lowercase repository owner</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>lowercase</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;owner=$(echo &#39;${{ github.repository_owner }}&#39; | tr &#39;[:upper:]&#39; &#39;[:lower:]&#39;)&#34; &gt;&gt; &#34;$GITHUB_OUTPUT&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Extract version from package.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          VERSION=$(node -p &#34;require(&#39;./package.json&#39;).version&#34;)
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;version=v${VERSION}&#34; &gt;&gt; &#34;$GITHUB_OUTPUT&#34;
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;Detected version: v${VERSION}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Extract metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>meta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/metadata-action@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>images</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/${{ steps.lowercase.outputs.owner }}/yangtv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>            type=raw,value=${{ github.event.inputs.tag || &#39;latest&#39; }},enable={{is_default_branch}}
</span></span></span><span class=line><span class=cl><span class=sd>            type=raw,value=${{ steps.version.outputs.version }},enable={{is_default_branch}}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build and push by digest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/build-push-action@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>./Dockerfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>platforms</span><span class=p>:</span><span class=w> </span><span class=l>${{ matrix.platform }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>labels</span><span class=p>:</span><span class=w> </span><span class=l>${{ steps.meta.outputs.labels }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>            ghcr.io/${{ steps.lowercase.outputs.owner }}/yangtv:${{ github.event.inputs.tag || &#39;latest&#39; }}
</span></span></span><span class=line><span class=cl><span class=sd>            ghcr.io/${{ steps.lowercase.outputs.owner }}/yangtv:${{ steps.version.outputs.version }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>outputs</span><span class=p>:</span><span class=w> </span><span class=l>type=image,name=ghcr.io/${{ steps.lowercase.outputs.owner }}/yangtv,name-canonical=true,push=true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Export digest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          mkdir -p /tmp/digests
</span></span></span><span class=line><span class=cl><span class=sd>          digest=&#34;${{ steps.build.outputs.digest }}&#34;
</span></span></span><span class=line><span class=cl><span class=sd>          touch &#34;/tmp/digests/${digest#sha256:}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Upload digest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/upload-artifact@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>digests-${{ steps.platform.outputs.id }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/digests/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>if-no-files-found</span><span class=p>:</span><span class=w> </span><span class=l>error</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>retention-days</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>merge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Download digests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/download-artifact@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/digests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=l>digests-*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>merge-multiple</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set up Docker Buildx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/setup-buildx-action@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Login to GitHub Container Registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/login-action@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>registry</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.actor }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.YANGTV }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set lowercase repository owner</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>lowercase</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;owner=$(echo &#39;${{ github.repository_owner }}&#39; | tr &#39;[:upper:]&#39; &#39;[:lower:]&#39;)&#34; &gt;&gt; &#34;$GITHUB_OUTPUT&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Download package.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>sparse-checkout</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>            package.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>sparse-checkout-cone-mode</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Extract version from package.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          VERSION=$(node -p &#34;require(&#39;./package.json&#39;).version&#34;)
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;version=v${VERSION}&#34; &gt;&gt; &#34;$GITHUB_OUTPUT&#34;
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;Detected version: v${VERSION}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Create manifest list and push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>working-directory</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/digests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          docker buildx imagetools create -t ghcr.io/${{ steps.lowercase.outputs.owner }}/yangtv:${{ github.event.inputs.tag || &#39;latest&#39; }} \
</span></span></span><span class=line><span class=cl><span class=sd>            $(printf &#39;ghcr.io/${{ steps.lowercase.outputs.owner }}/yangtv@sha256:%s &#39; *)
</span></span></span><span class=line><span class=cl><span class=sd>          docker buildx imagetools create -t ghcr.io/${{ steps.lowercase.outputs.owner }}/yangtv:${{ steps.version.outputs.version }} \
</span></span></span><span class=line><span class=cl><span class=sd>            $(printf &#39;ghcr.io/${{ steps.lowercase.outputs.owner }}/yangtv@sha256:%s &#39; *)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cleanup-refresh</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>merge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>always()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Delete workflow runs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>Mattraks/delete-workflow-runs@main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.YANGTV }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.repository }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>retain_days</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>keep_minimum_runs</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>6.æœ¬åœ°è¿›è¡Œå…¶ä»–ä¿®æ”¹ï¼Œè§ä¸Š</p><p>7.æäº¤æºç åˆ°ç¬¬ä¸€æ­¥æ–°å»ºçš„ä»“åº“</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>git init
</span></span><span class=line><span class=cl>git checkout -b main
</span></span><span class=line><span class=cl>git remote add origin git@github.com:iwyang/yangtv.git
</span></span><span class=line><span class=cl>git add .
</span></span><span class=line><span class=cl>git commit -m &#34;é¦–æ¬¡æäº¤&#34;
</span></span><span class=line><span class=cl>git push --force origin main
</span></span></code></pre></td></tr></table></div></div><p>8.ä¿®æ”¹ <code>docker-compose.yml</code> æ–‡ä»¶</p><p><strong>æ³¨æ„ä¿®æ”¹è‡ªå·±çš„å¯†ç </strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>vi docker-compose.yml
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>yangtv-core</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/iwyang/yangtv:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>yangtv-core</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always </span><span class=w> </span><span class=c># You can keep &#39;unless-stopped&#39; or &#39;always&#39; as preferred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;3000:3000&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>USERNAME=admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>PASSWORD=ä½ çš„å¯†ç </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NEXT_PUBLIC_STORAGE_TYPE=kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>KVROCKS_URL=redis://yangtv-kvrocks:6666</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NEXT_PUBLIC_DISABLE_YELLOW_FILTER=false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>yangtv-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>yangtv-kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>yangtv-kvrocks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>apache/kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>yangtv-kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always </span><span class=w> </span><span class=c># You can keep &#39;unless-stopped&#39; or &#39;always&#39; as preferred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>kvrocks-data:/var/lib/kvrocks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>yangtv-network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>watchtower</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>containrrr/watchtower</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>watchtower-yangtv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/var/run/docker.sock:/var/run/docker.sock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span>--<span class=l>interval 86400 --cleanup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always </span><span class=w> </span><span class=c># You can keep &#39;unless-stopped&#39; or &#39;always&#39; as preferred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>yangtv-network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>bridge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kvrocks-data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=å‚è€ƒé“¾æ¥>å‚è€ƒé“¾æ¥</h2><ul><li><a class=link href=https://www.sunqi.org/debian-10-install-docker.html target=_blank rel=noopener>å¦‚ä½•åœ¨ debian 10 ä¸­å®‰è£…å’Œä½¿ç”¨ Docker</a></li><li><a class=link href=https://6xyun.cn/article/137 target=_blank rel=noopener>Debian 11 å®‰è£… Docker & Docker Compose</a></li><li><a class=link href=https://www.itbulu.com/docker-compose.html target=_blank rel=noopener>å®ç”¨æ•™ç¨‹Debian 10ç³»ç»Ÿä¸­å®‰è£…Docker Composeè¿‡ç¨‹</a></li><li><a class=link href=https://www.jianshu.com/p/36f63f57b05d target=_blank rel=noopener>Docker å®¹å™¨å¼€æœºè‡ªå¯</a></li><li><a class=link href=https://blog.csdn.net/fjh1997/article/details/98880638 target=_blank rel=noopener>docker-compose å…³æœºæˆ–è€…é‡å¯dockeråŒæ—¶é‡å¯å®¹å™¨restart alwaysçš„é…ç½®</a></li><li><a class=link href=https://chinese.freecodecamp.org/news/how-to-remove-images-in-docker/ target=_blank rel=noopener>å¦‚ä½•åˆ é™¤ Docker é•œåƒå’Œå®¹å™¨</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/docker/>Docker</a></section><section class=article-edit><svg class="icon icon-tabler icon-tabler-external-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11 7H6A2 2 0 004 9v9a2 2 0 002 2h9a2 2 0 002-2v-5"/><line x1="10" y1="14" x2="20" y2="4"/><polyline points="15 4 20 4 20 9"/></svg>
<span><a style=color:inherit href=https://github.com/iwyang/iwyang.github.io/edit/develop/content/post/Debian-10-%e5%ae%89%e8%a3%85-Docker-Docker-Compose.md target=_blank rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ</a></span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span style=color:#999>æ›´æ–°äº 2026-02-09 22:08<a href=https://github.com/iwyang/iwyang.github.io/commit/84e6bb501103ad84c414f9f438bf4cb7c38b876b target=_blank rel="noopener noreferrer" style=color:#1e90ff;font-weight:400;margin-left:5px;text-decoration:none>
#84e6bb5</a></span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/archives/c6592a10/><div class=article-details><h2 class=article-title>AlistæŒ‚è½½ç½‘ç›˜</h2></div></a></article><article><a href=/archives/e0c4249b/><div class=article-details><h2 class=article-title>å½»åº•å¸è½½onedrive</h2></div></a></article><article><a href=/archives/26d4b8da/><div class=article-details><h2 class=article-title>debian 10å®‰è£…xfceæ¡Œé¢å’Œé…ç½®vncå’Œwine</h2></div></a></article><article><a href=/archives/12dd937c/><div class=article-details><h2 class=article-title>åˆ©ç”¨Github Actionsè‡ªåŠ¨åŒæ­¥Fork&&è‡ªåŠ¨åŒæ­¥Releases</h2></div></a></article><article><a href=/archives/144e85ab/><div class=article-details><h2 class=article-title>officeæ›´æ”¹é»˜è®¤å­—ä½“</h2></div></a></article></div></div></aside><script src=//cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.all.min.js></script><div id=tcomment></div><style>.twikoo{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}:root[data-scheme=dark]{--twikoo-body-text-color-main:rgba(255, 255, 255, 0.9);--twikoo-body-text-color:rgba(255, 255, 255, 0.7)}.twikoo .el-input-group__prepend,.twikoo .tk-action-icon,.twikoo .tk-submit-action-icon,.twikoo .tk-time,.twikoo .tk-comments-no,.twikoo .tk-comments-count{color:var(--twikoo-body-text-color)}.twikoo .el-input__inner,.twikoo .el-textarea__inner,.twikoo .tk-preview-container,.twikoo .tk-content,.twikoo .tk-nick,.twikoo .tk-send,.twikoo .tk-comments-no,.twikoo .el-input__count,.twikoo .tk-submit-action-icon{color:var(--twikoo-body-text-color-main)!important}.twikoo .el-button{color:var(--twikoo-body-text-color)!important}.twikoo .el-input__count{color:var(--twikoo-body-text-color)!important}.OwO .OwO-body{background-color:var(--body-background)!important;color:var(--body-text-color)!important}</style><script>twikoo.init({envId:"https://t.bore.vip",el:"#tcomment"})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2026 Bore's Notes</section><section class=running-time>æœ¬åšå®¢å·²è¿è¡Œ <span class=running-days>0</span> å¤©</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º |
ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=4.0.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><script>(function(){var e=new Date(2020,3,25),t=new Date,n=Math.floor((t-e)/(1e3*60*60*24)),s=document.querySelectorAll(".running-days");s.forEach(function(e){e.innerText=n})})()</script><script type=module>
    import gallery from '\/ts\/gallery.js';

    const articleContent = document.querySelector('.article-content');
    const shouldLoad = articleContent && (articleContent.querySelectorAll('figure').length > 0 || articleContent.querySelectorAll('img.gallery-image').length > 0);
    
    if (shouldLoad) {
        gallery(articleContent);

        const PhotoSwipeLightbox = (await import("https:\/\/cdn.jsdelivr.net\/npm\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js")).default;
        const styleHref = "https:\/\/cdn.jsdelivr.net\/npm\/photoswipe@5.4.4\/dist\/photoswipe.css";

        const styleTag = document.createElement('link');
        styleTag.rel = 'stylesheet';
        styleTag.href = styleHref;
        document.head.appendChild(styleTag);

        const lightbox = new PhotoSwipeLightbox({
            gallerySelector: '.article-content',
            childSelector: 'figure a.image-link',
            pswpModule: () => import("https:\/\/cdn.jsdelivr.net\/npm\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js")
        });
        lightbox.init();
    }
</script></main></div><script type=text/javascript src=/ts/main.acaf849f2b273f6a8368a58b001f336738d0c948d92e79b116467d0c7515f932.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>